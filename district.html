<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lovejoy ISD Facilities | PracticePlan</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fafafa;
            --surface: #ffffff;
            --border: #e5e5e5;
            --border-light: #f0f0f0;
            --text: #171717;
            --text-secondary: #525252;
            --text-tertiary: #a3a3a3;
            --primary: #171717;
            --primary-hover: #262626;
            --accent: #2563eb;
            --accent-light: #eff6ff;
            --success: #16a34a;
            --success-light: #f0fdf4;
            --warning: #ea580c;
            --radius: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            
            /* Lovejoy ISD brand colors - Red and Black */
            --brand-primary: #CC0000;
            --brand-secondary: #1a1a1a;
            --brand-light: #fce8e8;
            --brand-hover: #a30000;
            --brand-dark: #1a1a1a;
            --brand-cta: #CC0000;
            --brand-on-cta: #ffffff;
            --brand-on-primary: #ffffff;
            --brand-on-primary-muted: rgba(255,255,255,0.7);
            --share-text: #ffffff;

            /* Hero colors */
            --hero-bg: var(--brand-primary);
            --hero-text: #ffffff;
            --hero-text-muted: rgba(255,255,255,0.7);
            --hero-pattern: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");

            /* Card colors */
            --card-bg: var(--surface);
            --card-border: var(--border);

            /* Badge colors */
            --badge-verified-bg: #ecfdf5;
            --badge-verified-text: #059669;
            --badge-popular-bg: #fef3c7;
            --badge-popular-text: #b45309;
            --badge-available-bg: #eff6ff;
            --badge-available-text: #2563eb;

            /* Filter chip colors */
            --chip-bg: #fdf2f2;
            --chip-text: var(--brand-primary);
        }

        [data-theme="dark"] {
            --bg: #0f0f0f;
            --surface: #1a1a1a;
            --border: #2e2e2e;
            --border-light: #252525;
            --text: #f5f5f5;
            --text-secondary: #a3a3a3;
            --text-tertiary: #737373;
            --primary: #f5f5f5;
            --primary-hover: #e5e5e5;
            --accent: #60a5fa;
            --accent-light: #1e3a5a;
            --success: #4ade80;
            --success-light: #14532d;
            --warning: #fb923c;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow: 0 1px 3px rgba(0,0,0,0.4), 0 1px 2px rgba(0,0,0,0.3);
            
            /* Lovejoy ISD brand colors in dark mode */
            --brand-primary: #ef4444;
            --brand-secondary: #555555;
            --brand-light: #2a1a1a;
            --brand-hover: #ef4444;
            --brand-dark: #CC0000;
            --brand-cta: #ef4444;
            --brand-on-cta: #ffffff;
            --brand-on-primary: #ffffff;
            --share-text: #ffffff;

            /* Hero colors - dark mode */
            --hero-bg: #8a0000;
            --hero-text: #ffffff;
            --hero-text-muted: rgba(255,255,255,0.6);

            /* Card colors - dark mode */
            --card-bg: var(--surface);
            --card-border: var(--border);

            /* Badge colors - dark mode */
            --badge-verified-bg: #064e3b;
            --badge-verified-text: #6ee7b7;
            --badge-popular-bg: #78350f;
            --badge-popular-text: #fcd34d;
            --badge-available-bg: #1e3a5a;
            --badge-available-text: #93c5fd;

            /* Filter chip colors - dark mode */
            --chip-bg: #1e3a5a;
            --chip-text: #93c5fd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        button, input, select, textarea {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Demo Switcher Bar */
        .demo-bar {
            background: #0076bb;
            padding: 6px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: sticky;
            top: 0;
            z-index: 2000;
        }

        .demo-bar-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .demo-bar select {
            padding: 6px 32px 6px 12px;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            transition: background 0.15s ease;
        }

        .demo-bar select:hover {
            background: rgba(255,255,255,0.25);
        }

        .demo-bar select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.6);
        }

        .demo-bar select option {
            background: #0076bb;
            color: #ffffff;
        }

        .demo-palette {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 8px;
        }

        .demo-input-label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
            position: relative;
        }

        .demo-input-label input[type="color"] {
            width: 0;
            height: 0;
            padding: 0;
            margin: 0;
            border: none;
            opacity: 0;
            position: absolute;
            pointer-events: none;
            visibility: hidden;
            overflow: hidden;
        }

        .demo-swatch {
            width: 22px;
            height: 22px;
            border: 1.5px solid rgba(255,255,255,0.4);
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
        }

        .demo-swatch:hover {
            border-color: rgba(255,255,255,0.8);
        }

        .demo-color-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 10px;
            z-index: 9999;
            min-width: 164px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .demo-color-dropdown.open {
            display: block;
        }

        .demo-color-dropdown::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 8px;
            height: 8px;
            background: #1e293b;
            border-left: 1px solid rgba(255,255,255,0.15);
            border-top: 1px solid rgba(255,255,255,0.15);
        }

        .demo-dd-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: rgba(255,255,255,0.45);
            margin-bottom: 6px;
        }

        .demo-dd-swatches {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .demo-dd-swatch {
            width: 28px;
            height: 28px;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.1s, transform 0.1s;
            position: relative;
        }

        .demo-dd-swatch:hover {
            transform: scale(1.12);
        }

        .demo-dd-swatch.active {
            border-color: #ffffff;
        }

        .demo-dd-swatch::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            white-space: nowrap;
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 2px 5px;
            border-radius: 3px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s;
        }

        .demo-dd-swatch:hover::after {
            opacity: 1;
        }

        .demo-dd-hex-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .demo-dd-hex {
            flex: 1;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            color: #ffffff;
            font-family: monospace;
            font-size: 12px;
            padding: 5px 8px;
            width: 100%;
            outline: none;
            text-transform: uppercase;
        }

        .demo-dd-hex:focus {
            border-color: rgba(255,255,255,0.5);
        }

        .demo-dd-more {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            color: rgba(255,255,255,0.7);
            font-size: 11px;
            padding: 5px 10px;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.1s;
        }

        .demo-dd-more:hover {
            background: rgba(255,255,255,0.18);
            color: #fff;
        }

        .demo-swap-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.15s;
            flex-shrink: 0;
            padding: 0;
        }

        .demo-swap-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .demo-swap-btn svg {
            width: 14px;
            height: 14px;
            color: white;
        }

        .demo-divider {
            width: 1px;
            height: 20px;
            background: rgba(255,255,255,0.25);
            margin: 0 4px;
        }

        .powered-by-wordmark {
            height: 17px;
            width: auto;
            position: relative;
            top: 1px;
        }

        /* Header */
        .header {
            background: var(--surface);
            position: sticky;
            top: 38px;
            z-index: 1000;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 6px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-help-wrapper {
            position: relative;
        }

        .header-help-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-tertiary);
            transition: all 0.15s ease;
            padding: 0;
        }

        .header-help-btn:hover {
            color: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        .header-help-btn svg {
            width: 18px;
            height: 18px;
        }

        .help-popover {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 260px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            padding: 16px;
            z-index: 3000;
        }

        .header-help-wrapper.open .help-popover {
            display: block;
        }

        .help-popover-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }

        .help-popover-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 14px;
        }

        .help-popover-email {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--brand-primary);
            text-decoration: none;
            padding: 10px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.15s ease;
        }

        .help-popover-email:hover {
            border-color: var(--brand-primary);
        }

        .help-popover-email svg {
            width: 15px;
            height: 15px;
            flex-shrink: 0;
        }

        .header-user-wrapper {
            position: relative;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 12px 6px 6px;
            border: 1px solid var(--border);
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .header-user:hover {
            border-color: var(--text-tertiary);
        }

        .header-user-menu {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 200px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            overflow: hidden;
            z-index: 3000;
        }

        .header-user-wrapper.open .header-user-menu {
            display: block;
        }

        .header-user-menu-info {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .header-user-menu-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .header-user-menu-role {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .header-user-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 8px 16px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            transition: background 0.1s ease;
            text-align: left;
        }

        .header-user-menu-item:hover {
            background: var(--bg);
        }

        .header-user-menu-item svg {
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        .header-user-menu-item.signout {
            color: #dc2626;
            border-top: 1px solid var(--border);
            margin-top: 4px;
        }

        .header-user-menu-item.signout svg {
            color: #dc2626;
        }

        [data-theme="dark"] .header-user-menu {
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .header-user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--brand-secondary);
            color: var(--share-text);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: -0.02em;
            flex-shrink: 0;
        }

        .header-user-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .header-user-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
        }

        .header-user-role {
            font-size: 11px;
            color: var(--text-tertiary);
            white-space: nowrap;
        }

        .district-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .district-logo {
            width: 28px;
            height: 28px;
            background: var(--brand-primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
            overflow: hidden;
        }

        .district-logo svg {
            width: 16px;
            height: 16px;
            fill: var(--brand-on-primary);
        }

        .district-logo img {
            width: 20px;
            height: 20px;
            object-fit: contain;
            position: relative;
            z-index: 1;
        }

        .district-logo::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--brand-secondary);
        }

        .district-info {
            display: flex;
            flex-direction: row;
            align-items: baseline;
            gap: 0;
        }

        .district-info h1 {
            font-size: 13px;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.01em;
        }

        .district-location {
            display: none;
        }

        .district-location svg {
            width: 12px;
            height: 12px;
            color: var(--text-tertiary);
        }

        .powered-by-strip {
            display: flex;
            justify-content: center;
            padding: 14px 24px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .powered-by {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
            text-decoration: none;
            padding: 6px 18px;
        }

        /* Theme Toggle */
        .theme-toggle {
            display: inline-flex;
            align-items: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 100px;
            padding: 3px;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 100px;
            transition: color 0.2s ease;
            position: relative;
            z-index: 1;
        }

        .theme-option svg {
            width: 14px;
            height: 14px;
        }

        .theme-option.light {
            color: var(--text);
        }

        .theme-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: calc(50% - 3px);
            height: calc(100% - 6px);
            background: var(--surface);
            border-radius: 100px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        [data-theme="dark"] .theme-option.light {
            color: var(--text-secondary);
        }

        [data-theme="dark"] .theme-option.dark {
            color: var(--text);
        }

        [data-theme="dark"] .theme-slider {
            transform: translateX(100%);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 9px 16px;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 14px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--brand-cta);
            color: var(--brand-on-cta);
        }

        .btn-primary:hover {
            background: var(--brand-hover);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg);
        }

        .btn-white {
            background: white;
            color: var(--brand-primary);
            font-weight: 600;
        }

        .btn-white:hover {
            background: #f5f5f5;
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        /* Hero */
        .hero {
            background: linear-gradient(135deg, var(--hero-bg) 0%, var(--brand-dark) 100%);
            color: var(--hero-text);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('https://images.unsplash.com/photo-1591123120675-6f7f1aae0e5b?w=1400&h=600&fit=crop&auto=format');
            background-size: cover;
            background-position: center;
            opacity: 0.12;
            z-index: 0;
        }

        [data-theme="dark"] .hero::before {
            opacity: 0.08;
        }

        /* Gradient accent line under hero */
        .hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--brand-primary) 0%, var(--brand-secondary) 50%, var(--brand-primary) 100%);
            z-index: 2;
        }

        .hero-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 48px 24px 44px;
            position: relative;
            text-align: center;
            z-index: 1;
        }

        .hero-content {
            max-width: 560px;
            margin: 0 auto;
        }

        .hero h2 {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 10px;
            line-height: 1.2;
            text-wrap: balance;
        }

        .hero p {
            font-size: 15px;
            font-weight: 500;
            color: var(--hero-text-muted);
            line-height: 1.6;
            margin-bottom: 0;
            text-wrap: balance;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-location {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            font-weight: 500;
            color: var(--hero-text-muted);
            margin-bottom: 16px;
            letter-spacing: 0.02em;
        }

        .hero-location svg {
            width: 13px;
            height: 13px;
            opacity: 0.7;
        }


        /* Search Bar */
        .search-bar-section {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            position: relative;
            overflow: visible;
            padding-bottom: 16px;
            margin-bottom: 0;
        }

        .search-bar-inner {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .search-row {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            flex: 1;
        }

        .search-row-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .search-field {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            flex: 1;
            min-width: 0;
            position: relative;
        }

        .search-field svg {
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        .search-input {
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
            width: 100%;
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .search-input:focus {
            outline: none;
        }

        .search-input option {
            font-weight: 400;
        }

        .date-field {
            cursor: pointer;
        }

        .date-trigger {
            cursor: pointer;
        }

        .custom-datepicker {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            width: 280px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            padding: 16px;
            z-index: 100;
            font-family: inherit;
        }

        .custom-datepicker.open {
            display: block;
        }

        .dp-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .dp-month {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .dp-nav {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            transition: all 0.15s;
        }

        .dp-nav:hover {
            background: var(--bg);
            color: var(--text);
        }

        .dp-nav svg {
            width: 14px;
            height: 14px;
        }

        .dp-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 4px;
        }

        .dp-weekdays span {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            padding: 4px 0;
        }

        .dp-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .dp-day {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            border: none;
            background: transparent;
            padding: 0;
            font-family: inherit;
            transition: all 0.1s;
        }

        .dp-day:hover {
            background: var(--bg);
        }

        .dp-day.today {
            font-weight: 700;
            border: 1px solid var(--brand-primary);
        }

        .dp-day.selected {
            background: var(--brand-primary);
            color: var(--brand-on-primary);
            font-weight: 600;
        }

        .dp-day.other-month {
            color: var(--text-tertiary);
            opacity: 0.4;
        }

        .dp-day.past {
            color: var(--text-tertiary);
            opacity: 0.3;
            pointer-events: none;
        }

        .dp-clear {
            width: 100%;
            margin-top: 8px;
            padding: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-tertiary);
            background: transparent;
            border: none;
            cursor: pointer;
            font-family: inherit;
            transition: color 0.15s;
        }

        .dp-clear:hover {
            color: var(--text);
        }

        .search-placeholder {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
            pointer-events: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (max-width: 1024px) and (min-width: 769px) {
            .search-field {
                padding: 12px 10px;
                gap: 8px;
            }
            .search-input,
            .search-placeholder {
                font-size: 13px;
            }
            .search-field svg {
                width: 18px;
                height: 18px;
            }
        }

        .search-divider {
            width: 1px;
            height: 28px;
            background: var(--border);
            flex-shrink: 0;
        }

        .search-btn {
            padding: 12px 24px;
            background: var(--brand-cta);
            color: var(--brand-on-cta);
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
            margin: 6px;
            border-radius: 8px;
        }

        .search-btn:hover {
            opacity: 0.85;
        }

        /* Optional Filters */
        .optional-filter-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 14px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
            white-space: nowrap;
        }

        .optional-filter-btn:hover {
            border-color: var(--text-tertiary);
            color: var(--text);
        }

        .optional-filter-btn.active {
            border-style: solid;
            border-color: var(--brand-primary);
            color: var(--brand-primary);
            background: rgba(30, 58, 95, 0.05);
        }

        .optional-filter-btn svg {
            width: 16px;
            height: 16px;
        }

        .optional-fields {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-top: 12px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
            position: relative;
            padding-bottom: 8px;
        }

        .optional-fields-actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 4px;
        }

        .optional-fields-apply {
            padding: 10px 32px;
            background: var(--brand-primary);
            color: var(--brand-on-primary, white);
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .optional-fields-clear {
            padding: 10px 32px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .optional-fields-clear:hover {
            border-color: var(--text-secondary);
            color: var(--text);
        }

        .optional-fields-apply:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .optional-fields-collapse {
            display: none;
            position: absolute;
            bottom: -37px;
            left: 50%;
            transform: translateX(-50%);
            width: 36px;
            height: 20px;
            align-items: center;
            justify-content: center;
            background: var(--surface);
            border: 1px solid var(--border);
            border-top: 1px solid var(--surface);
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            color: var(--text-tertiary);
            padding: 0;
            transition: all 0.15s ease;
            z-index: 10;
        }

        .optional-fields-collapse.visible {
            display: flex;
        }

        .optional-fields-collapse:hover {
            color: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        .optional-fields-collapse svg {
            width: 14px;
            height: 14px;
        }

        .optional-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0;
        }

        .optional-field label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
        }

        .optional-field select {
            width: 100%;
            padding: 10px 32px 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .optional-field select:focus {
            outline: none;
            border-color: var(--brand-primary);
        }

        /* Amenities Multi-Select */
        .amenities-field {
            position: relative;
        }

        .amenities-multi {
            position: relative;
        }

        .amenities-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            transition: border-color 0.15s ease;
        }

        .amenities-btn:hover {
            border-color: var(--text-tertiary);
        }

        .amenities-btn.active {
            border-color: var(--brand-primary);
        }

        .amenities-btn.has-selection {
            color: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        .amenities-chevron {
            font-size: 12px;
            color: var(--text-tertiary);
            transition: transform 0.15s ease;
        }

        .amenities-btn.active .amenities-chevron {
            transform: rotate(180deg);
        }

        .amenities-panel {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            left: 0;
            right: 0;
            min-width: 200px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            z-index: 300;
            padding: 6px 0;
            max-height: 260px;
            overflow-y: auto;
        }

        .amenities-panel.open {
            display: block;
        }

        .amenity-check {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 14px;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
            transition: background 0.1s ease;
            user-select: none;
        }

        .amenity-check:hover {
            background: var(--bg);
        }

        .amenity-check input {
            display: none;
        }

        .check-box {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s ease;
        }

        .amenity-check input:checked ~ .check-box {
            background: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        .amenity-check input:checked ~ .check-box::after {
            content: '';
            width: 5px;
            height: 9px;
            border: solid var(--brand-on-primary);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            margin-bottom: 2px;
        }

        [data-theme="dark"] .amenities-panel {
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        /* Range Slider Styles */
        .optional-field.range-field {
            min-width: 160px;
        }

        .range-wrapper {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .range-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .optional-field input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .optional-field input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--brand-primary);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.15s ease;
        }

        .optional-field input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .optional-field input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--brand-primary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-tertiary);
        }

        @media (max-width: 768px) {
            .search-bar-section {
                padding: 16px;
            }

            .search-row {
                flex-direction: column;
                gap: 12px;
            }

            .search-bar {
                width: 100%;
                flex-direction: column;
            }

            .search-row-right {
                width: 100%;
                justify-content: space-between;
            }

            .search-field {
                width: 100%;
                padding: 16px;
                border-bottom: 1px solid var(--border-light);
            }

            .search-field:last-of-type {
                border-bottom: none;
            }

            .search-divider {
                display: none;
            }

            .search-btn {
                width: calc(100% - 12px);
                margin: 6px;
                padding: 16px;
            }

            .optional-fields {
                grid-template-columns: 1fr;
            }

            .optional-field {
                width: 100%;
            }

            .optional-field select {
                width: 100%;
            }
        }

        /* Filters */
        .filters-section {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .filters-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
        }

        .filters-row {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        /* Activity Search */
        .activity-search {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .activity-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            width: 18px;
            height: 18px;
            color: var(--text-tertiary);
            pointer-events: none;
        }

        .activity-input {
            width: 100%;
            padding: 12px 40px 12px 44px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            color: var(--text);
            transition: all 0.15s ease;
        }

        .activity-input:focus {
            outline: none;
            border-color: #0076bb;
            background: var(--surface);
            box-shadow: 0 0 0 3px rgba(0, 118, 187, 0.1);
        }

        .activity-input::placeholder {
            color: var(--text-tertiary);
        }

        .clear-btn {
            position: absolute;
            right: 10px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--border);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .clear-btn svg {
            width: 14px;
            height: 14px;
            color: var(--text-secondary);
        }

        .clear-btn:hover {
            background: var(--text-tertiary);
        }

        .clear-btn:hover svg {
            color: white;
        }

        /* Activity Dropdown */
        .activity-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            display: none;
            max-height: 360px;
            overflow-y: auto;
            z-index: 100;
        }

        .activity-dropdown.open {
            display: block;
        }

        .dropdown-section {
            padding: 12px;
        }

        .dropdown-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            padding: 4px 8px;
            margin-bottom: 8px;
        }

        .activity-options {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .activity-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s ease;
            text-align: left;
            width: 100%;
        }

        .activity-option:hover {
            background: var(--bg);
        }

        .activity-emoji {
            font-size: 20px;
            width: 28px;
            text-align: center;
        }

        .activity-name {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .activity-facility {
            font-size: 12px;
            color: var(--text-tertiary);
            background: var(--bg);
            padding: 4px 10px;
            border-radius: 100px;
        }

        /* Mobile Bottom Sheet Overlay */
        .dropdown-overlay {
            display: none;
        }

        /* Mobile Dropdown Header */
        .dropdown-handle {
            display: none;
        }

        .dropdown-header {
            display: none;
        }

        @media (max-width: 768px) {
            /* Prevent scroll when dropdown open */
            body.dropdown-open {
                position: fixed;
                width: 100%;
                overflow: hidden;
            }

            .dropdown-overlay {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 200;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.2s ease, visibility 0.2s ease;
            }

            .dropdown-overlay.open {
                opacity: 1;
                visibility: visible;
            }

            .activity-dropdown {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                max-height: 70vh;
                border-radius: 20px 20px 0 0;
                border: none;
                box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15);
                z-index: 201;
                transform: translateY(100%);
                transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
                overscroll-behavior: contain;
            }

            .activity-dropdown.open {
                transform: translateY(0);
            }

            .dropdown-handle {
                display: block;
                width: 36px;
                height: 4px;
                background: var(--border);
                border-radius: 2px;
                margin: 12px auto 0;
            }

            .dropdown-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 20px 16px;
                border-bottom: 1px solid var(--border);
                background: var(--surface);
            }

            .dropdown-title {
                font-size: 16px;
                font-weight: 600;
                color: var(--text);
            }

            .dropdown-close {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: var(--bg);
                border: none;
                border-radius: 50%;
                cursor: pointer;
            }

            .dropdown-close svg {
                width: 18px;
                height: 18px;
                color: var(--text-secondary);
            }

            .dropdown-section {
                padding: 16px;
                overflow-y: auto;
                max-height: calc(70vh - 80px);
                overscroll-behavior: contain;
            }

            .dropdown-label {
                padding: 4px 0 12px;
            }

            .activity-options {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .activity-option {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 16px 12px;
                background: var(--bg);
                border-radius: 12px;
                gap: 8px;
            }

            .activity-option:active {
                background: var(--border);
                transform: scale(0.98);
            }

            .activity-emoji {
                font-size: 28px;
                width: auto;
            }

            .activity-name {
                font-size: 13px;
                line-height: 1.3;
            }

            .activity-facility {
                font-size: 11px;
                padding: 3px 8px;
            }

            /* Prevent input zoom on iOS */
            .activity-input {
                font-size: 16px;
            }
        }

        /* Venue Type Dropdown */
        .venue-type-dropdown {
            position: relative;
            min-width: 180px;
        }

        .venue-select {
            width: 100%;
            padding: 12px 40px 12px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
            transition: all 0.15s ease;
        }

        .venue-select:hover {
            border-color: var(--text-tertiary);
        }

        .venue-select:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }

        .venue-select-icon {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .filters-inner {
                padding: 12px 16px;
            }

            .filters-row {
                flex-direction: column;
                gap: 12px;
            }

            .activity-search {
                max-width: none;
                width: 100%;
            }

            .venue-type-dropdown {
                width: 100%;
            }

            .optional-fields-actions {
                flex-direction: row;
            }

            .optional-fields-actions button {
                flex: 1;
            }
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
            background: var(--bg);
            position: relative;
        }

        /* Soft gradient background */
        .main::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--brand-light) 0%, var(--bg) 25%, var(--bg) 55%, var(--brand-light) 80%, var(--bg) 100%);
            pointer-events: none;
            z-index: 0;
        }

        [data-theme="dark"] .main::before {
            background: linear-gradient(135deg, var(--brand-light) 0%, var(--bg) 25%, var(--bg) 55%, var(--brand-light) 80%, var(--bg) 100%);
        }

        .main > * {
            position: relative;
            z-index: 1;
        }

        /* Results Bar */
        .results-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 100;
            scroll-margin-top: 100px;
        }

        .results-left {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px 6px 12px;
            background: var(--chip-bg);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 500;
            color: var(--chip-text);
        }

        .chip-remove {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(30, 58, 95, 0.15);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s ease;
            padding: 0;
        }

        [data-theme="dark"] .chip-remove {
            background: rgba(147, 197, 253, 0.2);
        }

        .chip-remove svg {
            width: 12px;
            height: 12px;
            color: var(--chip-text);
        }

        .chip-remove:hover {
            background: var(--brand-primary);
        }

        .chip-remove:hover svg {
            color: var(--brand-on-primary);
        }

        .clear-all-filters {
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 6px 8px;
            transition: color 0.15s ease;
        }

        .clear-all-filters:hover {
            color: var(--text);
        }

        .results-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .view-toggle {
            display: flex;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-btn {
            width: 40px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
            color: var(--text-tertiary);
        }

        .view-btn:first-child {
            border-right: 1px solid var(--border);
        }

        .view-btn:hover {
            color: var(--text);
        }

        .view-btn.active {
            background: var(--brand-primary);
            color: var(--brand-on-primary);
        }

        .view-btn svg {
            width: 18px;
            height: 18px;
        }

        .sort-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
            white-space: nowrap;
            user-select: none;
        }

        .results-count {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 500;
            white-space: nowrap;
        }

        .sort-toggle:hover {
            background: var(--surface);
            color: var(--text);
            border-color: var(--text-tertiary);
        }

        .sort-toggle:active,
        .sort-toggle.pressed {
            background: var(--brand-primary);
            color: var(--brand-on-primary);
            border-color: var(--brand-primary);
            transform: scale(0.96);
        }

        .sort-toggle svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }

        .sort-toggle.desc svg {
            transform: rotate(180deg);
        }

        /* Availability Indicator */
        .availability-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            z-index: 2;
        }

        [data-theme="dark"] .availability-indicator {
            background: rgba(0, 0, 0, 0.9);
        }

        .availability-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
        }

        .availability-indicator.high .availability-dot {
            background: #22c55e;
        }

        .availability-indicator.high::after {
            content: 'Available';
        }

        .availability-indicator.medium .availability-dot {
            background: #f59e0b;
        }

        .availability-indicator.medium::after {
            content: 'Limited';
        }

        .availability-indicator.low .availability-dot {
            background: #ef4444;
        }

        .availability-indicator.low::after {
            content: 'Almost Full';
        }

        /* Favorite Button */
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 3;
            padding: 0;
        }

        .favorite-btn:hover {
            background: rgba(0,0,0,0.55);
            transform: scale(1.1);
        }

        .favorite-btn.active {
            background: #f59e0b;
        }

        .favorite-btn svg {
            width: 16px;
            height: 16px;
            stroke: white;
            fill: none;
            stroke-width: 2;
            transition: all 0.2s ease;
        }

        .favorite-btn.active svg {
            fill: white;
            stroke: white;
        }

        /* Weather Badge */
        .weather-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 7px;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 6px;
            font-size: 9px;
            font-weight: 500;
            color: rgba(255,255,255,0.8);
            letter-spacing: 0.02em;
            z-index: 2;
        }

        .weather-badge-icon {
            font-size: 10px;
            line-height: 1;
            filter: grayscale(1) brightness(2);
        }

        .weather-badge-temp {
            font-size: 10px;
            font-weight: 600;
        }

        .weather-badge-desc {
            font-weight: 400;
            opacity: 0.7;
        }

        .weather-badge-divider {
            width: 1px;
            height: 9px;
            background: rgba(255,255,255,0.25);
        }

        /* Calendar Split View */
        .calendar-view {
            display: none;
            gap: 24px;
        }

        .calendar-view.active {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .calendar-view .calendar-panel:first-child {
            order: 2;
        }

        .calendar-view .calendar-panel:last-child {
            order: 1;
        }

        .calendar-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .calendar-month {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin: 0;
        }

        .calendar-nav {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            color: var(--text-secondary);
        }

        .calendar-nav:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }

        .calendar-nav svg {
            width: 16px;
            height: 16px;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 4px;
        }

        .calendar-weekdays span {
            text-align: center;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 6px 2px;
            text-transform: uppercase;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
        }

        .calendar-day:hover {
            border-color: var(--brand-primary);
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.today {
            border-color: var(--brand-primary);
            border-width: 2px;
        }

        .calendar-day.selected {
            background: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        .calendar-day.selected .day-number {
            color: var(--brand-on-primary);
        }

        .calendar-day .day-number {
            font-size: 12px;
            font-weight: 500;
            color: var(--text);
        }

        .calendar-day .day-availability {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            margin-top: 3px;
        }

        .calendar-day .day-availability.high {
            background: #22c55e;
        }

        .calendar-day .day-availability.medium {
            background: #f59e0b;
        }

        .calendar-day .day-availability.low {
            background: #ef4444;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 14px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .legend-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text);
            width: 100%;
            text-align: center;
            margin-bottom: -4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
        }

        .legend-dot.high { background: #22c55e; }
        .legend-dot.medium { background: #f59e0b; }
        .legend-dot.low { background: #ef4444; }

        /* Facility List Panel */
        .facility-list-panel {
            display: flex;
            flex-direction: column;
            gap: 0;
            max-height: 520px;
            overflow-y: auto;
        }

        .facility-list-panel::-webkit-scrollbar {
            width: 4px;
        }

        .facility-list-panel::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .facility-list-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .facility-list-item:last-child {
            border-bottom: none;
        }

        .facility-list-item:hover {
            background: var(--bg);
        }

        .list-item-icon {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 10px;
            background: var(--brand-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--brand-on-primary);
            font-size: 13px;
            font-weight: 800;
            letter-spacing: -0.03em;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .list-item-icon::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--brand-secondary);
        }

        .list-item-icon svg {
            width: 22px;
            height: 22px;
            fill: var(--brand-on-primary);
        }

        .list-item-content {
            flex: 1;
            min-width: 0;
        }

        .list-item-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-item-location {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-item-meta {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .list-item-meta .meta-dot {
            font-size: 8px;
            color: var(--text-tertiary);
        }

        .list-item-meta .price {
            color: var(--brand-primary);
            font-weight: 600;
        }

        .list-item-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            min-width: 90px;
        }

        .list-item-availability {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .list-item-availability .avail-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .list-item-availability.high .avail-dot { background: #22c55e; }
        .list-item-availability.high { color: #16a34a; }
        .list-item-availability.medium .avail-dot { background: #f59e0b; }
        .list-item-availability.medium { color: #d97706; }
        .list-item-availability.low .avail-dot { background: #ef4444; }
        .list-item-availability.low { color: #dc2626; }

        .list-item-booked {
            font-size: 10px;
            color: var(--text-tertiary);
        }

        .list-item-weather {
            font-size: 9px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .list-item-weather .weather-icon-small {
            filter: grayscale(1);
            font-size: 10px;
        }

        .list-item-slots {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }

        .list-item-slot {
            padding: 2px 6px;
            background: var(--brand-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* District Info Section */
        .main-to-about-spacer {
            display: none;
        }

        .district-info-section {
            margin: 0;
            padding: 48px 24px;
            background: var(--about-bg, var(--brand-primary));
            color: var(--about-text, white);
        }

        .district-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .district-info-left {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .district-about h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--about-text, white);
            margin: 0 0 12px 0;
        }

        .district-about p {
            font-size: 14px;
            line-height: 1.7;
            color: var(--about-text-muted, rgba(255,255,255,0.85));
            margin: 0;
        }

        .district-website-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 12px;
            font-size: 13px;
            font-weight: 500;
            color: var(--about-text-muted, rgba(255,255,255,0.7));
            text-decoration: none;
            transition: color 0.15s;
        }

        .district-website-link:hover {
            color: var(--about-text, white);
        }

        .district-website-link svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .about-glance {
            display: flex;
            gap: 0;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: var(--about-glance-bg, rgba(255,255,255,0.08));
            border: 1px solid var(--about-border, rgba(255,255,255,0.12));
        }

        .about-glance-stat {
            flex: 1;
            text-align: center;
            padding: 14px 12px;
            border-right: 1px solid var(--about-border, rgba(255,255,255,0.12));
        }

        .about-glance-stat:last-child {
            border-right: none;
        }

        .about-glance-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--about-text, white);
            line-height: 1.2;
        }

        .about-glance-label {
            font-size: 11px;
            font-weight: 500;
            color: var(--about-text-muted, rgba(255,255,255,0.65));
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .things-to-know {
            background: var(--about-glance-bg, rgba(255,255,255,0.08));
            border: 1px solid var(--about-border, rgba(255,255,255,0.12));
            border-radius: 12px;
            padding: 20px 22px;
        }

        .things-to-know h2 {
            font-size: 15px;
            font-weight: 700;
            color: var(--about-text, white);
            margin: 0 0 14px 0;
        }

        .ttk-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 14px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--about-border, rgba(255,255,255,0.1));
        }

        .ttk-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .ttk-icon {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border-radius: 7px;
            background: var(--about-border, rgba(255,255,255,0.12));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1px;
        }

        .ttk-icon svg {
            width: 14px;
            height: 14px;
            stroke: var(--about-text-muted, rgba(255,255,255,0.7));
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .ttk-content h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--about-text, white);
            margin: 0 0 3px 0;
        }

        .ttk-content p {
            font-size: 12.5px;
            line-height: 1.55;
            color: var(--about-text-muted, rgba(255,255,255,0.7));
            margin: 0;
        }

        .district-map-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .district-map-container h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--about-text, white);
            margin: 0;
        }

        .map-placeholder {
            width: 100%;
            aspect-ratio: 4/3;
            background: var(--about-map-bg, rgba(255,255,255,0.1));
            border: 1px solid var(--about-border, rgba(255,255,255,0.2));
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .map-placeholder::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.15);
            pointer-events: none;
            z-index: 1;
        }

        .map-pin-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -80%);
            z-index: 2;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .map-pin-dot {
            width: 14px;
            height: 14px;
            background: var(--brand-primary);
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .map-pin-pulse {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--brand-primary);
            opacity: 0.2;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: mapPulse 2s ease-in-out infinite;
        }

        @keyframes mapPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.2; }
            50% { transform: translate(-50%, -50%) scale(1.8); opacity: 0; }
        }

        .map-placeholder iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .map-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .map-address-text {
            font-size: 13px;
            color: var(--about-text-muted, rgba(255,255,255,0.7));
            line-height: 1.4;
        }

        .map-directions-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--about-glance-bg, rgba(255,255,255,0.1));
            border: 1px solid var(--about-border, rgba(255,255,255,0.2));
            border-radius: 8px;
            color: var(--about-text, white);
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.15s;
            font-family: inherit;
            white-space: nowrap;
        }

        .map-directions-btn:hover {
            background: var(--about-border, rgba(255,255,255,0.18));
        }

        .map-directions-btn svg {
            width: 14px;
            height: 14px;
            stroke: var(--about-text, white);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .share-section {
            padding: 32px 24px;
        }

        .share-card {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--brand-secondary);
            border-radius: 16px;
            padding: 32px 36px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            position: relative;
            overflow: hidden;
        }

        .share-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--hero-pattern);
            opacity: 0.5;
            pointer-events: none;
        }

        .share-card-left {
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .share-card-icon {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 12px;
            background: rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-card-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--share-text);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .share-card-text {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .share-card-label {
            font-size: 17px;
            font-weight: 700;
            color: var(--share-text);
        }

        .share-card-sub {
            font-size: 13px;
            color: var(--share-text);
            opacity: 0.75;
        }

        .share-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 7px;
            padding: 10px 18px;
            border-radius: 10px;
            background: rgba(255,255,255,0.18);
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(4px);
            transition: all 0.15s;
            text-decoration: none;
            font-family: inherit;
        }

        .share-btn span {
            font-size: 13px;
            font-weight: 600;
            color: var(--share-text);
        }

        .share-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .share-btn svg {
            width: 16px;
            height: 16px;
            fill: none;
            stroke: var(--share-text);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        @media (max-width: 768px) {
            .results-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .results-right {
                justify-content: flex-end;
            }

            .calendar-view.active {
                grid-template-columns: 1fr;
            }

            .calendar-view .calendar-panel:first-child {
                order: 2;
            }

            .calendar-view .calendar-panel:last-child {
                order: 1;
            }

            .calendar-legend {
                flex-wrap: wrap;
                gap: 10px;
            }

            .facility-list-panel {
                max-height: 360px;
            }

            .facility-list-item {
                gap: 10px;
                padding: 10px 12px;
            }

            .list-item-icon {
                width: 32px;
                height: 32px;
                min-width: 32px;
                font-size: 11px;
                border-radius: 8px;
            }

            .list-item-name {
                font-size: 13px;
            }

            .list-item-location {
                font-size: 10px;
                margin-bottom: 0;
            }

            .list-item-meta {
                display: none;
            }

            .list-item-right {
                min-width: auto;
                gap: 0;
            }

            .list-item-booked,
            .list-item-weather,
            .list-item-slots {
                display: none;
            }

            .list-item-availability {
                font-size: 9px;
            }

            .district-info-grid {
                grid-template-columns: 1fr;
            }

            .map-actions {
                flex-direction: column;
                align-items: flex-start;
            }

            .share-card {
                flex-direction: column;
                align-items: flex-start;
                padding: 24px;
            }

            .share-buttons {
                width: 100%;
            }

            .share-btn {
                flex: 1;
                justify-content: center;
                padding: 10px 12px;
            }
        }

        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text);
        }

        .view-all {
            font-size: 14px;
            font-weight: 600;
            color: #0076bb;
            text-decoration: none;
        }

        .view-all:hover {
            text-decoration: underline;
        }

        /* Facility Grid */
        .facility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 64px 24px;
            max-width: 420px;
            margin: 0 auto;
        }

        .empty-state-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .empty-state-icon svg {
            width: 28px;
            height: 28px;
            color: var(--text-tertiary);
        }

        .empty-state-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin: 0 0 8px 0;
        }

        .empty-state-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0 0 20px 0;
        }

        .empty-state-btn {
            font-size: 13px;
            font-weight: 600;
            color: var(--brand-primary);
            background: transparent;
            border: 1px solid var(--brand-primary);
            border-radius: 8px;
            padding: 8px 20px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s ease;
        }

        .empty-state-btn:hover {
            background: var(--brand-primary);
            color: var(--brand-on-primary);
        }

        .calendar-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 48px 20px;
        }

        .calendar-empty-state svg {
            width: 32px;
            height: 32px;
            color: var(--text-tertiary);
            margin-bottom: 14px;
        }

        .calendar-empty-state h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin: 0 0 6px 0;
        }

        .calendar-empty-state p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
        }

        .facility-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
            isolation: isolate;
            position: relative;
        }

        .facility-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--brand-primary);
            z-index: 3;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .facility-card:hover {
            box-shadow: 0 12px 32px rgba(139, 0, 0, 0.2);
            transform: translateY(-4px);
        }

        [data-theme="dark"] .facility-card:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
        }

        .facility-image {
            position: relative;
            height: 180px;
            overflow: hidden;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .facility-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .image-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--brand-primary) 0%, transparent 100%);
            opacity: 0.4;
        }

        .image-placeholder::after {
            content: '';
            width: 48px;
            height: 48px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.3)' stroke-width='1.5'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'/%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'/%3E%3Cpolyline points='21 15 16 10 5 21'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .facility-body {
            padding: 16px;
            position: relative;
        }

        .facility-type-icon {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--brand-primary);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 800;
            line-height: 1;
            color: var(--brand-on-primary);
            letter-spacing: -0.03em;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .facility-type-icon::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--brand-secondary);
        }

        .facility-type-icon svg {
            width: 22px;
            height: 22px;
            fill: var(--brand-on-primary);
        }

        .facility-type-icon img {
            width: 28px;
            height: 28px;
            object-fit: contain;
            position: relative;
            z-index: 1;
        }

        .facility-card:hover .facility-image img {
            transform: scale(1.05);
        }

        .facility-badge {
            position: absolute;
            bottom: 12px;
            right: 12px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }

        .facility-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
            line-height: 1.3;
        }

        .facility-location {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        /* Badges */
        .facility-badges {
            display: none;
        }

        .card-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, var(--border) 20%, var(--border) 80%, transparent 100%);
            margin-bottom: 10px;
        }

        .badge {
            display: none;
        }

        .badge svg {
            width: 12px;
            height: 12px;
        }

        .badge-verified {
            color: #16a34a;
            border-color: #16a34a;
        }

        [data-theme="dark"] .badge-verified {
            color: #4ade80;
            border-color: #4ade80;
        }

        .badge-popular {
            color: #d97706;
            border-color: #d97706;
        }

        [data-theme="dark"] .badge-popular {
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .badge-available {
            color: #0284c7;
            border-color: #0284c7;
        }

        [data-theme="dark"] .badge-available {
            color: #38bdf8;
            border-color: #38bdf8;
        }

        .badge-responsive {
            color: #7c3aed;
            border-color: #7c3aed;
        }

        [data-theme="dark"] .badge-responsive {
            color: #a78bfa;
            border-color: #a78bfa;
        }

        .badge-amenities {
            color: #64748b;
            border-color: #64748b;
        }

        [data-theme="dark"] .badge-amenities {
            color: #94a3b8;
            border-color: #94a3b8;
        }

        /* Meta line */
        .facility-meta-line {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .meta-dot {
            color: var(--text-tertiary);
        }

        /* Gold accent for prices */
        .facility-meta-line .price {
            color: #16a34a;
            font-weight: 600;
        }

        [data-theme="dark"] .facility-meta-line .price {
            color: #4ade80;
        }

        .facility-price-line {
            font-size: 14px;
            font-weight: 700;
            color: #16a34a;
            margin: 4px 0 8px;
        }

        [data-theme="dark"] .facility-price-line {
            color: #4ade80;
        }

        /* Stats */
        .facility-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 14px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stat-icon {
            width: 13px;
            height: 13px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        /* Time slots */
        .time-slots,
        .time-slots-searched {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .time-slot {
            padding: 10px 14px;
            background: var(--brand-primary);
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: var(--brand-on-primary);
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .time-slot:hover {
            background: var(--brand-hover);
        }

        .time-slot:active {
            transform: scale(0.97);
        }

        .btn-check-availability {
            width: 100%;
            padding: 12px 20px;
            background: var(--brand-cta);
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: var(--brand-on-cta);
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .btn-check-availability:hover {
            opacity: 0.85;
        }

        .btn-check-availability:active {
            transform: scale(0.98);
        }

        /* ============================================= */
        /* BOOKING MODAL                                 */
        /* ============================================= */
        .booking-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease, visibility 0.25s ease;
            padding: 20px;
        }
        .booking-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .booking-modal {
            background: var(--bg);
            border-radius: 16px;
            width: 100%;
            max-width: 920px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 24px 80px rgba(0,0,0,0.3);
            transform: translateY(20px) scale(0.97);
            transition: transform 0.3s ease;
        }
        .booking-modal-overlay.active .booking-modal {
            transform: translateY(0) scale(1);
        }

        /* Modal Header */
        .modal-header {
            background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-hover) 100%);
            color: var(--brand-on-primary);
            padding: 20px 24px;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            flex-shrink: 0;
        }
        .modal-header-logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }
        .modal-header-logo img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }
        .modal-header-info {
            flex: 1;
            min-width: 0;
        }
        .modal-header-info h2 {
            font-family: var(--ff);
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            line-height: 1.2;
            color: inherit;
        }
        .modal-header-sub {
            font-size: 14px;
            opacity: 0.85;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .modal-header-sub svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }
        .modal-close-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: inherit;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: background 0.15s ease;
        }
        .modal-close-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        .modal-close-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Modal Body */
        .modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            overflow-y: auto;
            flex: 1;
        }

        /* Left Column - Facility Info */
        .modal-left {
            padding: 24px;
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }
        .modal-facility-image {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        .modal-facility-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .modal-weather-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.65);
            backdrop-filter: blur(8px);
            color: #fff;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .modal-section-title {
            font-family: var(--ff);
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border-left: 3px solid var(--brand-primary);
            padding-left: 10px;
        }
        .modal-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .modal-info-item {
            background: var(--surface);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .modal-info-item svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
            flex-shrink: 0;
            margin-top: 1px;
        }
        .modal-info-item .info-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }
        .modal-info-item .info-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        /* Features & Amenities */
        .modal-features {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 20px;
        }
        .modal-feature-tag {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .modal-feature-tag svg {
            width: 12px;
            height: 12px;
            color: var(--text-secondary);
        }
        .modal-amenities-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 20px;
        }
        .modal-amenity-item {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
        }
        .modal-amenity-item:hover {
            border-color: var(--brand-primary);
            background: var(--brand-light);
        }
        .modal-amenity-item.selected {
            border-color: var(--brand-primary);
            background: var(--brand-light);
        }
        .modal-amenity-check {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s ease;
        }
        .modal-amenity-item.selected .modal-amenity-check {
            background: var(--brand-primary);
            border-color: var(--brand-primary);
        }
        .modal-amenity-check svg {
            width: 12px;
            height: 12px;
            stroke: #fff;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        .modal-amenity-item.selected .modal-amenity-check svg {
            opacity: 1;
        }
        .modal-amenity-info {
            flex: 1;
            min-width: 0;
        }
        .modal-amenity-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }
        .modal-amenity-price {
            font-size: 12px;
            font-weight: 600;
            color: #16a34a;
        }
        [data-theme="dark"] .modal-amenity-price {
            color: #4ade80;
        }
        .modal-amenity-total {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
            margin-bottom: 20px;
        }
        .modal-amenity-total-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        .modal-amenity-total-amount {
            font-size: 14px;
            font-weight: 700;
            color: #16a34a;
        }
        [data-theme="dark"] .modal-amenity-total-amount {
            color: #4ade80;
        }
        .modal-policy {
            background: var(--surface);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
        }
        .modal-policy-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        .modal-policy-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Right Column - Booking Form */
        .modal-right {
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .modal-price-banner {
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 4px solid var(--brand-primary);
            border-radius: 10px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .modal-price-amount {
            font-family: var(--ff);
            font-size: 24px;
            font-weight: 800;
            color: #16a34a;
        }
        [data-theme="dark"] .modal-price-amount {
            color: #4ade80;
        }
        .modal-price-unit {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-secondary);
        }
        .modal-price-availability {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .modal-price-availability .avail-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .modal-price-availability .avail-dot.high { background: #16a34a; }
        .modal-price-availability .avail-dot.medium { background: #f59e0b; }
        .modal-price-availability .avail-dot.low { background: #ef4444; }

        .modal-form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .modal-form-group.field-incomplete .modal-form-select {
            border-color: #f59e0b;
            box-shadow: 0 0 0 2px rgba(245,158,11,0.15);
        }
        [data-theme="dark"] .modal-form-group.field-incomplete .modal-form-select {
            border-color: #d97706;
            box-shadow: 0 0 0 2px rgba(217,119,6,0.15);
        }
        .modal-form-group.field-incomplete .modal-form-label::after {
            content: ' *';
            color: #f59e0b;
            font-weight: 400;
        }
        [data-theme="dark"] .modal-form-group.field-incomplete .modal-form-label::after {
            color: #fbbf24;
        }
        .modal-form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .modal-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .modal-form-input,
        .modal-form-select {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            font-family: var(--ff);
            color: var(--text);
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.15s ease;
            appearance: none;
        }
        .modal-form-input:focus,
        .modal-form-select:focus {
            outline: none;
            border-color: var(--brand-primary);
        }
        .modal-select-wrapper {
            position: relative;
        }
        .modal-select-wrapper::after {
            content: '';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 12px;
            pointer-events: none;
        }

        /* Modal Date Picker */
        .modal-date-field {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            cursor: pointer;
            transition: border-color 0.15s ease;
        }
        .modal-date-field:hover {
            border-color: var(--brand-primary);
        }
        .modal-date-display {
            flex: 1;
            font-size: 14px;
            font-family: var(--ff);
            color: var(--text);
        }
        .modal-date-display.placeholder {
            color: var(--text-secondary);
        }
        .modal-datepicker {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            width: 280px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            padding: 16px;
            z-index: 10001;
            font-family: inherit;
        }
        .modal-datepicker.open {
            display: block;
        }

        /* Time Slot Picker */
        .modal-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
            gap: 6px;
        }
        .modal-slot-btn {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 8px 6px;
            font-size: 13px;
            font-family: var(--ff);
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
            white-space: nowrap;
        }
        .modal-slot-btn:hover {
            border-color: var(--brand-primary);
            background: var(--brand-light);
        }
        .modal-slot-btn.selected {
            background: var(--brand-primary);
            border-color: var(--brand-primary);
            color: var(--brand-on-primary);
        }
        .modal-slot-btn.booked {
            opacity: 0.35;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .modal-slot-btn.reserved {
            opacity: 0.55;
            cursor: not-allowed;
            background: #fef3c7;
            border-color: #fcd34d;
            color: #92400e;
            position: relative;
        }
        [data-theme="dark"] .modal-slot-btn.reserved {
            background: rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.35);
            color: #fcd34d;
        }
        .modal-slot-btn.past-slot {
            opacity: 0.3;
            cursor: not-allowed;
            color: var(--text-secondary);
        }
        .modal-slot-btn.past-slot::after {
            content: '';
        }
        .modal-slot-btn:disabled:hover {
            border-color: var(--border);
            background: var(--surface);
            transform: none;
        }
        /* Time slots required indicator */
        .modal-slots-wrapper.field-incomplete .modal-slots-grid {
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 8px;
            box-shadow: 0 0 0 3px rgba(245,158,11,0.12);
        }
        [data-theme="dark"] .modal-slots-wrapper.field-incomplete .modal-slots-grid {
            border-color: #d97706;
            box-shadow: 0 0 0 3px rgba(217,119,6,0.12);
        }
        .modal-slots-wrapper .slots-required-hint {
            display: none;
            font-size: 11px;
            font-weight: 600;
            color: #f59e0b;
            margin-top: 6px;
        }
        [data-theme="dark"] .modal-slots-wrapper .slots-required-hint {
            color: #fbbf24;
        }
        .modal-slots-wrapper.field-incomplete .slots-required-hint {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .modal-slots-wrapper.field-incomplete .slots-required-hint svg {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
        }
        .modal-slots-wrapper.slot-selected .modal-slots-grid {
            border: 2px solid var(--brand-cta);
            border-radius: 10px;
            padding: 8px;
        }

        .modal-notice {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 13px;
            color: #1e40af;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        [data-theme="dark"] .modal-notice {
            background: rgba(59,130,246,0.1);
            border-color: rgba(59,130,246,0.25);
            color: #93c5fd;
        }
        .modal-notice svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .modal-btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .modal-book-btn {
            background: var(--brand-cta);
            color: var(--brand-on-cta);
            border: none;
            border-radius: 10px;
            padding: 14px 24px;
            font-family: var(--ff);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .modal-book-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }
        .modal-book-btn:active {
            transform: translateY(0);
        }
        .modal-book-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            filter: none;
        }
        .modal-validation-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .modal-validation-hint svg {
            display: none;
        }
        .modal-validation-hint .vhint-bar-wrap {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }
        .modal-validation-hint .vhint-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            white-space: nowrap;
            flex-shrink: 0;
        }
        .modal-validation-hint .vhint-track {
            flex: 1;
            height: 6px;
            background: var(--bg-hover);
            border-radius: 3px;
            overflow: hidden;
            min-width: 60px;
        }
        .modal-validation-hint .vhint-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.35s ease, background 0.35s ease;
            background: #f59e0b;
        }
        .modal-validation-hint.all-done {
            border-color: #16a34a;
            background: #f0fdf4;
        }
        [data-theme="dark"] .modal-validation-hint.all-done {
            border-color: rgba(74,222,128,0.3);
            background: rgba(74,222,128,0.08);
        }
        .modal-validation-hint.all-done .vhint-fill {
            background: #16a34a;
        }
        [data-theme="dark"] .modal-validation-hint.all-done .vhint-fill {
            background: #4ade80;
        }
        .modal-validation-hint.all-done .vhint-label {
            color: #16a34a;
        }
        [data-theme="dark"] .modal-validation-hint.all-done .vhint-label {
            color: #4ade80;
        }
        .modal-book-btn.secondary {
            background: transparent;
            color: var(--brand-cta);
            border: 2px solid var(--brand-cta);
        }
        .modal-book-btn.secondary:hover {
            background: var(--brand-light);
            filter: none;
        }
        .modal-book-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }
        .modal-book-btn.secondary svg {
            stroke: var(--brand-cta);
        }
        .modal-login-hint {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .modal-login-hint a {
            color: var(--brand-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .modal-divider {
            height: 1px;
            background: var(--border);
            margin: 2px 0;
        }

        /* ============================================= */
        /* RESERVATION SYSTEM                            */
        /* ============================================= */

        /* Header cart button */
        .header-cart-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 2px;
        }
        .header-cart-btn:hover {
            background: var(--bg-hover);
            border-color: var(--text-secondary);
        }
        .header-cart-btn svg {
            width: 18px;
            height: 18px;
            stroke: var(--text);
        }
        .header-cart-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--brand-cta);
            color: var(--brand-on-cta);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            display: none;
            align-items: center;
            justify-content: center;
            font-family: var(--ff);
            border: 2px solid var(--bg);
            line-height: 1;
        }
        .header-cart-badge.visible {
            display: flex;
        }
        .header-cart-badge.pop {
            animation: cartBadgePop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes cartBadgePop {
            0% { transform: scale(0.3); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }

        /* Cart drawer overlay */
        .cart-drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease, visibility 0.25s ease;
            backdrop-filter: blur(2px);
        }
        .cart-drawer-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* Cart drawer panel */
        .cart-drawer {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 420px;
            max-width: 92vw;
            background: var(--bg);
            z-index: 10001;
            transform: translateX(100%);
            transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -8px 0 32px rgba(0,0,0,0.15);
        }
        .cart-drawer-overlay.open .cart-drawer {
            transform: translateX(0);
        }

        .cart-drawer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .cart-drawer-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .cart-drawer-title svg {
            width: 20px;
            height: 20px;
            stroke: var(--text);
        }
        .cart-drawer-count {
            background: var(--bg-hover);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .cart-drawer-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-hover);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s;
        }
        .cart-drawer-close:hover { background: var(--border); }
        .cart-drawer-close svg { width: 16px; height: 16px; stroke: var(--text); }

        /* Cart items list */
        .cart-drawer-items {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }
        .cart-drawer-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            text-align: center;
            color: var(--text-secondary);
            gap: 12px;
        }
        .cart-drawer-empty svg {
            width: 48px;
            height: 48px;
            stroke: var(--border);
            stroke-width: 1.5;
        }
        .cart-drawer-empty-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }
        .cart-drawer-empty-text {
            font-size: 13px;
            line-height: 1.5;
        }

        /* Individual cart item */
        .cart-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
            transition: all 0.2s ease;
        }
        .cart-item:hover {
            border-color: var(--text-secondary);
        }
        .cart-item-layout {
            display: flex;
            gap: 12px;
        }
        /* Calendar-style date block */
        .cart-item-date-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 50px;
            max-width: 50px;
            flex-shrink: 0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: var(--surface);
        }
        .cart-date-header {
            width: 100%;
            padding: 3px 0;
            background: var(--brand-cta);
            text-align: center;
        }
        .cart-date-month {
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--brand-on-cta);
            line-height: 1;
        }
        .cart-date-body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 3px 0 4px;
            width: 100%;
            background: var(--bg);
        }
        .cart-date-day {
            font-size: 20px;
            font-weight: 800;
            color: var(--text);
            line-height: 1.1;
        }
        .cart-date-weekday {
            font-size: 9px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            line-height: 1;
        }
        .cart-item-info {
            flex: 1;
            min-width: 0;
        }
        .cart-item-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 6px;
        }
        .cart-item-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text);
            line-height: 1.3;
        }
        .cart-item-location {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .cart-item-remove {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border-radius: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            color: var(--text-secondary);
            opacity: 0.5;
        }
        .cart-item-remove:hover {
            background: #fef2f2;
            color: #ef4444;
            opacity: 1;
        }
        [data-theme="dark"] .cart-item-remove:hover {
            background: rgba(239,68,68,0.15);
            color: #f87171;
        }
        .cart-item-remove svg { width: 13px; height: 13px; }

        .cart-item-details {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
            margin-bottom: 4px;
        }
        .cart-item-tag {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: var(--bg-hover);
            border-radius: 5px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        .cart-item-tag svg {
            width: 11px;
            height: 11px;
        }
        .cart-item-addons {
            font-size: 12px;
            color: var(--text-secondary);
            padding-top: 6px;
            border-top: 1px dashed var(--border);
            margin-top: 4px;
        }
        /* Collapsible details toggle */
        .cart-item-expand {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
            font-family: var(--ff);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-top: 4px;
            transition: color 0.15s;
        }
        .cart-item-expand:hover { color: var(--text); }
        .cart-item-expand svg {
            width: 13px;
            height: 13px;
            transition: transform 0.25s ease;
        }
        .cart-item-expand.open svg {
            transform: rotate(180deg);
        }
        /* Collapsible body */
        .cart-item-collapse {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.25s ease;
            opacity: 0;
        }
        .cart-item-collapse.open {
            max-height: 400px;
            opacity: 1;
        }
        .cart-item-collapse-inner {
            padding-top: 8px;
            margin-top: 6px;
            border-top: 1px dashed var(--border);
        }
        /* Detail rows inside collapse */
        .cart-detail-section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .cart-detail-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2px 0;
            font-size: 11px;
        }
        .cart-detail-label {
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .cart-detail-label svg {
            width: 11px;
            height: 11px;
            flex-shrink: 0;
        }
        .cart-detail-value {
            color: var(--text);
            font-weight: 500;
        }
        .cart-detail-divider {
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }
        /* Cost breakdown rows */
        .cart-cost-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2px 0;
            font-size: 11px;
        }
        .cart-cost-label {
            color: var(--text-secondary);
        }
        .cart-cost-value {
            color: var(--text);
            font-weight: 500;
        }
        .cart-cost-total {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 4px;
            margin-top: 3px;
            border-top: 1px solid var(--border);
            font-size: 12px;
        }
        .cart-cost-total-label {
            font-weight: 700;
            color: var(--text);
        }
        .cart-cost-total-value {
            font-weight: 700;
            color: #16a34a;
        }
        [data-theme="dark"] .cart-cost-total-value { color: #4ade80; }

        .cart-item-price {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            margin-top: 10px;
        }
        .cart-item-price-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .cart-item-price-value {
            font-size: 15px;
            font-weight: 700;
            color: #16a34a;
        }
        [data-theme="dark"] .cart-item-price-value {
            color: #4ade80;
        }
        .cart-item.removing {
            animation: cartItemRemove 0.35s ease forwards;
        }
        @keyframes cartItemRemove {
            0% { opacity: 1; transform: translateX(0); max-height: 600px; margin-bottom: 12px; }
            50% { opacity: 0; transform: translateX(40px); max-height: 600px; margin-bottom: 12px; }
            100% { opacity: 0; transform: translateX(40px); max-height: 0; margin-bottom: 0; padding: 0; border: 0; overflow: hidden; }
        }

        /* Cart drawer footer */
        .cart-drawer-footer {
            border-top: 1px solid var(--border);
            padding: 20px 24px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            flex-shrink: 0;
            background: var(--bg);
        }
        .cart-total-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        .cart-total-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        .cart-total-value {
            font-size: 13px;
            color: var(--text);
            font-weight: 500;
        }
        .cart-total-grand {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: 8px;
            margin-bottom: 16px;
        }
        .cart-total-grand-label {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
        }
        .cart-total-grand-value {
            font-size: 20px;
            font-weight: 800;
            color: #16a34a;
        }
        [data-theme="dark"] .cart-total-grand-value {
            color: #4ade80;
        }
        .cart-checkout-btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            background: var(--brand-cta);
            color: var(--brand-on-cta);
            font-family: var(--ff);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.15s ease;
        }
        .cart-checkout-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .cart-checkout-btn:active { transform: translateY(0); }
        .cart-checkout-btn:disabled {
            opacity: 0.45;
            cursor: not-allowed;
            filter: none;
            transform: none;
        }
        .cart-checkout-btn:disabled:hover { filter: none; transform: none; }
        .cart-checkout-btn svg { width: 18px; height: 18px; }
        .cart-clear-btn {
            width: 100%;
            padding: 10px 24px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--ff);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.15s;
        }
        .cart-clear-btn:hover { border-color: #ef4444; color: #ef4444; }

        /* Card action buttons row */
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }
        .cart-item-action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 5px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: none;
            cursor: pointer;
            font-family: var(--ff);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.15s;
            white-space: nowrap;
        }
        .cart-item-action-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text);
            background: var(--bg-hover);
        }
        .cart-item-action-btn svg { width: 12px; height: 12px; flex-shrink: 0; }
        .cart-item-action-btn.action-primary {
            color: var(--brand-cta);
            border-color: var(--brand-cta);
        }
        .cart-item-action-btn.action-primary:hover {
            background: var(--brand-cta);
            color: var(--brand-on-cta);
        }

        /* Drawer secondary buttons row */
        .cart-secondary-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .cart-browse-btn {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: transparent;
            color: var(--text);
            font-family: var(--ff);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.15s;
        }
        .cart-browse-btn:hover { border-color: var(--brand-cta); color: var(--brand-cta); }
        .cart-browse-btn svg { width: 15px; height: 15px; }
        .cart-secondary-actions .cart-clear-btn {
            flex: 0 0 auto;
            width: auto;
            padding: 10px 16px;
            margin-top: 0;
            font-size: 13px;
        }

        /* Drawer insurance reminder */
        .cart-insurance-reminder {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 12px 14px;
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 10px;
            margin-bottom: 12px;
        }
        [data-theme="dark"] .cart-insurance-reminder {
            background: rgba(245,158,11,0.08);
            border-color: rgba(245,158,11,0.3);
        }
        .cart-insurance-reminder-header {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .cart-insurance-reminder-header svg {
            width: 18px;
            height: 18px;
            color: #d97706;
            flex-shrink: 0;
            margin-top: 1px;
        }
        [data-theme="dark"] .cart-insurance-reminder-header svg {
            color: #fbbf24;
        }
        .cart-insurance-reminder-text {
            flex: 1;
            min-width: 0;
        }
        .cart-insurance-reminder-title {
            font-size: 13px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 2px;
        }
        [data-theme="dark"] .cart-insurance-reminder-title {
            color: #fbbf24;
        }
        .cart-insurance-reminder-desc {
            font-size: 11px;
            color: #a16207;
            line-height: 1.45;
        }
        [data-theme="dark"] .cart-insurance-reminder-desc {
            color: rgba(251,191,36,0.7);
        }
        .cart-insurance-upload-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .cart-insurance-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border: 1.5px solid #d97706;
            border-radius: 8px;
            background: rgba(217,119,6,0.08);
            color: #92400e;
            font-family: var(--ff);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        [data-theme="dark"] .cart-insurance-upload-btn {
            border-color: #fbbf24;
            background: rgba(251,191,36,0.1);
            color: #fbbf24;
        }
        .cart-insurance-upload-btn:hover {
            background: rgba(217,119,6,0.15);
        }
        .cart-insurance-upload-btn svg { width: 14px; height: 14px; }
        .cart-insurance-upload-btn input[type="file"] { display: none; }
        /* Uploaded state */
        .cart-insurance-reminder.uploaded {
            background: #f0fdf4;
            border-color: #86efac;
        }
        [data-theme="dark"] .cart-insurance-reminder.uploaded {
            background: rgba(74,222,128,0.08);
            border-color: rgba(74,222,128,0.3);
        }
        .cart-insurance-reminder.uploaded .cart-insurance-reminder-header svg {
            color: #16a34a;
        }
        [data-theme="dark"] .cart-insurance-reminder.uploaded .cart-insurance-reminder-header svg {
            color: #4ade80;
        }
        .cart-insurance-reminder.uploaded .cart-insurance-reminder-title {
            color: #166534;
        }
        [data-theme="dark"] .cart-insurance-reminder.uploaded .cart-insurance-reminder-title {
            color: #4ade80;
        }
        .cart-insurance-reminder.uploaded .cart-insurance-reminder-desc {
            color: #15803d;
        }
        [data-theme="dark"] .cart-insurance-reminder.uploaded .cart-insurance-reminder-desc {
            color: rgba(74,222,128,0.7);
        }
        .cart-insurance-file-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .cart-insurance-file-name {
            font-size: 12px;
            font-weight: 600;
            color: #166534;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }
        [data-theme="dark"] .cart-insurance-file-name {
            color: #4ade80;
        }
        .cart-insurance-file-remove {
            padding: 4px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-secondary);
            opacity: 0.6;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        .cart-insurance-file-remove:hover { opacity: 1; color: #ef4444; }
        .cart-insurance-file-remove svg { width: 14px; height: 14px; }

        /* Drawer PracticePlan logo */
        .cart-drawer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 14px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            opacity: 0.35;
        }
        .cart-drawer-logo span {
            font-size: 10px;
            color: var(--text-secondary);
            letter-spacing: 0.03em;
        }
        .cart-drawer-logo svg {
            height: 14px;
            width: auto;
            filter: grayscale(1);
        }

        /* Insurance upload section */
        .modal-insurance {
            border: 1px dashed var(--border);
            border-radius: 10px;
            padding: 14px;
            position: relative;
        }
        .modal-insurance-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .modal-insurance-header svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        .modal-insurance-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .modal-insurance-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .modal-insurance-upload {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .insurance-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-hover);
            color: var(--text);
            font-family: var(--ff);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        .insurance-upload-btn:hover {
            border-color: var(--brand-cta);
            color: var(--brand-cta);
        }
        .insurance-upload-btn svg { width: 14px; height: 14px; }
        .insurance-upload-btn input[type="file"] {
            display: none;
        }
        /* Attached file state */
        .modal-insurance.has-file {
            border-style: solid;
            border-color: #16a34a;
            background: #f0fdf4;
        }
        [data-theme="dark"] .modal-insurance.has-file {
            border-color: #4ade80;
            background: rgba(74,222,128,0.08);
        }
        .modal-insurance.has-file .modal-insurance-header svg {
            color: #16a34a;
        }
        [data-theme="dark"] .modal-insurance.has-file .modal-insurance-header svg {
            color: #4ade80;
        }
        .insurance-file-info {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            flex: 1;
            min-width: 0;
        }
        .modal-insurance.has-file .insurance-file-info {
            display: flex;
        }
        .modal-insurance.has-file .insurance-upload-btn {
            display: none;
        }
        .modal-insurance.has-file .modal-insurance-subtitle {
            display: none;
        }
        .insurance-file-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #dcfce7;
            border-radius: 6px;
            flex-shrink: 0;
        }
        [data-theme="dark"] .insurance-file-icon {
            background: rgba(74,222,128,0.15);
        }
        .insurance-file-icon svg { width: 14px; height: 14px; color: #16a34a; }
        [data-theme="dark"] .insurance-file-icon svg { color: #4ade80; }
        .insurance-file-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }
        .insurance-file-size {
            font-size: 10px;
            color: var(--text-secondary);
        }
        .insurance-file-remove {
            padding: 2px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-secondary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.15s;
        }
        .insurance-file-remove:hover { color: #ef4444; }
        .insurance-file-remove svg { width: 14px; height: 14px; }
        .insurance-retained-badge {
            display: none;
            font-size: 10px;
            font-weight: 600;
            color: #16a34a;
            margin-top: 6px;
        }
        [data-theme="dark"] .insurance-retained-badge { color: #4ade80; }
        .modal-insurance.has-file.retained .insurance-retained-badge {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .insurance-retained-badge svg { width: 12px; height: 12px; }

        /* Insurance badge on reservation cards */
        .cart-item-insurance-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: #dcfce7;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 600;
            color: #16a34a;
        }
        [data-theme="dark"] .cart-item-insurance-badge {
            background: rgba(74,222,128,0.12);
            color: #4ade80;
        }
        .cart-item-insurance-badge svg { width: 10px; height: 10px; }

        /* "Reserved" success overlay in modal */
        .modal-success-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.92);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border-radius: 16px;
        }
        [data-theme="dark"] .modal-success-overlay {
            background: rgba(15,15,15,0.92);
        }
        .modal-success-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .success-checkmark-ring {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #fefce8;
            border: 3px solid #f59e0b;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            opacity: 0;
            transform: scale(0.3);
        }
        [data-theme="dark"] .success-checkmark-ring {
            background: rgba(245,158,11,0.12);
        }
        .modal-success-overlay.active .success-checkmark-ring {
            animation: successRingIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.1s forwards;
        }
        @keyframes successRingIn {
            0% { opacity: 0; transform: scale(0.3); }
            100% { opacity: 1; transform: scale(1); }
        }
        .success-checkmark-ring svg {
            width: 36px;
            height: 36px;
            stroke: #f59e0b;
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
        }
        .modal-success-overlay.active .success-checkmark-ring svg {
            animation: successCheckDraw 0.5s ease 0.4s forwards;
        }
        @keyframes successCheckDraw {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }
        .success-text-main {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 6px;
            opacity: 0;
        }
        .modal-success-overlay.active .success-text-main {
            animation: successTextIn 0.3s ease 0.55s forwards;
        }
        .success-text-sub {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            max-width: 260px;
            line-height: 1.5;
            opacity: 0;
        }
        .modal-success-overlay.active .success-text-sub {
            animation: successTextIn 0.3s ease 0.65s forwards;
        }
        @keyframes successTextIn {
            0% { opacity: 0; transform: translateY(8px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .success-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            pointer-events: none;
        }
        .success-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            opacity: 0;
        }
        .modal-success-overlay.active .success-particle {
            animation: particleBurst 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        @keyframes particleBurst {
            0% { opacity: 1; transform: translate(0,0) scale(1); }
            100% { opacity: 0; transform: var(--particle-end) scale(0); }
        }
        .success-cart-hint {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 16px;
            padding: 8px 16px;
            background: var(--bg-hover);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            opacity: 0;
        }
        .modal-success-overlay.active .success-cart-hint {
            animation: successTextIn 0.3s ease 0.75s forwards;
        }
        .success-cart-hint svg {
            width: 14px;
            height: 14px;
            stroke: var(--text-secondary);
        }

        /* =============================================
           CONFIRMATION PAGE
           ============================================= */
        .confirm-page-overlay {
            position: fixed;
            inset: 0;
            z-index: 12000;
            background: var(--bg);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
        }
        .confirm-page-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .confirm-page {
            width: 100%;
            max-width: 560px;
            padding: 48px 32px 64px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* Animated checkmark */
        .confirm-check-ring {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: #f0fdf4;
            border: 3px solid #86efac;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) 0.15s;
        }
        [data-theme="dark"] .confirm-check-ring {
            background: rgba(74,222,128,0.1);
            border-color: rgba(74,222,128,0.35);
        }
        .confirm-page-overlay.active .confirm-check-ring {
            opacity: 1;
            transform: scale(1);
        }
        .confirm-check-ring svg {
            width: 32px;
            height: 32px;
            stroke: #16a34a;
            stroke-dasharray: 50;
            stroke-dashoffset: 50;
        }
        [data-theme="dark"] .confirm-check-ring svg {
            stroke: #4ade80;
        }
        .confirm-page-overlay.active .confirm-check-ring svg {
            animation: confirmCheckDraw 0.5s ease 0.35s forwards;
        }
        @keyframes confirmCheckDraw {
            to { stroke-dashoffset: 0; }
        }
        .confirm-heading {
            font-size: 24px;
            font-weight: 800;
            color: var(--text);
            text-align: center;
            margin-bottom: 6px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-heading {
            animation: confirmFadeUp 0.35s ease 0.35s forwards;
        }
        @keyframes confirmFadeUp {
            to { opacity: 1; transform: translateY(0); }
        }
        .confirm-subheading {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.5;
            margin-bottom: 28px;
            max-width: 420px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-subheading {
            animation: confirmFadeUp 0.35s ease 0.45s forwards;
        }
        /* Summary card */
        .confirm-summary {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-summary {
            animation: confirmFadeUp 0.35s ease 0.5s forwards;
        }
        .confirm-summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .confirm-summary-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
        }
        .confirm-ref {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg);
            padding: 3px 8px;
            border-radius: 6px;
            letter-spacing: 0.04em;
        }
        .confirm-summary-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .confirm-item-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .confirm-item-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--brand-primary);
            flex-shrink: 0;
            margin-top: 5px;
        }
        .confirm-item-info {
            flex: 1;
            min-width: 0;
        }
        .confirm-item-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .confirm-item-detail {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 1px;
        }
        .confirm-item-price {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            flex-shrink: 0;
        }
        .confirm-summary-total {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 14px;
            padding-top: 12px;
            border-top: 1px dashed var(--border);
        }
        .confirm-total-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
        }
        .confirm-total-value {
            font-size: 16px;
            font-weight: 800;
            color: var(--text);
        }
        /* Next steps section */
        .confirm-next-steps {
            width: 100%;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-next-steps {
            animation: confirmFadeUp 0.35s ease 0.6s forwards;
        }
        .confirm-steps-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 14px;
        }
        .confirm-steps-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        .confirm-step {
            display: flex;
            gap: 14px;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
        }
        .confirm-step:last-child { border-bottom: none; }
        .confirm-step-num {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--brand-light);
            color: var(--brand-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }
        .confirm-step-content {
            flex: 1;
        }
        .confirm-step-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 2px;
        }
        .confirm-step-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.45;
        }
        /* Notifications row */
        .confirm-notify-row {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-notify-row {
            animation: confirmFadeUp 0.35s ease 0.7s forwards;
        }
        .confirm-notify-card {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
        }
        .confirm-notify-card svg {
            width: 18px;
            height: 18px;
            color: var(--brand-primary);
            flex-shrink: 0;
        }
        .confirm-notify-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
        }
        .confirm-notify-hint {
            font-size: 10px;
            color: var(--text-secondary);
        }
        /* Contact section */
        .confirm-contact {
            width: 100%;
            text-align: center;
            padding: 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 24px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-contact {
            animation: confirmFadeUp 0.35s ease 0.75s forwards;
        }
        .confirm-contact-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .confirm-contact-email {
            font-size: 14px;
            font-weight: 600;
            color: var(--brand-primary);
            text-decoration: none;
        }
        .confirm-contact-email:hover { text-decoration: underline; }
        /* CTA button */
        .confirm-back-btn {
            padding: 14px 32px;
            border-radius: 12px;
            border: 1.5px solid var(--border);
            background: transparent;
            color: var(--text);
            font-family: var(--ff);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(10px);
        }
        .confirm-page-overlay.active .confirm-back-btn {
            animation: confirmFadeUp 0.35s ease 0.8s forwards;
        }
        .confirm-back-btn:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }
        /* Footer logo */
        .confirm-footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            opacity: 0;
        }
        .confirm-page-overlay.active .confirm-footer-logo {
            animation: confirmFadeUp 0.35s ease 0.85s forwards;
        }
        .confirm-footer-logo span {
            font-size: 10px;
            color: var(--text-secondary);
            opacity: 0.5;
        }
        .confirm-footer-logo svg {
            height: 13px;
            width: auto;
            opacity: 0.3;
            filter: grayscale(1);
        }
        @media (max-width: 420px) {
            .confirm-page { padding: 32px 18px 48px; }
            .confirm-heading { font-size: 20px; }
            .confirm-subheading { font-size: 13px; }
            .confirm-notify-row { flex-direction: column; }
        }

        /* Desktop: hide the mobile-only bottom bar */
        .modal-bottom-bar {
            display: none;
        }
        /* Desktop: hide the details toggle (mobile only) */
        .modal-details-toggle {
            display: none;
        }

        /* Responsive - Modal */
        @media (max-width: 768px) {
            /* Overlay: full screen */
            .booking-modal-overlay {
                padding: 0;
                align-items: flex-end;
            }

            /* Modal: full-height sheet, slide up */
            .booking-modal {
                max-height: 100vh;
                max-height: 100dvh;
                height: 100vh;
                height: 100dvh;
                border-radius: 0;
                max-width: 100%;
                transform: translateY(100%);
                transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
            }
            .booking-modal-overlay.active .booking-modal {
                transform: translateY(0);
            }

            /* Header: compact, non-scrolling */
            .modal-header {
                padding: 12px 16px;
                gap: 10px;
                flex-shrink: 0;
            }
            .modal-header-logo {
                width: 34px;
                height: 34px;
                border-radius: 8px;
            }
            .modal-header-logo img {
                width: 24px;
                height: 24px;
            }
            .modal-header-info h2 {
                font-size: 15px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .modal-header-sub {
                font-size: 11px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .modal-close-btn {
                width: 34px;
                height: 34px;
            }

            /* Body: single-column scroll area between header and bottom bar */
            .modal-body {
                grid-template-columns: 1fr;
                overflow-y: auto;
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
                flex: 1;
                min-height: 0;
            }

            /* Mobile reorder: booking form first, facility info second */
            .modal-right { order: 1; }
            .modal-left { order: 2; border-top: 1px solid var(--border); }

            /* Left panel: image + collapsible details */
            .modal-left {
                border-right: none;
                border-bottom: none;
                max-height: none;
                overflow: visible;
                padding: 0;
            }

            /* Facility image: edge-to-edge, shorter */
            .modal-facility-image {
                aspect-ratio: 2.4/1;
                margin-bottom: 0;
                border-radius: 0;
            }

            /* Details toggle: visible on mobile */
            .modal-details-toggle {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 16px;
                background: var(--surface);
                border: none;
                border-bottom: 1px solid var(--border);
                width: 100%;
                font-family: var(--ff);
                font-size: 12px;
                font-weight: 600;
                color: var(--text-secondary);
                cursor: pointer;
                letter-spacing: 0.03em;
                text-transform: uppercase;
            }
            .modal-details-toggle svg {
                width: 16px;
                height: 16px;
                color: var(--text-secondary);
                transition: transform 0.25s ease;
                flex-shrink: 0;
            }
            .modal-details-toggle.expanded svg {
                transform: rotate(180deg);
            }

            /* Collapsible content area */
            .modal-details-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.35s ease;
            }
            .modal-details-content.expanded {
                max-height: 3000px;
            }
            .modal-details-inner {
                padding: 14px 16px 16px;
                border-bottom: 1px solid var(--border);
            }

            /* Section titles */
            .modal-section-title {
                font-size: 11px;
                margin-bottom: 8px;
            }

            /* Info grid */
            .modal-info-grid {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
                margin-bottom: 14px;
            }
            .modal-info-item {
                padding: 8px 10px;
            }
            .modal-info-item svg {
                width: 15px;
                height: 15px;
            }
            .modal-info-item .info-label {
                font-size: 10px;
            }
            .modal-info-item .info-value {
                font-size: 12px;
            }

            /* Features */
            .modal-features {
                margin-bottom: 14px;
                gap: 4px;
            }
            .modal-feature-tag {
                padding: 3px 8px;
                font-size: 10px;
            }

            /* Amenities */
            .modal-amenities-grid {
                grid-template-columns: 1fr;
                gap: 5px;
                margin-bottom: 10px;
            }
            .modal-amenity-item {
                padding: 8px 10px;
            }
            .modal-amenity-name {
                font-size: 12px;
            }
            .modal-amenity-price {
                font-size: 11px;
            }

            /* Right panel: booking form */
            .modal-right {
                padding: 14px 16px 16px;
                gap: 12px;
                overflow: visible;
                border-top: none;
            }

            /* Price banner */
            .modal-price-banner {
                padding: 10px 12px;
                border-radius: 8px;
            }
            .modal-price-amount {
                font-size: 20px;
            }
            .modal-price-availability {
                font-size: 11px;
            }

            /* Form fields */
            .modal-form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .modal-form-label {
                font-size: 12px;
            }
            .modal-form-input,
            .modal-form-select {
                padding: 12px;
                font-size: 16px; /* 16px prevents iOS zoom on focus */
            }
            .modal-date-field {
                padding: 12px;
            }
            .modal-date-display {
                font-size: 14px;
            }
            .modal-datepicker {
                left: 0;
                right: 0;
                width: auto;
            }

            /* Time slots */
            .modal-slots-grid {
                grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
                gap: 5px;
            }
            .modal-slot-btn {
                padding: 9px 4px;
                font-size: 12px;
            }

            /* Notice */
            .modal-notice {
                font-size: 12px;
                padding: 8px 12px;
            }

            /* Divider */
            .modal-divider {
                margin: 2px 0;
            }

            /* Policies */
            .modal-policy {
                padding: 8px;
            }

            /* Hide the inline btn-group and login-hint (moved to bottom bar) */
            .modal-right > .modal-btn-group,
            .modal-right > .modal-login-hint {
                display: none;
            }

            /* Fixed bottom CTA bar */
            .modal-bottom-bar {
                display: flex;
                flex-direction: column;
                flex-shrink: 0;
                background: var(--bg);
                border-top: 1px solid var(--border);
                padding: 10px 16px;
                padding-bottom: max(10px, env(safe-area-inset-bottom));
                gap: 8px;
                box-shadow: 0 -4px 16px rgba(0,0,0,0.08);
            }
            .modal-bottom-bar .modal-btn-row {
                display: flex;
                gap: 8px;
            }
            .modal-bottom-bar .modal-book-btn {
                flex: 1;
                padding: 13px 12px;
                font-size: 13px;
                border-radius: 10px;
            }
            .modal-bottom-bar .modal-book-btn svg {
                width: 15px;
                height: 15px;
            }
            .modal-bottom-bar .modal-login-hint {
                display: block;
                text-align: center;
                font-size: 10px;
                padding: 0;
                margin: 0;
            }
            .modal-bottom-bar .modal-validation-hint {
                font-size: 12px;
                padding: 8px 12px;
            }
            /* Hide desktop hint on mobile, show mobile one */
            .modal-right > .modal-validation-hint {
                display: none;
            }
            /* Cart drawer mobile */
            .cart-drawer {
                width: 100%;
                max-width: 100vw;
            }
            .cart-drawer-header { padding: 16px 20px; }
            .cart-drawer-items { padding: 12px 16px; }
            .cart-drawer-footer { padding: 16px 20px; }
            .header-cart-btn {
                width: 36px;
                height: 36px;
            }
            .header-cart-btn svg { width: 16px; height: 16px; }
            .header-cart-badge { width: 18px; height: 18px; font-size: 10px; }
            /* Success overlay on mobile full-sheet modal */
            .modal-success-overlay {
                border-radius: 16px 16px 0 0;
            }
        }

        @media (max-width: 420px) {
            .modal-header-info h2 {
                font-size: 13px;
            }
            .modal-header-sub {
                font-size: 10px;
            }
            .modal-info-grid {
                grid-template-columns: 1fr;
            }
            .modal-price-amount {
                font-size: 18px;
            }
            .modal-bottom-bar .modal-book-btn {
                padding: 12px 10px;
                font-size: 12px;
            }
        }

        /* Footer */
        .footer {
            margin-top: 0;
        }

        /* Footer CTA */
        .footer-cta {
            background: linear-gradient(135deg, #1a1a1a 0%, #111111 100%);
            color: white;
            text-align: center;
        }

        .footer-cta-inner {
            max-width: 600px;
            margin: 0 auto;
            padding: 36px 32px;
        }

        .footer-cta-inner h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .footer-cta-inner p {
            font-size: 15px;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        .footer-cta-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-cta-primary {
            padding: 12px 24px;
            background: white;
            color: #1a1a1a;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.15s;
        }

        .btn-cta-primary:hover {
            background: #f5f5f5;
            transform: translateY(-1px);
        }

        .btn-cta-secondary {
            padding: 12px 24px;
            background: transparent;
            color: white;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.15s;
        }

        .btn-cta-secondary:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.6);
        }

        /* Footer Main */
        .footer-main {
            background: #000000;
            text-align: center;
        }

        .footer-main-inner {
            max-width: 600px;
            margin: 0 auto;
            padding: 40px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .footer-logo-link {
            display: inline-block;
        }

        .pp-logo-footer {
            height: 36px;
            width: auto;
        }

        .footer-tagline {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }

        .footer-social {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .social-link {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            color: rgba(255,255,255,0.6);
            transition: all 0.15s ease;
        }

        .social-link:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .social-link svg {
            width: 18px;
            height: 18px;
        }

        .footer-links-simple {
            display: flex;
            gap: 24px;
            justify-content: center;
        }

        .footer-links-simple a {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
            text-decoration: none;
            transition: color 0.15s;
        }

        .footer-links-simple a:hover {
            color: white;
        }

        /* Footer Bottom */
        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.1);
            background: #000000;
        }

        .footer-bottom-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255,255,255,0.35);
            flex-wrap: wrap;
        }

        .footer-dot {
            color: rgba(255,255,255,0.15);
        }

        .footer-bottom-inner a {
            color: rgba(255,255,255,0.35);
            text-decoration: none;
            transition: color 0.15s;
        }

        .footer-bottom-inner a:hover {
            color: rgba(255,255,255,0.7);
        }

        @media (max-width: 768px) {
            .demo-palette {
                display: none !important;
            }
            .top-bar {
                padding: 12px 16px;
                flex-direction: column;
                gap: 12px;
            }

            .top-bar-left {
                width: 100%;
                justify-content: center;
            }

            .top-bar-logo {
                display: flex;
                justify-content: center;
            }

            .top-bar-tagline {
                display: none;
            }

            .top-bar-right {
                width: 100%;
                justify-content: center;
            }

            .header-inner {
                padding: 6px 16px;
                position: relative;
            }

            .header-left {
                width: auto;
                min-width: 0;
            }

            .district-brand {
                gap: 8px;
            }

            .district-info {
                min-width: 0;
            }

            .district-location {
                display: none;
            }

            .district-info h1 {
                font-size: 13px;
                white-space: nowrap;
            }

            .powered-by-strip {
                padding: 10px 16px;
            }

            .powered-by {
                font-size: 11px;
                gap: 6px;
                padding: 5px 12px;
            }

            .powered-by-wordmark {
                height: 15px;
            }

            .header-right {
                gap: 6px;
                flex-shrink: 0;
            }

            .header-user-info {
                display: none;
            }

            .header-user {
                padding: 3px;
                border: none;
            }

            .header-user-avatar {
                width: 28px;
                height: 28px;
                font-size: 11px;
            }

            .header-help-btn {
                width: 28px;
                height: 28px;
            }

            .header-help-btn svg {
                width: 15px;
                height: 15px;
            }

            .district-logo {
                width: 28px;
                height: 28px;
                border-radius: 6px;
            }

            .district-logo svg {
                width: 16px;
                height: 16px;
            }

            .district-logo::after {
                height: 2px;
            }

            .hero-inner {
                padding: 32px 16px 28px;
            }

            .hero h2 {
                font-size: 22px;
            }

            .hero p {
                font-size: 14px;
            }

            .main {
                padding: 16px;
            }

            .section-header {
                margin-bottom: 16px;
            }

            .section-title {
                font-size: 20px;
            }

            .facility-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .facility-card {
                width: 100%;
            }

            .time-slots {
                justify-content: flex-start;
            }

            .time-slot {
                padding: 10px 12px;
                font-size: 13px;
            }

            .footer-cta-inner {
                flex-direction: column;
                text-align: center;
                padding: 28px 24px;
            }

            .footer-cta-actions {
                flex-direction: column;
                width: 100%;
            }

            .footer-cta-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .footer-main-inner {
                grid-template-columns: 1fr;
                gap: 32px;
                padding: 32px 16px;
            }

            .footer-nav {
                grid-template-columns: 1fr 1fr;
            }

            .footer-bottom-inner {
                flex-direction: column;
                gap: 6px;
                text-align: center;
                font-size: 12px;
            }

            .footer-bottom-inner .footer-dot {
                display: none;
            }

            .footer-bottom-inner a {
                display: inline;
            }

            .footer-bottom-inner a + a {
                margin-left: 16px;
            }

            .footer-legal {
                flex-wrap: wrap;
                justify-content: center;
                gap: 16px;
            }
        }

        @media (max-width: 480px) {
            .district-info h1 {
                font-size: 14px;
            }

            .header-inner {
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Demo Switcher -->
    <div class="demo-bar">
        <span class="demo-bar-label">Demo</span>
        <select id="districtSwitcher" onchange="switchDistrict(this.value)">
            <option value="reynoldsburg">Reynoldsburg City Schools - Reynoldsburg, OH</option>
            <option value="ascension">Ascension Parish Schools - Gonzales, LA</option>
            <option value="lovejoy">Lovejoy ISD - Lucas, TX</option>
            <option value="princeedward">Prince Edward County - Farmville, VA</option>
        </select>
        <div class="demo-palette" id="demoPalette">
            <div class="demo-input-label">Primary
                <div class="demo-swatch" id="swatchPrimary" onclick="toggleColorDropdown('primary')"></div>
                <input type="color" id="customColor1" value="#6B2D8B" onchange="updateDistrictColors()">
                <div class="demo-color-dropdown" id="ddPrimary">
                    <div class="demo-dd-label">District Brand</div>
                    <div class="demo-dd-swatches" id="ddPrimarySwatches"></div>
                    <div class="demo-dd-hex-row">
                        <input type="text" class="demo-dd-hex" id="hexPrimary" maxlength="7" placeholder="#000000" onkeydown="if(event.key==='Enter'){applyHexInput('primary')}">
                        <button class="demo-dd-more" onclick="openNativePicker('customColor1','primary')">More</button>
                    </div>
                </div>
            </div>
            <button class="demo-swap-btn" onclick="swapDistrictColors()" title="Swap primary and secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
            </button>
            <div class="demo-input-label">Secondary
                <div class="demo-swatch" id="swatchSecondary" onclick="toggleColorDropdown('secondary')"></div>
                <input type="color" id="customColor2" value="#f5a623" onchange="updateDistrictColors()">
                <div class="demo-color-dropdown" id="ddSecondary">
                    <div class="demo-dd-label">District Brand</div>
                    <div class="demo-dd-swatches" id="ddSecondarySwatches"></div>
                    <div class="demo-dd-hex-row">
                        <input type="text" class="demo-dd-hex" id="hexSecondary" maxlength="7" placeholder="#000000" onkeydown="if(event.key==='Enter'){applyHexInput('secondary')}">
                        <button class="demo-dd-more" onclick="openNativePicker('customColor2','secondary')">More</button>
                    </div>
                </div>
            </div>
            <span class="demo-divider"></span>
            <div class="demo-input-label">Button
                <div class="demo-swatch" id="swatchButton" onclick="toggleColorDropdown('button')"></div>
                <input type="color" id="customColorCta" value="#6B2D8B" onchange="updateDistrictColors()">
                <div class="demo-color-dropdown" id="ddButton">
                    <div class="demo-dd-label">District Brand</div>
                    <div class="demo-dd-swatches" id="ddButtonSwatches"></div>
                    <div class="demo-dd-hex-row">
                        <input type="text" class="demo-dd-hex" id="hexButton" maxlength="7" placeholder="#000000" onkeydown="if(event.key==='Enter'){applyHexInput('button')}">
                        <button class="demo-dd-more" onclick="openNativePicker('customColorCta','button')">More</button>
                    </div>
                </div>
            </div>
            <div class="demo-input-label">Header
                <div class="demo-swatch" id="swatchHeader" onclick="toggleColorDropdown('header')"></div>
                <input type="color" id="customColorHeader" value="#6B2D8B" onchange="updateDistrictColors()">
                <div class="demo-color-dropdown" id="ddHeader">
                    <div class="demo-dd-label">District Brand</div>
                    <div class="demo-dd-swatches" id="ddHeaderSwatches"></div>
                    <div class="demo-dd-hex-row">
                        <input type="text" class="demo-dd-hex" id="hexHeader" maxlength="7" placeholder="#000000" onkeydown="if(event.key==='Enter'){applyHexInput('header')}">
                        <button class="demo-dd-more" onclick="openNativePicker('customColorHeader','header')">More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <div class="header-left">
                <div class="district-brand">
                    <div class="district-logo" id="districtLogo">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/>
                        </svg>
                    </div>
                    <div class="district-info">
                        <h1>Lovejoy ISD</h1>
                        <div class="district-location">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            Lucas, Texas
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="header-cart-btn" id="cartBtn" title="Your reservations" onclick="toggleCartDrawer()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span class="header-cart-badge" id="cartBadge">0</span>
                </button>
                <div class="header-help-wrapper" id="helpMenuWrapper">
                    <button class="header-help-btn" title="Help & Support" onclick="document.getElementById('helpMenuWrapper').classList.toggle('open')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    </button>
                    <div class="help-popover">
                        <div class="help-popover-title">Need help?</div>
                        <div class="help-popover-text">Our team is here to help you find and book the right space. Reach out anytime.</div>
                        <a href="/cdn-cgi/l/email-protection#573e3931381727253634233e3432273b3639793e38" class="help-popover-email">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 7l-10 7L2 7"/></svg>
                            Contact us
                        </a>
                    </div>
                </div>
                <div class="header-user-wrapper" id="userMenuWrapper">
                    <div class="header-user" onclick="document.getElementById('userMenuWrapper').classList.toggle('open')">
                        <div class="header-user-avatar"><img src="https://res.cloudinary.com/dpj2i1xui/image/upload/v1770056001/brochu_py2zps.jpg" alt="John Brochu" style="width:100%;height:100%;object-fit:cover;border-radius:50%"></div>
                        <div class="header-user-info">
                            <span class="header-user-name">John Brochu</span>
                            <span class="header-user-role">Participant</span>
                        </div>
                    </div>
                    <div class="header-user-menu">
                        <div class="header-user-menu-info">
                            <div class="header-user-menu-name">John Brochu</div>
                            <div class="header-user-menu-role">Participant</div>
                        </div>
                        <button class="header-user-menu-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            Profile
                        </button>
                        <button class="header-user-menu-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            Favorites
                        </button>
                        <button class="header-user-menu-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Teams
                        </button>
                        <button class="header-user-menu-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            Reservations
                        </button>
                        <button class="header-user-menu-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                            Preferences
                        </button>
                        <button class="header-user-menu-item signout">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="hero-inner">
            <div class="hero-content">
                <div class="hero-location" id="heroLocation">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                    <span id="heroLocationText">Lucas, Texas</span>
                </div>
                <h2>Find and Book a Space</h2>
                <p>Browse facilities, check availability, and book your space online.</p>
            </div>
        </div>
    </section>

    <!-- Powered By -->
    <div class="powered-by-strip">
        <div class="powered-by">
            <span>Powered by</span>
            <svg viewBox="0 0 396.37 66.7" class="powered-by-wordmark">
              <g>
                <path fill="#f15a29" d="M.72,49.7c-.24-.04-.48-.09-.72-.14.24.05.48.09.72.14Z"/>
                <g>
                  <path fill="#00a84f" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M38.52,31.97l-18.72-7.88c-1.03-.43-1.86-1.68-1.86-2.8v-8.53c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                  <path fill="#00a84f" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M29.74,48.22v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                </g>
                <g>
                  <path fill="#0076bb" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M24.43,21.29L5.71,13.41c-1.03-.43-1.86-1.68-1.86-2.8V2.08c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                  <path fill="#0076bb" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M15.65,37.54v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                </g>
                <g fill="#0076bb">
                  <path d="M87.8,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l1.32-5.79h18.24c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                  <path d="M130.29,43.77h-9.21l-3.92-5.89h-10.58l-1.03,5.89h-6.88l2-11.38h19.36c2.29,0,4.29-1.1,4.29-2.89,0-1.46-1.26-2.2-3.39-2.2h-19.36l1.33-5.79h18.5c4.66,0,10.18,1.43,10.18,6.75,0,4.02-2.89,7.42-7.18,8.25.63.57,1.33,1.36,2.56,2.93l3.36,4.32Z"/>
                  <path d="M138,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                  <path d="M190.18,38.05l-5.42,5.72h-11.18c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h15.6l-5.45,5.79h-11.18c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h15.6Z"/>
                  <path d="M216.65,21.52l-1.08,5.79h-8l-2.93,16.46h-6.88l2.89-16.46h-10.44l5.52-5.79h20.93Z"/>
                  <path d="M221.18,43.77h-6.88l3.96-22.25h6.85l-3.93,22.25Z"/>
                  <path d="M251.47,38.05l-1.64,5.72h-14.05c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h14.93l-1.83,5.79h-14.14c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h14.69Z"/>
                  <path d="M278.35,38.05l-4.59,5.72h-21.42l3.96-22.25h24.88l-4.62,5.79h-14.4l-.47,2.66h16.73l-3.92,5.06h-13.7l-.53,3.03h18.09Z"/>
                  <path d="M298.05,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l4.14-5.79h15.42c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                  <path d="M334.61,38.05l-5.49,5.72h-19.66l3.96-22.25h6.85l-2.93,16.53h17.26Z"/>
                  <path d="M342.3,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                  <path d="M386.02,42.94l-11.47-12.24-2.3,13.07h-6.25l3.23-18.46c.5-2.96,2.46-4.16,4.52-4.16.83,0,1.66.2,2.56,1.2l11.47,12.24,2.33-13.07h6.25l-3.29,18.43c-.53,2.96-2.49,4.19-4.49,4.19-.93,0-1.63-.2-2.56-1.2Z"/>
                </g>
              </g>
            </svg>
        </div>
    </div>

    <!-- Search Bar -->
    <section class="search-bar-section" id="facilities">
        <div class="search-bar-inner">
            <div class="search-row">
                <div class="search-bar">
                    <div class="search-field date-field" id="dateField">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <input type="hidden" id="searchDate">
                        <span class="search-placeholder date-trigger" id="datePlaceholder">Any date</span>
                        <div class="custom-datepicker" id="customDatepicker">
                            <div class="dp-header">
                                <button class="dp-nav" id="dpPrev" type="button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
                                <span class="dp-month" id="dpMonth"></span>
                                <button class="dp-nav" id="dpNext" type="button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
                            </div>
                            <div class="dp-weekdays">
                                <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                            </div>
                            <div class="dp-days" id="dpDays"></div>
                            <button class="dp-clear" id="dpClear" type="button">Clear date</button>
                        </div>
                    </div>
                    <div class="search-divider"></div>
                    <div class="search-field">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7" rx="1"/>
                            <rect x="14" y="3" width="7" height="7" rx="1"/>
                            <rect x="3" y="14" width="7" height="7" rx="1"/>
                            <rect x="14" y="14" width="7" height="7" rx="1"/>
                        </svg>
                        <select class="search-input" id="activityType">
                            <option value="">What are you planning?</option>
                            <optgroup label="Sports & Athletics">
                                <option value="badminton"> Badminton</option>
                                <option value="baseball"> Baseball / Softball</option>
                                <option value="basketball"> Basketball</option>
                                <option value="cheer"> Cheerleading</option>
                                <option value="cross-country"> Cross Country</option>
                                <option value="field-hockey"> Field Hockey</option>
                                <option value="fitness"> Fitness / Training</option>
                                <option value="football"> Football</option>
                                <option value="golf"> Golf</option>
                                <option value="gymnastics"> Gymnastics</option>
                                <option value="lacrosse"> Lacrosse</option>
                                <option value="martial-arts"> Martial Arts</option>
                                <option value="pickleball"> Pickleball</option>
                                <option value="soccer"> Soccer</option>
                                <option value="swimming"> Swimming / Diving</option>
                                <option value="tennis"> Tennis</option>
                                <option value="track"> Track & Field</option>
                                <option value="volleyball"> Volleyball</option>
                                <option value="weightlifting"> Weightlifting</option>
                                <option value="wrestling"> Wrestling</option>
                                <option value="yoga"> Yoga / Pilates</option>
                            </optgroup>
                            <optgroup label="Events & Performances">
                                <option value="awards"> Awards / Banquet</option>
                                <option value="concert"> Concert / Music</option>
                                <option value="dance"> Dance Recital</option>
                                <option value="fair"> Fair / Festival</option>
                                <option value="fundraiser"> Fundraiser</option>
                                <option value="graduation"> Graduation / Ceremony</option>
                                <option value="movie"> Movie Night</option>
                                <option value="party"> Party / Celebration</option>
                                <option value="pep-rally"> Pep Rally</option>
                                <option value="theater"> Theater / Performance</option>
                            </optgroup>
                            <optgroup label="Meetings & Classes">
                                <option value="class"> Class / Workshop</option>
                                <option value="meeting"> Meeting / Conference</option>
                                <option value="orientation"> Orientation</option>
                                <option value="professional-dev"> Professional Development</option>
                                <option value="testing"> Testing / Exams</option>
                                <option value="training"> Training Session</option>
                                <option value="tutoring"> Tutoring</option>
                            </optgroup>
                            <optgroup label="Community">
                                <option value="blood-drive"> Blood Drive</option>
                                <option value="camp"> Camp / Youth Program</option>
                                <option value="farmers-market"> Farmers Market</option>
                                <option value="health-screening"> Health Screening</option>
                                <option value="religious"> Religious Service</option>
                                <option value="scouts"> Scouts / Club Meeting</option>
                                <option value="voting"> Voting / Elections</option>
                                <option value="other"> Other</option>
                            </optgroup>
                        </select>
                    </div>
                    <button class="search-btn" id="searchBtn">
                        Search
                    </button>
                </div>
                
                <div class="search-row-right">
                    <button class="optional-filter-btn" id="toggleOptional">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="4" y1="21" x2="4" y2="14"/>
                            <line x1="4" y1="10" x2="4" y2="3"/>
                            <line x1="12" y1="21" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12" y2="3"/>
                            <line x1="20" y1="21" x2="20" y2="16"/>
                            <line x1="20" y1="12" x2="20" y2="3"/>
                            <line x1="1" y1="14" x2="7" y2="14"/>
                            <line x1="9" y1="8" x2="15" y2="8"/>
                            <line x1="17" y1="16" x2="23" y2="16"/>
                        </svg>
                        More options
                    </button>
                    
                    <div class="theme-toggle" id="themeToggle" onclick="document.documentElement.setAttribute('data-theme', document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark')">
                        <span class="theme-option light">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <line x1="12" y1="1" x2="12" y2="3"/>
                                <line x1="12" y1="21" x2="12" y2="23"/>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                <line x1="1" y1="12" x2="3" y2="12"/>
                                <line x1="21" y1="12" x2="23" y2="12"/>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                            </svg>
                            Light
                        </span>
                        <span class="theme-option dark">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                            Dark
                        </span>
                        <span class="theme-slider"></span>
                    </div>
                </div>
            </div>
            
            <!-- Optional Filters (expandable) -->
            <div class="optional-fields" id="optionalFields" style="display: none;">
                <div class="optional-field">
                    <label>Location</label>
                    <select id="searchSchool">
                        <option value="">All locations</option>
                        <option value="lovejoy-hs">Lovejoy High School</option>
                        <option value="willow-springs-ms">Willow Springs Middle School</option>
                        <option value="sloan-creek">Sloan Creek Intermediate</option>
                        <option value="hart-elem">Hart Elementary</option>
                        <option value="puster-elem">Puster Elementary</option>
                    </select>
                </div>
                <div class="optional-field">
                    <label>Facility type</label>
                    <select id="searchFacilityType">
                        <option value="">All facilities</option>
                        <option value="gymnasium">Gymnasium</option>
                        <option value="auditorium">Auditorium</option>
                        <option value="stadium">Stadium / Field</option>
                        <option value="pool">Pool / Aquatic</option>
                        <option value="meeting">Meeting Room</option>
                        <option value="classroom">Classroom</option>
                        <option value="cafeteria">Cafeteria</option>
                        <option value="outdoor">Outdoor Court</option>
                    </select>
                </div>
                <div class="optional-field amenities-field">
                    <label>Amenities</label>
                    <div class="amenities-multi">
                        <button type="button" class="amenities-btn" id="amenitiesBtn" onclick="document.getElementById('amenitiesPanel').classList.toggle('open'); this.classList.toggle('active')">
                            <span id="amenitiesBtnText">Any amenities</span>
                            <span class="amenities-chevron"></span>
                        </button>
                        <div class="amenities-panel" id="amenitiesPanel">
                            <label class="amenity-check"><input type="checkbox" value="wifi"><span class="check-box"></span>WiFi</label>
                            <label class="amenity-check"><input type="checkbox" value="av"><span class="check-box"></span>A/V Equipment</label>
                            <label class="amenity-check"><input type="checkbox" value="scoreboard"><span class="check-box"></span>Scoreboard</label>
                            <label class="amenity-check"><input type="checkbox" value="bleachers"><span class="check-box"></span>Bleachers</label>
                            <label class="amenity-check"><input type="checkbox" value="locker-rooms"><span class="check-box"></span>Locker Rooms</label>
                            <label class="amenity-check"><input type="checkbox" value="concessions"><span class="check-box"></span>Concessions</label>
                            <label class="amenity-check"><input type="checkbox" value="parking"><span class="check-box"></span>Parking</label>
                            <label class="amenity-check"><input type="checkbox" value="restrooms"><span class="check-box"></span>Restrooms</label>
                            <label class="amenity-check"><input type="checkbox" value="climate-control"><span class="check-box"></span>Climate Control</label>
                            <label class="amenity-check"><input type="checkbox" value="stage"><span class="check-box"></span>Stage</label>
                            <label class="amenity-check"><input type="checkbox" value="kitchen"><span class="check-box"></span>Kitchen Access</label>
                        </div>
                    </div>
                </div>
                <div class="optional-field range-field">
                    <label>Duration</label>
                    <div class="range-wrapper">
                        <span class="range-value" id="durationValue">2 hours</span>
                        <input type="range" id="searchDuration" min="1" max="8" value="2" step="1" oninput="document.getElementById('durationValue').textContent = ['1 hour','2 hours','3 hours','4 hours','5 hours','6 hours','7 hours','8 hours'][this.value - 1]">
                        <div class="range-labels">
                            <span>1 hr</span>
                            <span>8 hrs</span>
                        </div>
                    </div>
                </div>
                <div class="optional-field range-field">
                    <label>Group size</label>
                    <div class="range-wrapper">
                        <span class="range-value" id="groupSizeValue">Up to 50</span>
                        <input type="range" id="searchGuests" min="0" max="6" value="2" step="1" oninput="document.getElementById('groupSizeValue').textContent = ['Any size','Up to 10','Up to 50','Up to 100','Up to 200','Up to 500','500+'][this.value]">
                        <div class="range-labels">
                            <span>Any</span>
                            <span>500+</span>
                        </div>
                    </div>
                </div>
                <div class="optional-fields-actions">
                    <button class="optional-fields-clear" id="optionalClear" type="button">Clear Filters</button>
                    <button class="optional-fields-apply" id="optionalApply" type="button">Apply Filters</button>
                </div>
                <button class="optional-fields-collapse" id="optionalCollapse" type="button" aria-label="Collapse filters">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
                </button>
            </div>
        </div>
    </section>

    <!-- Main -->
    <main class="main">
        <!-- Results Bar -->
        <div class="results-bar">
            <div class="results-left">
                <div class="filter-chips" id="filterChips" style="display: none;">
                    <span class="filter-chip" id="dateChip" style="display: none;">
                        <span class="chip-text" id="dateChipText"></span>
                        <button class="chip-remove" data-filter="date">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </span>
                    <span class="filter-chip" id="activityChip" style="display: none;">
                        <span class="chip-text" id="activityChipText"></span>
                        <button class="chip-remove" data-filter="activity">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </span>
                    <button class="clear-all-filters" id="clearAllFilters">Clear all</button>
                </div>
            </div>
            <div class="results-right">
                <span class="results-count" id="resultsCount">4 spaces</span>
                <button class="sort-toggle" id="sortToggle" title="Sort facilities">
                    <span class="sort-label">A-Z</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M19 12l-7 7-7-7"/></svg>
                </button>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" id="gridViewBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                        </svg>
                    </button>
                    <button class="view-btn" data-view="calendar" id="calendarViewBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Facility Grid -->
        <div class="facility-grid" id="facilityGrid">
            <!-- Card 1 -->
            <div class="facility-card">
                <div class="facility-image">
                    <img src="https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format" alt="Main Gym" loading="lazy">
                    <div class="weather-badge">
                        <span class="weather-badge-desc">Indoors</span>
                    </div>
                    <button class="favorite-btn" onclick="this.classList.toggle('active')">
                        <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </button>
                    <span class="availability-indicator medium" title="Limited availability">
                        <span class="availability-dot"></span>
                    </span>
                </div>
                <div class="facility-body">
                    <div class="facility-type-icon"><svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg></div>
                    <h3 class="facility-name">Main Gym</h3>
                    <div class="facility-location">Lovejoy High School</div>
                    <div class="facility-price-line">$75/hr</div>
                    <div class="card-divider"></div>
                    <div class="facility-meta-line">
                        <span>Gymnasium</span>
                        <span class="meta-dot"></span>
                        <span>500 capacity</span>
                    </div>
                    <div class="facility-stats">
                        <div class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Last booked 2hrs ago</div>
                    </div>
                    <div class="time-slots" data-has-search="false">
                        <button class="btn-check-availability">View Details</button>
                    </div>
                    <div class="time-slots-searched" data-has-search="true" style="display: none;">
                        <button class="time-slot">10:00 AM</button>
                        <button class="time-slot">2:00 PM</button>
                        <button class="time-slot">5:00 PM</button>
                    </div>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="facility-card">
                <div class="facility-image">
                    <img src="https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format" alt="Leopard Stadium" loading="lazy">
                    <div class="weather-badge">
                        <span class="weather-badge-icon"></span>
                        <span class="weather-badge-temp">50F</span>
                        <span class="weather-badge-divider"></span>
                        <span class="weather-badge-desc">Sunny</span>
                    </div>
                    <button class="favorite-btn" onclick="this.classList.toggle('active')">
                        <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </button>
                    <span class="availability-indicator high" title="High availability">
                        <span class="availability-dot"></span>
                    </span>
                </div>
                <div class="facility-body">
                    <div class="facility-type-icon"><svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg></div>
                    <h3 class="facility-name">Leopard Stadium</h3>
                    <div class="facility-location">Lovejoy High School</div>
                    <div class="facility-price-line">$150/hr</div>
                    <div class="card-divider"></div>
                    <div class="facility-meta-line">
                        <span>Field</span>
                        <span class="meta-dot"></span>
                        <span>2,000 capacity</span>
                    </div>
                    <div class="facility-stats">
                        <div class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Last booked 3hrs ago</div>
                    </div>
                    <div class="time-slots" data-has-search="false">
                        <button class="btn-check-availability">View Details</button>
                    </div>
                    <div class="time-slots-searched" data-has-search="true" style="display: none;">
                        <button class="time-slot">9:00 AM</button>
                        <button class="time-slot">12:00 PM</button>
                        <button class="time-slot">6:00 PM</button>
                        <button class="time-slot">7:00 PM</button>
                    </div>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="facility-card">
                <div class="facility-image">
                    <img src="https://images.unsplash.com/photo-1596522354195-e84ae3c98731?w=600&h=360&fit=crop&auto=format" alt="Performing Arts Center" loading="lazy">
                    <div class="weather-badge">
                        <span class="weather-badge-desc">Indoors</span>
                    </div>
                    <button class="favorite-btn" onclick="this.classList.toggle('active')">
                        <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </button>
                    <span class="availability-indicator low" title="Almost full">
                        <span class="availability-dot"></span>
                    </span>
                </div>
                <div class="facility-body">
                    <div class="facility-type-icon"><svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg></div>
                    <h3 class="facility-name">Performing Arts Center</h3>
                    <div class="facility-location">Lovejoy High School</div>
                    <div class="facility-price-line">$200/hr</div>
                    <div class="card-divider"></div>
                    <div class="facility-meta-line">
                        <span>Auditorium</span>
                        <span class="meta-dot"></span>
                        <span>750 seats</span>
                    </div>
                    <div class="facility-stats">
                        <div class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Last booked 5hrs ago</div>
                    </div>
                    <div class="time-slots" data-has-search="false">
                        <button class="btn-check-availability">View Details</button>
                    </div>
                    <div class="time-slots-searched" data-has-search="true" style="display: none;">
                        <button class="time-slot">11:00 AM</button>
                        <button class="time-slot">4:00 PM</button>
                    </div>
                </div>
            </div>

            <!-- Card 4 -->
            <div class="facility-card">
                <div class="facility-image">
                    <img src="https://images.unsplash.com/photo-1740635341299-3b8e3490f546?w=600&h=360&fit=crop&auto=format" alt="Gymnasium" loading="lazy">
                    <div class="weather-badge">
                        <span class="weather-badge-desc">Indoors</span>
                    </div>
                    <button class="favorite-btn" onclick="this.classList.toggle('active')">
                        <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    </button>
                    <span class="availability-indicator high" title="High availability">
                        <span class="availability-dot"></span>
                    </span>
                </div>
                <div class="facility-body">
                    <div class="facility-type-icon"><svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg></div>
                    <h3 class="facility-name">Gymnasium</h3>
                    <div class="facility-location">Hart Elementary</div>
                    <div class="facility-price-line">$40/hr</div>
                    <div class="card-divider"></div>
                    <div class="facility-meta-line">
                        <span>Gymnasium</span>
                        <span class="meta-dot"></span>
                        <span>200 capacity</span>
                    </div>
                    <div class="facility-stats">
                        <div class="stat-item"><svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> Last booked 1hr ago</div>
                    </div>
                    <div class="time-slots" data-has-search="false">
                        <button class="btn-check-availability">View Details</button>
                    </div>
                    <div class="time-slots-searched" data-has-search="true" style="display: none;">
                        <button class="time-slot">9:00 AM</button>
                        <button class="time-slot">1:00 PM</button>
                        <button class="time-slot">3:00 PM</button>
                        <button class="time-slot">7:00 PM</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty state for grid view -->
        <div class="empty-state" id="gridEmptyState" style="display: none;">
            <div class="empty-state-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
            </div>
            <h3 class="empty-state-title" id="gridEmptyTitle">No facilities found</h3>
            <p class="empty-state-text" id="gridEmptyText">Try adjusting your filters or clearing your search to see available spaces.</p>
            <button class="empty-state-btn" id="gridEmptyClear">Clear all filters</button>
        </div>

        <!-- Calendar View (split panel) -->
        <div class="calendar-view" id="calendarView">
            <!-- Left: Calendar -->
            <div class="calendar-panel">
                <div class="calendar-header">
                    <button class="calendar-nav" id="calendarPrev">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>
                    <h3 class="calendar-month" id="calendarMonth">February 2026</h3>
                    <button class="calendar-nav" id="calendarNext">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </button>
                </div>
                <div class="calendar-weekdays">
                    <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div class="calendar-legend">
                    <span class="legend-title" id="legendTitle">Availability at Lovejoy ISD</span>
                    <span class="legend-item"><span class="legend-dot high"></span> Good</span>
                    <span class="legend-item"><span class="legend-dot medium"></span> Some</span>
                    <span class="legend-item"><span class="legend-dot low"></span> Minimal</span>
                </div>
            </div>

            <!-- Right: Facility List -->
            <div class="calendar-panel">
                <div style="margin-bottom: 12px;">
                    <div style="font-size: 14px; font-weight: 600; color: var(--text);" id="facilityListTitle">Lovejoy ISD Facilities</div>
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 2px;" id="facilityListSubtitle">Availability for February 2026</div>
                </div>
                <div class="facility-list-panel" id="facilityListPanel">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </main>

    <!-- Gradient spacer between cards and about -->
    <div class="main-to-about-spacer"></div>

    <!-- District Info Section -->
    <section class="district-info-section" id="districtInfoSection">
        <div class="district-info-grid">
            <div class="district-info-left">
                <div class="district-about">
                    <h2 id="districtAboutTitle">About Lovejoy ISD</h2>
                    <p id="districtAboutText">The Lovejoy Independent School District, founded in 1917, is a public school district located three miles east of Allen and about 25 miles north of Dallas in the rapidly growing region of central Collin County. Lovejoy ISD serves over 4,500 students across six campuses and is recognized for its strong academics and state-competitive athletics programs.</p>
                    <a href="https://www.lovejoyisd.net" class="district-website-link" id="districtWebsiteAbout" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        <span id="districtWebsiteLabelAbout">lovejoyisd.net</span>
                    </a>
                    <div class="about-glance" id="aboutGlance">
                        <div class="about-glance-stat">
                            <div class="about-glance-value" id="glanceLocations">5</div>
                            <div class="about-glance-label">Locations</div>
                        </div>
                        <div class="about-glance-stat">
                            <div class="about-glance-value" id="glanceFacilities">6</div>
                            <div class="about-glance-label">Facilities</div>
                        </div>
                        <div class="about-glance-stat">
                            <div class="about-glance-value" id="glanceStarting">$40+</div>
                            <div class="about-glance-label">Hourly</div>
                        </div>
                    </div>
                </div>
                <div class="things-to-know">
                    <h2>Things to Know</h2>
                    <div id="thingsToKnowContent">
                        <div class="ttk-item">
                            <div class="ttk-icon"><svg viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18"/></svg></div>
                            <div class="ttk-content"><h4>Cancellation Policy</h4><p>Reservations must be canceled 7 days prior to event for refund. Any credits given for cancellations or changes must be used within 6 months.</p></div>
                        </div>
                        <div class="ttk-item">
                            <div class="ttk-icon"><svg viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13" rx="2"/><path d="M16 8l4 2.5v5L16 13"/></svg></div>
                            <div class="ttk-content"><h4>Parking Tips</h4><p>All athletic facilities are accessible from the rear parking lots. Visitor parking is available in designated lots at each campus.</p></div>
                        </div>
                        <div class="ttk-item">
                            <div class="ttk-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
                            <div class="ttk-content"><h4>Insurance Requirements</h4><p>All renters must provide a certificate of liability insurance naming the district as additionally insured prior to facility use.</p></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="district-map-container">
                <h2>Where You'll Be</h2>
                <div class="map-placeholder" id="districtMapPlaceholder">
                    <iframe id="districtMapFrame" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d26800!2d-96.585!3d33.084!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x864c15f2b4fd0001%3A0x7f3e1e9b9b0b0b0b!2sLucas%2C+TX!5e0!3m2!1sen!2sus!4v1706000000000" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    <div class="map-pin-overlay">
                        <div class="map-pin-pulse"></div>
                        <div class="map-pin-dot"></div>
                    </div>
                </div>
                <div class="map-actions">
                    <a href="#" class="map-directions-btn" id="districtMapLink" target="_blank" rel="noopener noreferrer">
                        <svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
                        Get Directions
                    </a>
                    <span class="map-address-text" id="districtAddress">2350 Estates Parkway, Lucas, TX 75002</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Share Section -->
    <section class="share-section">
        <div class="share-card">
            <div class="share-card-left">
                <div class="share-card-icon">
                    <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                </div>
                <div class="share-card-text">
                    <span class="share-card-label">Know someone who needs a space?</span>
                    <span class="share-card-sub" id="shareSubtext">Share this page with your team, community, or network</span>
                </div>
            </div>
            <div class="share-buttons">
                <a href="#" class="share-btn share-facebook" id="shareFacebook" target="_blank" rel="noopener noreferrer" title="Share on Facebook">
                    <svg viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
                    <span>Facebook</span>
                </a>
                <a href="#" class="share-btn share-twitter" id="shareTwitter" target="_blank" rel="noopener noreferrer" title="Share on X">
                    <svg viewBox="0 0 24 24"><path d="M4 4l6.5 8L4 20h2l5.5-6.8L16 20h4l-6.8-8.5L19.5 4h-2l-5 6.2L8 4H4z"/></svg>
                    <span>X</span>
                </a>
                <a href="#" class="share-btn share-email" id="shareEmail" title="Share via Email">
                    <svg viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 4l-10 8L2 4"/></svg>
                    <span>Email</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <!-- CTA Section -->
        <div class="footer-cta">
            <div class="footer-cta-inner">
                <h3>List your facility on PracticePlan</h3>
                <p>Free for facilities. Start earning revenue from your underused spaces.</p>
                <div class="footer-cta-actions">
                    <a href="https://calendly.com/practiceplan-donnie" target="_blank" class="btn-cta-primary">Schedule a Demo</a>
                    <a href="https://practiceplan.facilityrevenue.com" target="_blank" class="btn-cta-secondary">Learn More</a>
                </div>
            </div>
        </div>

        <!-- Main Footer -->
        <div class="footer-main">
            <div class="footer-main-inner">
                <a href="#" class="footer-logo-link">
                    <svg viewBox="0 0 396.37 66.7" class="pp-logo-footer">
                      <g>
                        <path fill="#f15a29" d="M.72,49.7c-.24-.04-.48-.09-.72-.14.24.05.48.09.72.14Z"/>
                        <g>
                          <path fill="#00a84f" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M38.52,31.97l-18.72-7.88c-1.03-.43-1.86-1.68-1.86-2.8v-8.53c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                          <path fill="#00a84f" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M29.74,48.22v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                        </g>
                        <g>
                          <path fill="#0076bb" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M24.43,21.29L5.71,13.41c-1.03-.43-1.86-1.68-1.86-2.8V2.08c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                          <path fill="#0076bb" stroke="#fff" stroke-miterlimit="10" stroke-width="1.4" d="M15.65,37.54v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                        </g>
                        <g fill="#0076bb">
                          <path d="M87.8,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l1.32-5.79h18.24c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                          <path d="M130.29,43.77h-9.21l-3.92-5.89h-10.58l-1.03,5.89h-6.88l2-11.38h19.36c2.29,0,4.29-1.1,4.29-2.89,0-1.46-1.26-2.2-3.39-2.2h-19.36l1.33-5.79h18.5c4.66,0,10.18,1.43,10.18,6.75,0,4.02-2.89,7.42-7.18,8.25.63.57,1.33,1.36,2.56,2.93l3.36,4.32Z"/>
                          <path d="M138,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                          <path d="M190.18,38.05l-5.42,5.72h-11.18c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h15.6l-5.45,5.79h-11.18c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h15.6Z"/>
                          <path d="M216.65,21.52l-1.08,5.79h-8l-2.93,16.46h-6.88l2.89-16.46h-10.44l5.52-5.79h20.93Z"/>
                          <path d="M221.18,43.77h-6.88l3.96-22.25h6.85l-3.93,22.25Z"/>
                          <path d="M251.47,38.05l-1.64,5.72h-14.05c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h14.93l-1.83,5.79h-14.14c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h14.69Z"/>
                          <path d="M278.35,38.05l-4.59,5.72h-21.42l3.96-22.25h24.88l-4.62,5.79h-14.4l-.47,2.66h16.73l-3.92,5.06h-13.7l-.53,3.03h18.09Z"/>
                          <path d="M298.05,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l4.14-5.79h15.42c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                          <path d="M334.61,38.05l-5.49,5.72h-19.66l3.96-22.25h6.85l-2.93,16.53h17.26Z"/>
                          <path d="M342.3,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                          <path d="M386.02,42.94l-11.47-12.24-2.3,13.07h-6.25l3.23-18.46c.5-2.96,2.46-4.16,4.52-4.16.83,0,1.66.2,2.56,1.2l11.47,12.24,2.33-13.07h6.25l-3.29,18.43c-.53,2.96-2.49,4.19-4.49,4.19-.93,0-1.63-.2-2.56-1.2Z"/>
                        </g>
                      </g>
                    </svg>
                </a>

                
                <div class="footer-social">
                    <a href="https://x.com/practiceplan_io" target="_blank" class="social-link" aria-label="Twitter">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/practiceplan.io" target="_blank" class="social-link" aria-label="Instagram">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
                        </svg>
                    </a>
                    <a href="https://www.linkedin.com/company/practiceplan" target="_blank" class="social-link" aria-label="LinkedIn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>

        <!-- Bottom Footer -->
        <div class="footer-bottom">
            <div class="footer-bottom-inner">
                <span> 2026 PracticePlan</span>
                <span class="footer-dot"></span>
                <a href="#">Privacy</a>
                <span class="footer-dot"></span>
                <a href="#">Terms</a>
            </div>
        </div>
    </footer>
    <!-- Booking Modal -->
    <div class="booking-modal-overlay" id="bookingModalOverlay" onclick="if(event.target===this)closeBookingModal()">
        <div class="booking-modal" style="position:relative;">
            <!-- Success overlay for pending reservation animation -->
            <div class="modal-success-overlay" id="modalSuccessOverlay">
                <div class="success-particles" id="successParticles"></div>
                <div class="success-checkmark-ring">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                </div>
                <div class="success-text-main">Request Submitted</div>
                <div class="success-text-sub" id="successTextSub">Your reservation is pending facility approval.</div>
                <div class="success-cart-hint">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span id="successCartCount">1 pending reservation</span>
                </div>
            </div>
            <div class="modal-header">
                <div class="modal-header-logo" id="modalHeaderLogo"></div>
                <div class="modal-header-info">
                    <h2 id="modalFacilityName">Facility Name</h2>
                    <div class="modal-header-sub">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                        <span id="modalFacilityLocation">School Name</span>
                    </div>
                </div>
                <button class="modal-close-btn" onclick="closeBookingModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Left Column - Facility Info -->
                <div class="modal-left">
                    <div class="modal-facility-image">
                        <img id="modalFacilityImg" src="" alt="">
                        <div class="modal-weather-badge" id="modalWeatherBadge" style="display:none"></div>
                    </div>

                    <!-- Toggle for mobile collapsible details -->
                    <button class="modal-details-toggle" id="modalDetailsToggle" onclick="toggleModalDetails()">
                        <span>Facility info & add-ons</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="modal-details-content" id="modalDetailsContent">
                        <div class="modal-details-inner">

                    <h4 class="modal-section-title">Facility Details</h4>
                    <div class="modal-info-grid" id="modalInfoGrid"></div>

                    <h4 class="modal-section-title">Features</h4>
                    <div class="modal-features" id="modalFeatures"></div>

                    <h4 class="modal-section-title">Add-on Amenities</h4>
                    <div class="modal-amenities-grid" id="modalAmenities"></div>
                    <div class="modal-amenity-total" id="modalAmenityTotal" style="display:none">
                        <span class="modal-amenity-total-label">Selected add-ons</span>
                        <span class="modal-amenity-total-amount" id="modalAmenityTotalAmount">$0</span>
                    </div>

                    <h4 class="modal-section-title">Policies</h4>
                    <div id="modalPolicies"></div>

                        </div>
                    </div>
                </div>

                <!-- Right Column - Booking Form -->
                <div class="modal-right">
                    <div class="modal-price-banner">
                        <div>
                            <span class="modal-price-amount" id="modalPrice">$75</span>
                            <span class="modal-price-unit">/hr</span>
                        </div>
                        <div class="modal-price-availability" id="modalAvailability">
                            <span class="avail-dot medium"></span>
                            <span>Limited availability</span>
                        </div>
                    </div>

                    <div class="modal-form-group">
                        <label class="modal-form-label">Select a Date</label>
                        <div class="modal-date-field" id="modalDateField">
                            <input type="hidden" id="modalDate">
                            <span class="modal-date-display" id="modalDateDisplay">Select a date</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--text-secondary);flex-shrink:0"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            <div class="modal-datepicker" id="modalDatepicker">
                                <div class="dp-header">
                                    <button class="dp-nav" id="mdpPrev" type="button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
                                    <span class="dp-month" id="mdpMonth"></span>
                                    <button class="dp-nav" id="mdpNext" type="button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
                                </div>
                                <div class="dp-weekdays"><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span></div>
                                <div class="dp-days" id="mdpDays"></div>
                                <button class="dp-clear" id="mdpClear" type="button">Clear date</button>
                            </div>
                        </div>
                    </div>

                    <div class="modal-form-group">
                        <label class="modal-form-label">Available Time Slots</label>
                        <div class="modal-slots-wrapper" id="modalSlotsWrapper">
                            <div class="modal-slots-grid" id="modalSlots">
                                <span style="font-size:13px;color:var(--text-secondary)">Select a date to view availability</span>
                            </div>
                            <div class="slots-required-hint">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                Select a time slot to continue
                            </div>
                        </div>
                    </div>

                    <div class="modal-divider"></div>

                    <div class="modal-form-row">
                        <div class="modal-form-group">
                            <label class="modal-form-label">Duration</label>
                            <div class="modal-select-wrapper">
                                <select class="modal-form-select" id="modalDuration">
                                    <option value="1">1 hour</option>
                                    <option value="2" selected>2 hours</option>
                                    <option value="3">3 hours</option>
                                    <option value="4">4 hours</option>
                                    <option value="5">5 hours</option>
                                    <option value="6">6 hours</option>
                                    <option value="7">7 hours</option>
                                    <option value="8">8 hours</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-form-group">
                            <label class="modal-form-label">Group Size</label>
                            <div class="modal-select-wrapper">
                                <select class="modal-form-select" id="modalGroupSize" onchange="validateModalForm()">
                                    <option value="">Select</option>
                                    <option value="1-10">1 - 10 people</option>
                                    <option value="11-50">11 - 50 people</option>
                                    <option value="51-100">51 - 100 people</option>
                                    <option value="101-200">101 - 200 people</option>
                                    <option value="201-500">201 - 500 people</option>
                                    <option value="500+">500+ people</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-form-row">
                        <div class="modal-form-group">
                            <label class="modal-form-label">Booking Type</label>
                            <div class="modal-select-wrapper">
                                <select class="modal-form-select" id="modalBookingType" onchange="validateModalForm()">
                                    <option value="">Select type</option>
                                    <option value="practice">Practice / Training</option>
                                    <option value="game">Game / Match</option>
                                    <option value="tournament">Tournament</option>
                                    <option value="camp">Camp / Clinic</option>
                                    <option value="meeting">Meeting / Event</option>
                                    <option value="performance">Performance / Show</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-form-group">
                            <label class="modal-form-label">Activity</label>
                            <div class="modal-select-wrapper" id="modalActivityWrapper">
                                <select class="modal-form-select" id="modalActivity" onchange="validateModalForm()">
                                    <option value="">Select activity</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-form-group">
                        <label class="modal-form-label">Special Requests <span style="font-weight:400;color:var(--text-secondary)">(optional)</span></label>
                        <textarea class="modal-form-input" id="modalNotes" rows="2" placeholder="Any special setup or access needs..." style="resize:vertical;min-height:44px;font-family:var(--ff)"></textarea>
                    </div>

                    <div class="modal-insurance" id="modalInsurance">
                        <div class="modal-insurance-header">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            <span class="modal-insurance-title">Proof of Insurance <span style="font-size:11px;font-weight:600;color:#f59e0b">(Required)</span></span>
                        </div>
                        <div class="modal-insurance-subtitle">This facility requires a certificate of liability insurance. Upload now or provide it after your reservation is approved - your booking will not be confirmed until insurance is verified.</div>
                        <div class="modal-insurance-upload">
                            <label class="insurance-upload-btn" id="insuranceUploadBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                Upload document
                                <input type="file" id="insuranceFileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp" onchange="handleInsuranceUpload(this)">
                            </label>
                            <div class="insurance-file-info" id="insuranceFileInfo">
                                <div class="insurance-file-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                </div>
                                <div style="flex:1;min-width:0">
                                    <div class="insurance-file-name" id="insuranceFileName"></div>
                                    <div class="insurance-file-size" id="insuranceFileSize"></div>
                                </div>
                                <button class="insurance-file-remove" onclick="removeInsuranceFile()" title="Remove file">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="insurance-retained-badge" id="insuranceRetainedBadge">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                            Automatically applied from previous upload
                        </div>
                    </div>

                    <div class="modal-notice" id="modalNotice" style="display:none">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                        <span id="modalNoticeText"></span>
                    </div>

                    <div class="modal-validation-hint" id="modalValidationHint">
                        <div class="vhint-bar-wrap">
                            <span class="vhint-label" id="modalValidationLabel">0 of 5</span>
                            <div class="vhint-track"><div class="vhint-fill" id="modalValidationFill" style="width:0%"></div></div>
                        </div>
                    </div>
                    <div class="modal-btn-group">
                        <button class="modal-book-btn secondary" id="modalAddContinueBtn" onclick="submitBooking('continue')" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Submit & Keep Browsing
                        </button>
                        <button class="modal-book-btn" id="modalBookBtn" onclick="submitBooking('checkout')" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                            Submit Request
                        </button>
                    </div>
                    <div class="modal-login-hint">
                        By submitting a request, you agree to the district's <a href="#">rental terms</a>.
                    </div>
                </div>
            </div>
            <!-- Mobile fixed bottom bar -->
            <div class="modal-bottom-bar" id="modalBottomBar">
                <div class="modal-validation-hint" id="modalValidationHintMobile">
                    <div class="vhint-bar-wrap">
                        <span class="vhint-label" id="modalValidationLabelMobile">0 of 5</span>
                        <div class="vhint-track"><div class="vhint-fill" id="modalValidationFillMobile" style="width:0%"></div></div>
                    </div>
                </div>
                <div class="modal-btn-row">
                    <button class="modal-book-btn secondary" id="modalAddContinueBtnMobile" onclick="submitBooking('continue')" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Submit & Browse
                    </button>
                    <button class="modal-book-btn" id="modalBookBtnMobile" onclick="submitBooking('checkout')" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                        Submit
                    </button>
                </div>
                <div class="modal-login-hint">By submitting a request, you agree to the district's <a href="#">rental terms</a>.</div>
            </div>
        </div>
    </div>

    <!-- Cart Drawer -->
    <div class="cart-drawer-overlay" id="cartDrawerOverlay" onclick="if(event.target===this)toggleCartDrawer()">
        <div class="cart-drawer">
            <div class="cart-drawer-header">
                <div class="cart-drawer-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    Your Reservations
                    <span class="cart-drawer-count" id="cartDrawerCount">0 slots</span>
                </div>
                <button class="cart-drawer-close" onclick="toggleCartDrawer()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="cart-drawer-items" id="cartDrawerItems">
                <div class="cart-drawer-empty" id="cartEmpty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <div class="cart-drawer-empty-title">No reservations yet</div>
                    <div class="cart-drawer-empty-text">Browse facilities and reserve time slots to get started.</div>
                </div>
            </div>
            <div class="cart-drawer-footer" id="cartDrawerFooter" style="display:none">
                <!-- Insurance reminder -->
                <div class="cart-insurance-reminder" id="cartInsuranceReminder">
                    <div class="cart-insurance-reminder-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        <div class="cart-insurance-reminder-text">
                            <div class="cart-insurance-reminder-title">Insurance required</div>
                            <div class="cart-insurance-reminder-desc">Upload a certificate of liability insurance before submitting your reservation request.</div>
                        </div>
                    </div>
                    <div class="cart-insurance-upload-row" id="cartInsuranceUploadRow">
                        <label class="cart-insurance-upload-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Upload insurance
                            <input type="file" id="cartInsuranceFileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp" onchange="handleCartInsuranceUpload(this)">
                        </label>
                    </div>
                    <div class="cart-insurance-file-row" id="cartInsuranceFileRow" style="display:none">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;flex-shrink:0;color:#16a34a"><polyline points="20 6 9 17 4 12"/></svg>
                        <span class="cart-insurance-file-name" id="cartInsuranceFileName"></span>
                        <button class="cart-insurance-file-remove" onclick="removeCartInsurance()" title="Remove file">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                </div>

                <div id="cartFooterLineItems"></div>
                <div class="cart-total-row" style="margin-top:6px;padding-top:6px;border-top:1px dashed var(--border)">
                    <span class="cart-total-label">Reservation fee (10%)</span>
                    <span class="cart-total-value" id="cartFeeTotal">$0.00</span>
                </div>
                <div class="cart-total-grand">
                    <span class="cart-total-grand-label">Estimated total</span>
                    <span class="cart-total-grand-value" id="cartGrandTotal">$0.00</span>
                </div>
                <button class="cart-checkout-btn" id="cartCheckoutBtn" onclick="cartCheckout()" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                    Submit All Requests
                </button>
                <div class="cart-secondary-actions">
                    <button class="cart-browse-btn" onclick="browseMoreFacilities()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        Continue Browsing
                    </button>
                    <button class="cart-clear-btn" onclick="clearCart()">Clear All</button>
                </div>
                <div class="cart-drawer-logo">
                    <span>Powered by</span>
                    <svg viewBox="0 0 396.37 66.7" fill="currentColor">
                      <g>
                        <g>
                          <path fill="#00a84f" d="M38.52,31.97l-18.72-7.88c-1.03-.43-1.86-1.68-1.86-2.8v-8.53c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                          <path fill="#00a84f" d="M29.74,48.22v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                        </g>
                        <g>
                          <path fill="#0076bb" d="M24.43,21.29L5.71,13.41c-1.03-.43-1.86-1.68-1.86-2.8V2.08c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                          <path fill="#0076bb" d="M15.65,37.54v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                        </g>
                        <g fill="currentColor">
                          <path d="M87.8,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l1.32-5.79h18.24c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                          <path d="M130.29,43.77h-9.21l-3.92-5.89h-10.58l-1.03,5.89h-6.88l2-11.38h19.36c2.29,0,4.29-1.1,4.29-2.89,0-1.46-1.26-2.2-3.39-2.2h-19.36l1.33-5.79h18.5c4.66,0,10.18,1.43,10.18,6.75,0,4.02-2.89,7.42-7.18,8.25.63.57,1.33,1.36,2.56,2.93l3.36,4.32Z"/>
                          <path d="M138,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                          <path d="M190.18,38.05l-5.42,5.72h-11.18c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h15.6l-5.45,5.79h-11.18c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h15.6Z"/>
                          <path d="M216.65,21.52l-1.08,5.79h-8l-2.93,16.46h-6.88l2.89-16.46h-10.44l5.52-5.79h20.93Z"/>
                          <path d="M221.18,43.77h-6.88l3.96-22.25h6.85l-3.93,22.25Z"/>
                          <path d="M251.47,38.05l-1.64,5.72h-14.05c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h14.93l-1.83,5.79h-14.14c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h14.69Z"/>
                          <path d="M278.35,38.05l-4.59,5.72h-21.42l3.96-22.25h24.88l-4.62,5.79h-14.4l-.47,2.66h16.73l-3.92,5.06h-13.7l-.53,3.03h18.09Z"/>
                          <path d="M298.05,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l4.14-5.79h15.42c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                          <path d="M334.61,38.05l-5.49,5.72h-19.66l3.96-22.25h6.85l-2.93,16.53h17.26Z"/>
                          <path d="M342.3,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                          <path d="M386.02,42.94l-11.47-12.24-2.3,13.07h-6.25l3.23-18.46c.5-2.96,2.46-4.16,4.52-4.16.83,0,1.66.2,2.56,1.2l11.47,12.24,2.33-13.07h6.25l-3.29,18.43c-.53,2.96-2.49,4.19-4.49,4.19-.93,0-1.63-.2-2.56-1.2Z"/>
                        </g>
                      </g>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Page -->
    <div class="confirm-page-overlay" id="confirmPageOverlay">
        <div class="confirm-page">
            <div class="confirm-check-ring">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
            </div>
            <div class="confirm-heading">Reservation Requests Submitted</div>
            <div class="confirm-subheading">Your reservation requests are now pending review by the facility coordinator. You'll be notified as each request is approved.</div>

            <div class="confirm-summary" id="confirmSummary">
                <div class="confirm-summary-header">
                    <span class="confirm-summary-title">Reservation summary</span>
                    <span class="confirm-ref" id="confirmRef">REF-000000</span>
                </div>
                <div class="confirm-summary-items" id="confirmItems"></div>
                <div class="confirm-summary-total">
                    <span class="confirm-total-label">Estimated total</span>
                    <span class="confirm-total-value" id="confirmTotal">$0.00</span>
                </div>
            </div>

            <div class="confirm-next-steps">
                <div class="confirm-steps-title">What happens next</div>
                <div class="confirm-steps-list">
                    <div class="confirm-step">
                        <div class="confirm-step-num">1</div>
                        <div class="confirm-step-content">
                            <div class="confirm-step-label">Facility review</div>
                            <div class="confirm-step-desc">The facility coordinator will review your request and insurance documentation. Most requests are reviewed within 1-2 business days.</div>
                        </div>
                    </div>
                    <div class="confirm-step">
                        <div class="confirm-step-num">2</div>
                        <div class="confirm-step-content">
                            <div class="confirm-step-label">Approval notification</div>
                            <div class="confirm-step-desc">Once approved, you'll receive a confirmation with your finalized rental agreement and payment details.</div>
                        </div>
                    </div>
                    <div class="confirm-step">
                        <div class="confirm-step-num">3</div>
                        <div class="confirm-step-content">
                            <div class="confirm-step-label">You're all set</div>
                            <div class="confirm-step-desc">Show up on your reserved date and time. You'll find access instructions and any check-in details in your confirmation.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="confirm-notify-row">
                <div class="confirm-notify-card">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="4" width="20" height="16" rx="2"/><polyline points="22 4 12 13 2 4"/></svg>
                    <div>
                        <div class="confirm-notify-label">Email</div>
                        <div class="confirm-notify-hint">Confirmation sent to your inbox</div>
                    </div>
                </div>
                <div class="confirm-notify-card">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <div>
                        <div class="confirm-notify-label">Text</div>
                        <div class="confirm-notify-hint">SMS updates on approval status</div>
                    </div>
                </div>
                <div class="confirm-notify-card">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <div>
                        <div class="confirm-notify-label">Account</div>
                        <div class="confirm-notify-hint">View status in My Reservations</div>
                    </div>
                </div>
            </div>

            <div class="confirm-contact">
                <div class="confirm-contact-label">Questions about your reservation?</div>
                <a href="/cdn-cgi/l/email-protection#3851565e5778484a595b4c515b5d48545956165157" class="confirm-contact-email">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;vertical-align:-3px;margin-right:5px"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 7l-10 7L2 7"/></svg>Contact us
                </a>
            </div>

            <button class="confirm-back-btn" onclick="closeConfirmPage()">
                Back to facilities
            </button>

            <div class="confirm-footer-logo">
                <span>Powered by</span>
                <svg viewBox="0 0 396.37 66.7" fill="currentColor">
                  <g>
                    <g>
                      <path fill="#00a84f" d="M38.52,31.97l-18.72-7.88c-1.03-.43-1.86-1.68-1.86-2.8v-8.53c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                      <path fill="#00a84f" d="M29.74,48.22v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                    </g>
                    <g>
                      <path fill="#0076bb" d="M24.43,21.29L5.71,13.41c-1.03-.43-1.86-1.68-1.86-2.8V2.08c0-1.11.83-1.67,1.86-1.23l20.95,8.82c3.5,1.47,5.25,3.41,5.25,5.34,0,1.93-1.75,3.87-5.25,5.34l-2.23.94Z"/>
                      <path fill="#0076bb" d="M15.65,37.54v11.43c0,1.11-.83,2.37-1.86,2.8l-8.08,3.4c-1.03.43-1.86-.12-1.86-1.23v-21.97c0-1.11.83-2.37,1.86-2.8l20.95-8.82c3.5-1.47,5.25-3.41,5.25-5.34v10.81c0,3.03-1.75,5.61-5.25,7.09l-11.01,4.64Z"/>
                    </g>
                    <g fill="currentColor">
                      <path d="M87.8,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l1.32-5.79h18.24c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                      <path d="M130.29,43.77h-9.21l-3.92-5.89h-10.58l-1.03,5.89h-6.88l2-11.38h19.36c2.29,0,4.29-1.1,4.29-2.89,0-1.46-1.26-2.2-3.39-2.2h-19.36l1.33-5.79h18.5c4.66,0,10.18,1.43,10.18,6.75,0,4.02-2.89,7.42-7.18,8.25.63.57,1.33,1.36,2.56,2.93l3.36,4.32Z"/>
                      <path d="M138,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                      <path d="M190.18,38.05l-5.42,5.72h-11.18c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h15.6l-5.45,5.79h-11.18c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h15.6Z"/>
                      <path d="M216.65,21.52l-1.08,5.79h-8l-2.93,16.46h-6.88l2.89-16.46h-10.44l5.52-5.79h20.93Z"/>
                      <path d="M221.18,43.77h-6.88l3.96-22.25h6.85l-3.93,22.25Z"/>
                      <path d="M251.47,38.05l-1.64,5.72h-14.05c-6.95,0-11.57-4.19-11.57-9.81,0-7.32,6.98-12.44,15.5-12.44h14.93l-1.83,5.79h-14.14c-4.09,0-7.55,2.63-7.55,6.15,0,2.76,2.29,4.59,5.65,4.59h14.69Z"/>
                      <path d="M278.35,38.05l-4.59,5.72h-21.42l3.96-22.25h24.88l-4.62,5.79h-14.4l-.47,2.66h16.73l-3.92,5.06h-13.7l-.53,3.03h18.09Z"/>
                      <path d="M298.05,38.08h-11.64l-1,5.69h-6.85l2-11.38h19.16c2.39,0,3.86-1.23,3.86-2.96,0-1.3-1.03-2.13-2.96-2.13h-19.16l4.14-5.79h15.42c6.19,0,9.58,2.89,9.58,7.15,0,5.52-4.82,9.41-12.54,9.41Z"/>
                      <path d="M334.61,38.05l-5.49,5.72h-19.66l3.96-22.25h6.85l-2.93,16.53h17.26Z"/>
                      <path d="M342.3,43.77l5.19-5.72h5.55c1.36,0,2.89,0,3.96.07-.47-.8-1.16-2.16-1.7-3.23l-2.96-5.89-13.04,14.77h-8.15l17.83-20.12c1.16-1.3,2.73-2.49,4.89-2.49s3.23,1.1,3.96,2.49l10.34,20.12h-25.88Z"/>
                      <path d="M386.02,42.94l-11.47-12.24-2.3,13.07h-6.25l3.23-18.46c.5-2.96,2.46-4.16,4.52-4.16.83,0,1.66.2,2.56,1.2l11.47,12.24,2.33-13.07h6.25l-3.29,18.43c-.53,2.96-2.49,4.19-4.49,4.19-.93,0-1.63-.2-2.56-1.2Z"/>
                    </g>
                  </g>
                </svg>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Search bar elements
        const searchDate = document.getElementById('searchDate');
        const datePlaceholder = document.getElementById('datePlaceholder');
        const activityType = document.getElementById('activityType');
        const searchBtn = document.getElementById('searchBtn');
        const toggleOptional = document.getElementById('toggleOptional');
        const optionalFields = document.getElementById('optionalFields');

        // Results elements
        const filterChips = document.getElementById('filterChips');
        const dateChip = document.getElementById('dateChip');
        const dateChipText = document.getElementById('dateChipText');
        const activityChip = document.getElementById('activityChip');
        const activityChipText = document.getElementById('activityChipText');
        const clearAllFilters = document.getElementById('clearAllFilters');

        // View toggle elements
        const gridViewBtn = document.getElementById('gridViewBtn');
        const calendarViewBtn = document.getElementById('calendarViewBtn');
        const facilityGrid = document.getElementById('facilityGrid');
        const calendarView = document.getElementById('calendarView');
        const calendarGrid = document.getElementById('calendarGrid');
        const calendarMonth = document.getElementById('calendarMonth');

        // Calendar state
        let currentCalendarDate = new Date();

        // Empty state elements
        const gridEmptyState = document.getElementById('gridEmptyState');
        const gridEmptyTitle = document.getElementById('gridEmptyTitle');
        const gridEmptyText = document.getElementById('gridEmptyText');
        const gridEmptyClear = document.getElementById('gridEmptyClear');

        // Build context-aware empty state message
        function getEmptyStateMessage() {
            const schoolFilter = document.getElementById('searchSchool') ? document.getElementById('searchSchool').value : '';
            const facilityTypeFilter = searchFacilityType ? searchFacilityType.value : '';
            const hasDate = searchDate.value;
            const hasActivity = activityType.value;
            const gsSlider = document.getElementById('searchGuests');
            const gsIdx = gsSlider ? parseInt(gsSlider.value) : 0;
            const durSlider = document.getElementById('searchDuration');
            const durVal = durSlider ? parseInt(durSlider.value) : 2;

            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d) return { title: 'No facilities found', text: 'Try adjusting your search.' };

            // Get the human-readable filter names
            const schoolEl = document.getElementById('searchSchool');
            const schoolName = (schoolFilter && schoolEl) ? schoolEl.options[schoolEl.selectedIndex]?.text : '';
            const facilityTypeName = (facilityTypeFilter && searchFacilityType) ? searchFacilityType.options[searchFacilityType.selectedIndex]?.text : '';
            const activityText = (hasActivity && activityType) ? activityType.options[activityType.selectedIndex]?.text : '';

            // Count active filters
            const hasSchool = !!schoolFilter;
            const hasType = !!facilityTypeFilter;
            const hasGroup = gsIdx > 0;
            const hasDuration = durVal !== 2;
            const anyFilters = hasSchool || hasType || hasDate || hasActivity || hasGroup || hasDuration;

            let title = 'No facilities found';
            let text = '';

            if (hasSchool && !hasType && !hasDate && !hasActivity && !hasGroup) {
                // Only location selected, no other filters
                title = 'No facilities listed at ' + schoolName;
                text = 'There are currently no bookable facilities at this location. Try selecting a different location or clear your filters to see all available spaces.';
            } else if (hasSchool && anyFilters) {
                // Location + other filters
                title = 'No matching facilities at ' + schoolName;
                text = 'No facilities at ' + schoolName + ' match your current criteria. Try adjusting your filters or select a different location.';
            } else if (hasDate && hasActivity) {
                title = 'No availability for ' + activityText;
                text = 'There are no facilities available for ' + activityText.toLowerCase() + ' on your selected date. Try a different date or activity.';
            } else if (hasDate) {
                title = 'No availability on this date';
                text = 'No facilities are available on your selected date. Try choosing a different date or clear the date filter to browse all spaces.';
            } else if (hasActivity) {
                title = 'No facilities for ' + activityText;
                text = 'There are no facilities configured for ' + activityText.toLowerCase() + ' at ' + d.name + '. Try selecting a different activity.';
            } else if (hasType) {
                title = 'No ' + facilityTypeName.toLowerCase() + ' available';
                text = 'There are no ' + facilityTypeName.toLowerCase() + ' listed at ' + d.name + '. Try a different facility type.';
            } else if (hasGroup) {
                title = 'No facilities for that group size';
                text = 'No facilities at ' + d.name + ' accommodate your selected group size. Try adjusting the group size slider.';
            } else {
                text = 'Try adjusting your filters or clearing your search to see available spaces at ' + d.name + '.';
            }

            return { title, text };
        }

        // Format date nicely
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Central filter function - applies all filters immediately on any change
        function applyAllFilters() {
            const hasDate = searchDate.value;
            const hasActivity = activityType.value;
            const activityText = activityType.options[activityType.selectedIndex]?.text || '';

            // Update date placeholder
            datePlaceholder.textContent = hasDate ? formatDate(searchDate.value) : 'Any date';

            // Update time slots visibility on grid cards
            document.querySelectorAll('.time-slots').forEach(el => {
                el.style.display = hasDate ? 'none' : 'flex';
            });
            document.querySelectorAll('.time-slots-searched').forEach(el => {
                el.style.display = hasDate ? 'flex' : 'none';
            });

            // Update filter chips
            if (hasDate || hasActivity) {
                filterChips.style.display = 'flex';
                if (hasDate) {
                    dateChip.style.display = 'inline-flex';
                    dateChipText.textContent = formatDate(searchDate.value);
                } else {
                    dateChip.style.display = 'none';
                }
                if (hasActivity) {
                    activityChip.style.display = 'inline-flex';
                    activityChipText.textContent = activityText;
                } else {
                    activityChip.style.display = 'none';
                }
            } else {
                filterChips.style.display = 'none';
            }

            // Filter grid cards by facility type, location, and group size
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            const schoolFilter = document.getElementById('searchSchool') ? document.getElementById('searchSchool').value : '';
            const facilityTypeFilter = searchFacilityType ? searchFacilityType.value : '';
            const groupSizeSlider = document.getElementById('searchGuests');
            const groupSizeIdx = groupSizeSlider ? parseInt(groupSizeSlider.value) : 0;
            // Map slider index to minimum capacity threshold
            const groupSizeThresholds = [0, 10, 50, 100, 200, 500, 501];
            const minCapacity = groupSizeThresholds[groupSizeIdx] || 0;

            if (d) {
                const cards = document.querySelectorAll('#facilityGrid .facility-card');
                cards.forEach((card, i) => {
                    const nameEl = card.querySelector('.facility-name');
                    if (!nameEl) return;
                    const facility = d.facilities.find(f => f.name === nameEl.textContent);
                    if (!facility) { card.style.display = ''; return; }

                    let show = true;

                    // Filter by facility type
                    if (facilityTypeFilter) {
                        const typeStr = facility.type.toLowerCase();
                        if (!typeStr.includes(facilityTypeFilter)) show = false;
                    }

                    // Filter by location/school
                    if (schoolFilter) {
                        const school = d.schools.find(s => s.value === schoolFilter);
                        if (school && !facility.location.includes(school.label.split(' ').slice(0, 2).join(' '))) show = false;
                    }

                    // Filter by group size / capacity
                    if (minCapacity > 0) {
                        const capNum = parseInt(facility.capacity.replace(/[^0-9]/g, '')) || 0;
                        if (groupSizeIdx === 6) {
                            // "500+" means need capacity > 500
                            if (capNum <= 500) show = false;
                        } else {
                            // "Up to X" means user's group is up to X, facility must hold at least that
                            if (capNum < minCapacity) show = false;
                        }
                    }

                    card.style.display = show ? '' : 'none';
                });
            }

            // Update everything
            updateWeatherBadges();
            updateGridAvailability();
            if (calendarView.classList.contains('active')) {
                renderCalendar();
                renderFacilityList();
            }

            // Check for empty grid state and update result count
            if (gridEmptyState) {
                const visibleCards = Array.from(document.querySelectorAll('#facilityGrid .facility-card')).filter(c => c.style.display !== 'none');
                const count = visibleCards.length;
                const resultsCount = document.getElementById('resultsCount');
                if (resultsCount) resultsCount.textContent = count + (count === 1 ? ' space' : ' spaces');
                if (count === 0 && facilityGrid.style.display !== 'none') {
                    const msg = getEmptyStateMessage();
                    gridEmptyTitle.textContent = msg.title;
                    gridEmptyText.textContent = msg.text;
                    gridEmptyState.style.display = 'flex';
                } else {
                    gridEmptyState.style.display = 'none';
                }
            }
        }

        // Custom datepicker
        const dateField = document.getElementById('dateField');
        const customDatepicker = document.getElementById('customDatepicker');
        const dpDays = document.getElementById('dpDays');
        const dpMonth = document.getElementById('dpMonth');
        const dpPrev = document.getElementById('dpPrev');
        const dpNext = document.getElementById('dpNext');
        const dpClear = document.getElementById('dpClear');
        let dpViewDate = new Date();

        function renderDatepicker() {
            const year = dpViewDate.getFullYear();
            const month = dpViewDate.getMonth();
            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            dpMonth.textContent = months[month] + ' ' + year;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrev = new Date(year, month, 0).getDate();
            const today = new Date();
            today.setHours(0,0,0,0);
            const selectedVal = searchDate.value;

            let html = '';
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const d = daysInPrev - i;
                html += '<button class="dp-day other-month past" type="button" disabled>' + d + '</button>';
            }
            // Current month days
            for (let d = 1; d <= daysInMonth; d++) {
                const dateObj = new Date(year, month, d);
                const dateStr = year + '-' + String(month+1).padStart(2,'0') + '-' + String(d).padStart(2,'0');
                const isPast = dateObj < today;
                const isToday = dateObj.getTime() === today.getTime();
                const isSelected = dateStr === selectedVal;
                let cls = 'dp-day';
                if (isPast) cls += ' past';
                if (isToday) cls += ' today';
                if (isSelected) cls += ' selected';
                html += '<button class="' + cls + '" type="button" data-date="' + dateStr + '"' + (isPast ? ' disabled' : '') + '>' + d + '</button>';
            }
            // Next month days
            const totalCells = firstDay + daysInMonth;
            const remaining = (7 - (totalCells % 7)) % 7;
            for (let d = 1; d <= remaining; d++) {
                html += '<button class="dp-day other-month" type="button" disabled>' + d + '</button>';
            }
            dpDays.innerHTML = html;

            // Dim prev arrow when on current month
            const now = new Date();
            const isCurrentMonth = year === now.getFullYear() && month === now.getMonth();
            dpPrev.style.opacity = isCurrentMonth ? '0.25' : '';
            dpPrev.style.pointerEvents = isCurrentMonth ? 'none' : '';
        }

        dateField.addEventListener('click', (e) => {
            if (e.target.closest('.custom-datepicker')) return;
            customDatepicker.classList.toggle('open');
            if (customDatepicker.classList.contains('open')) renderDatepicker();
        });

        dpDays.addEventListener('click', (e) => {
            e.stopPropagation();
            const btn = e.target.closest('.dp-day[data-date]');
            if (!btn || btn.disabled) return;
            searchDate.value = btn.dataset.date;
            customDatepicker.classList.remove('open');
            applyAllFilters();
        });

        dpPrev.addEventListener('click', (e) => {
            e.stopPropagation();
            const now = new Date();
            const prevMonth = new Date(dpViewDate);
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            // Don't navigate before the current month
            if (prevMonth.getFullYear() < now.getFullYear() ||
                (prevMonth.getFullYear() === now.getFullYear() && prevMonth.getMonth() < now.getMonth())) return;
            dpViewDate.setMonth(dpViewDate.getMonth() - 1);
            renderDatepicker();
        });

        dpNext.addEventListener('click', (e) => {
            e.stopPropagation();
            dpViewDate.setMonth(dpViewDate.getMonth() + 1);
            renderDatepicker();
        });

        dpClear.addEventListener('click', (e) => {
            e.stopPropagation();
            searchDate.value = '';
            customDatepicker.classList.remove('open');
            applyAllFilters();
        });

        document.addEventListener('click', (e) => {
            if (!dateField.contains(e.target)) {
                customDatepicker.classList.remove('open');
            }
        });

        // Toggle optional filters - shared function
        const toggleLabel = toggleOptional.childNodes[toggleOptional.childNodes.length - 1];
        const optionalCollapse = document.getElementById('optionalCollapse');
        function collapseOptionalFilters() {
            optionalFields.style.display = 'none';
            toggleOptional.classList.remove('active');
            toggleLabel.textContent = ' More options';
            if (optionalCollapse) optionalCollapse.classList.remove('visible');
        }
        function toggleOptionalFilters() {
            const isVisible = optionalFields.style.display !== 'none';
            if (isVisible) {
                collapseOptionalFilters();
            } else {
                optionalFields.style.display = 'grid';
                toggleOptional.classList.add('active');
                toggleLabel.textContent = ' Hide options';
                if (optionalCollapse) optionalCollapse.classList.add('visible');
            }
        }
        toggleOptional.addEventListener('click', toggleOptionalFilters);

        // Collapse chevron at bottom of search section
        if (optionalCollapse) {
            optionalCollapse.addEventListener('click', collapseOptionalFilters);
        }

        // Apply Filters button - applies filters, collapses panel, scrolls to results
        const optionalApply = document.getElementById('optionalApply');
        if (optionalApply) {
            optionalApply.addEventListener('click', () => {
                applyAllFilters();
                collapseOptionalFilters();
                const resultsBar = document.querySelector('.results-bar');
                if (resultsBar) resultsBar.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        }

        // Clear Filters button - resets optional fields, collapses panel
        const optionalClear = document.getElementById('optionalClear');
        if (optionalClear) {
            optionalClear.addEventListener('click', () => {
                document.getElementById('searchSchool').value = '';
                document.getElementById('searchFacilityType').value = '';
                document.getElementById('searchDuration').value = 2;
                document.getElementById('durationValue').textContent = '2 hours';
                document.getElementById('searchGuests').value = 2;
                document.getElementById('groupSizeValue').textContent = 'Up to 50';
                document.querySelectorAll('.amenity-check input').forEach(cb => cb.checked = false);
                const amenitiesBtn = document.getElementById('amenitiesBtn');
                if (amenitiesBtn) {
                    amenitiesBtn.classList.remove('active');
                    document.getElementById('amenitiesBtnText').textContent = 'Any amenities';
                }
                const amenitiesPanel = document.getElementById('amenitiesPanel');
                if (amenitiesPanel) amenitiesPanel.classList.remove('open');
                applyAllFilters();
                collapseOptionalFilters();
            });
        }

        // Search button still works as a manual trigger
        searchBtn.addEventListener('click', () => {
            applyAllFilters();
            const resultsBar = document.querySelector('.results-bar');
            if (resultsBar) resultsBar.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // Remove individual filter chips
        document.querySelectorAll('.chip-remove').forEach(btn => {
            btn.addEventListener('click', () => {
                const filter = btn.dataset.filter;
                if (filter === 'date') {
                    searchDate.value = '';
                } else if (filter === 'activity') {
                    activityType.value = '';
                    if (searchFacilityType) searchFacilityType.value = '';
                }
                applyAllFilters();
            });
        });

        // Clear all filters
        clearAllFilters.addEventListener('click', () => {
            searchDate.value = '';
            activityType.value = '';
            if (searchFacilityType) searchFacilityType.value = '';
            const schoolSelect = document.getElementById('searchSchool');
            if (schoolSelect) schoolSelect.value = '';
            // Reset sliders
            const gsSlider = document.getElementById('searchGuests');
            if (gsSlider) { gsSlider.value = 0; document.getElementById('groupSizeValue').textContent = 'Any size'; }
            const durSlider = document.getElementById('searchDuration');
            if (durSlider) { durSlider.value = 2; document.getElementById('durationValue').textContent = '2 hours'; }
            // Reset amenities
            if (amenityChecks) amenityChecks.forEach(cb => { cb.checked = false; });
            if (typeof updateAmenitiesText === 'function') updateAmenitiesText();
            applyAllFilters();
        });

        // Empty state clear button mirrors the main clear all
        if (gridEmptyClear) {
            gridEmptyClear.addEventListener('click', () => {
                clearAllFilters.click();
            });
        }

        // View toggle
        gridViewBtn.addEventListener('click', () => {
            gridViewBtn.classList.add('active');
            calendarViewBtn.classList.remove('active');
            facilityGrid.style.display = 'grid';
            calendarView.classList.remove('active');
        });

        calendarViewBtn.addEventListener('click', () => {
            calendarViewBtn.classList.add('active');
            gridViewBtn.classList.remove('active');
            facilityGrid.style.display = 'none';
            if (gridEmptyState) gridEmptyState.style.display = 'none';
            calendarView.classList.add('active');
            renderCalendar();
            renderFacilityList();
        });

        // Sort toggle
        const sortToggle = document.getElementById('sortToggle');
        let sortDir = 'az';
        if (sortToggle) {
            const sortLabel = sortToggle.querySelector('.sort-label');
            sortToggle.addEventListener('click', () => {
                // Toggle direction
                sortDir = sortDir === 'az' ? 'za' : 'az';
                sortLabel.textContent = sortDir === 'az' ? 'A-Z' : 'Z-A';
                sortToggle.classList.toggle('desc', sortDir === 'za');

                // Press flash
                sortToggle.classList.add('pressed');
                setTimeout(() => sortToggle.classList.remove('pressed'), 200);

                // Sort cards
                const cards = Array.from(facilityGrid.querySelectorAll('.facility-card'));
                cards.sort((a, b) => {
                    const nameA = a.querySelector('.facility-name').textContent.toLowerCase();
                    const nameB = b.querySelector('.facility-name').textContent.toLowerCase();
                    return sortDir === 'az' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
                });
                cards.forEach(card => facilityGrid.appendChild(card));
            });
        }

        // Calendar navigation
        document.getElementById('calendarPrev').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('calendarNext').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        });

        // Render calendar
        let selectedCalendarDate = null;

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update month title
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            calendarMonth.textContent = `${monthNames[month]} ${year}`;
            
            // Get first day and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            // Generate calendar HTML
            let html = '';
            
            // Empty cells for days before first of month
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today.getDate() && 
                               month === today.getMonth() && 
                               year === today.getFullYear();
                
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                const isSelected = selectedCalendarDate === dateStr;
                
                // Compute overall availability from all facilities for this date
                const currentKey = document.getElementById('districtSwitcher').value;
                const dd = districts[currentKey];
                let highCount = 0, medCount = 0, lowCount = 0;
                if (dd && dd.facilities) {
                    dd.facilities.forEach(fac => {
                        const fa = getDateAvailability(fac.name, dateStr);
                        if (fa.availability === 'high') highCount++;
                        else if (fa.availability === 'medium') medCount++;
                        else lowCount++;
                    });
                }
                // Overall: if majority high -> high, if majority low -> low, else medium
                const total = highCount + medCount + lowCount;
                let availability = 'medium';
                if (highCount > total / 2) availability = 'high';
                else if (lowCount > total / 2) availability = 'low';
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" data-date="${dateStr}">
                        <span class="day-number">${day}</span>
                        <span class="day-availability ${availability}"></span>
                    </div>
                `;
            }
            
            calendarGrid.innerHTML = html;

            // Add click handlers to calendar days
            calendarGrid.querySelectorAll('.calendar-day:not(.empty)').forEach(dayEl => {
                dayEl.addEventListener('click', () => {
                    const date = dayEl.dataset.date;
                    if (selectedCalendarDate === date) {
                        selectedCalendarDate = null;
                    } else {
                        selectedCalendarDate = date;
                    }
                    // Update selected visual
                    calendarGrid.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                    if (selectedCalendarDate) {
                        dayEl.classList.add('selected');
                    }
                    renderFacilityList();
                });
            });
        }

        // Generate date-specific availability and time slots for a facility
        function getSlotData(facilityName, dateStr) {
            // Single source of truth for time slot availability across cards, list, and modal
            const dayOfWeek = new Date(dateStr + 'T12:00:00').getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

            // Consistent slot windows
            const allSlots = isWeekend
                ? ['9:00 AM', '10:00 AM', '11:00 AM', '12:00 PM', '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM', '5:00 PM', '6:00 PM', '7:00 PM']
                : ['4:00 PM', '5:00 PM', '6:00 PM', '7:00 PM', '8:00 PM'];

            // Deterministic seed from facility + date
            const seed = (facilityName + dateStr).split('').reduce((a, c) => a + c.charCodeAt(0), 0);

            // Determine which slots are booked
            const bookedCount = Math.floor((seed % 5) + 1);
            const bookedSet = new Set();
            for (let i = 0; i < bookedCount && i < allSlots.length - 1; i++) {
                bookedSet.add(allSlots[(seed + i * 3) % allSlots.length]);
            }

            // Determine which slots are pending in the current session cart
            const reservedSet = new Set();
            if (typeof cartItems !== 'undefined') {
                cartItems.forEach(ci => {
                    if (ci.facilityName === facilityName && ci.date === dateStr) {
                        reservedSet.add(ci.time);
                    }
                });
            }

            // Filter past slots if date is today
            const now = new Date();
            const isToday = new Date(dateStr + 'T12:00:00').toDateString() === now.toDateString();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();

            const toHour24 = (slot) => {
                const parts = slot.match(/(\d+):(\d+)\s*(AM|PM)/i);
                if (!parts) return 0;
                let h = parseInt(parts[1]);
                const m = parseInt(parts[2]);
                const ampm = parts[3].toUpperCase();
                if (ampm === 'PM' && h !== 12) h += 12;
                if (ampm === 'AM' && h === 12) h = 0;
                return { h, m };
            };

            const slots = allSlots.map(slot => {
                const isBooked = bookedSet.has(slot);
                const isReserved = reservedSet.has(slot);
                let isPast = false;
                if (isToday) {
                    const t = toHour24(slot);
                    isPast = t.h < currentHour || (t.h === currentHour && t.m <= currentMinute);
                }
                return { time: slot, booked: isBooked, reserved: isReserved, past: isPast, available: !isBooked && !isReserved && !isPast };
            });

            const availableSlots = slots.filter(s => s.available);
            const availCount = availableSlots.length;

            let availability;
            if (availCount === 0) availability = 'low';
            else if (availCount <= 2) availability = 'low';
            else if (availCount <= Math.ceil(allSlots.length / 2)) availability = 'medium';
            else availability = 'high';

            return {
                allSlots: slots,
                availableSlots: availableSlots.map(s => s.time),
                availability,
                isWeekend
            };
        }

        // Backwards-compatible wrapper for calendar/list views
        function getDateAvailability(facilityName, dateStr) {
            const data = getSlotData(facilityName, dateStr);
            return {
                availability: data.availability,
                slots: data.availableSlots,
                slotsCount: data.availableSlots.length
            };
        }

        // Update grid card availability indicators based on selected date
        function updateGridAvailability() {
            const activeDate = searchDate.value || null;
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d) return;

            const cards = document.querySelectorAll('#facilityGrid .facility-card');
            cards.forEach((card, i) => {
                const indicator = card.querySelector('.availability-indicator');
                if (!indicator) return;

                const facilityName = card.querySelector('.facility-name');
                if (!facilityName) return;
                const name = facilityName.textContent;

                // Find matching facility in config
                const facility = d.facilities.find(f => f.name === name);
                if (!facility) return;

                let newAvail;
                if (activeDate) {
                    const dateInfo = getDateAvailability(name, activeDate);
                    newAvail = dateInfo.availability;
                } else {
                    newAvail = facility.availability;
                }

                // Update indicator class
                indicator.classList.remove('high', 'medium', 'low');
                indicator.classList.add(newAvail);
                const titleMap = { high: 'High availability', medium: 'Limited availability', low: 'Almost full' };
                indicator.title = titleMap[newAvail] || '';
            });
        }

        // Render facility list panel (calendar view right side)
        function renderFacilityList() {
            const panel = document.getElementById('facilityListPanel');
            if (!panel) return;
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d) return;

            // Update title with org name
            const listTitle = document.getElementById('facilityListTitle');
            if (listTitle) listTitle.textContent = d.name + ' Facilities';
            const legendTitle = document.getElementById('legendTitle');
            if (legendTitle) legendTitle.textContent = 'Availability at ' + d.name;

            // Check for selected date from calendar or date picker
            const activeDate = selectedCalendarDate || searchDate.value || null;

            // Update subtitle based on date selection
            const listSubtitle = document.getElementById('facilityListSubtitle');
            if (listSubtitle) {
                if (activeDate) {
                    const dateObj = new Date(activeDate + 'T12:00:00');
                    const dateLabel = dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
                    listSubtitle.textContent = 'Availability for ' + dateLabel;
                } else {
                    const now = new Date();
                    const monthYear = now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    listSubtitle.textContent = 'Availability for ' + monthYear;
                }
            }

            // Get active filters
            const facilityTypeFilter = searchFacilityType ? searchFacilityType.value : '';
            const schoolFilter = document.getElementById('searchSchool') ? document.getElementById('searchSchool').value : '';
            const gsSlider = document.getElementById('searchGuests');
            const gsIdx = gsSlider ? parseInt(gsSlider.value) : 0;
            const gsThresholds = [0, 10, 50, 100, 200, 500, 501];
            const minCap = gsThresholds[gsIdx] || 0;

            let html = '';

            d.facilities.forEach(f => {
                // Apply filters
                if (facilityTypeFilter) {
                    if (!f.type.toLowerCase().includes(facilityTypeFilter)) return;
                }
                if (schoolFilter) {
                    const school = d.schools.find(s => s.value === schoolFilter);
                    if (school && !f.location.includes(school.label.split(' ').slice(0, 2).join(' '))) return;
                }
                if (minCap > 0) {
                    const capNum = parseInt(f.capacity.replace(/[^0-9]/g, '')) || 0;
                    if (gsIdx === 6) { if (capNum <= 500) return; }
                    else { if (capNum < minCap) return; }
                }
                let availability = f.availability;
                let slotsHTML = '';
                let availLabel;

                if (activeDate) {
                    const dateInfo = getDateAvailability(f.name, activeDate);
                    availability = dateInfo.availability;
                    if (dateInfo.slots.length > 0) {
                        slotsHTML = '<div class="list-item-slots">' + dateInfo.slots.map(s => `<span class="list-item-slot">${s}</span>`).join('') + '</div>';
                    }
                }

                availLabel = availability === 'high' ? 'Available' : availability === 'medium' ? 'Limited' : 'Almost Full';

                // Weather for list items
                let weatherHTML = '';
                if (!f.outdoor) {
                    weatherHTML = '<span class="list-item-weather">Indoors</span>';
                } else if (d.weather) {
                    let weatherData = null;
                    if (activeDate && d.weather.forecast && d.weather.forecast[activeDate]) {
                        weatherData = d.weather.forecast[activeDate];
                    } else if (!activeDate && d.weather.today) {
                        weatherData = d.weather.today;
                    }
                    if (weatherData) {
                        weatherHTML = `<span class="list-item-weather"><span class="weather-icon-small">${weatherData.icon}</span> ${weatherData.temp}F</span>`;
                    }
                }

                const bookedIcon = f.lastBooked.includes('Last booked') ? '<svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' : '<svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.4 7.4H22l-6 4.6 2.3 7-6.3-4.6L5.7 21 8 14l-6-4.6h7.6z"/></svg>';

                html += `
                    <div class="facility-list-item">
                        <div class="list-item-icon">${d.logo ? `<img src="${d.logo}" alt="${d.name}" style="width:22px;height:22px;object-fit:contain;transform:scale(${d.logoScale || 1})">` : `<svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg>`}</div>
                        <div class="list-item-content">
                            <div class="list-item-name">${f.name}</div>
                            <div class="list-item-location">${f.location}</div>
                            <div class="list-item-meta">
                                <span>${f.type}</span>
                                <span class="meta-dot"></span>
                                <span class="price">${f.price}</span>
                                <span class="meta-dot"></span>
                                <span>${f.capacity}</span>
                            </div>
                            ${slotsHTML}
                        </div>
                        <div class="list-item-right">
                            <div class="list-item-availability ${availability}">
                                <span class="avail-dot"></span> ${availLabel}
                            </div>
                            <span class="list-item-booked">${bookedIcon} ${f.lastBooked}</span>
                            ${weatherHTML}
                        </div>
                    </div>
                `;
            });

            if (!html) {
                const msg = getEmptyStateMessage();
                html = `<div class="calendar-empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                    <h4>${msg.title}</h4>
                    <p>${msg.text}</p>
                </div>`;
            }
            panel.innerHTML = html;
        }

        // Facility Type Filter
        const searchFacilityType = document.getElementById('searchFacilityType');

        // Activity to facility type mapping
        const activityFacilityMap = {
            'badminton': ['gymnasium'],
            'baseball': ['stadium'],
            'basketball': ['gymnasium'],
            'cheer': ['gymnasium', 'stadium'],
            'cross-country': ['stadium', 'outdoor'],
            'field-hockey': ['stadium', 'outdoor'],
            'fitness': ['gymnasium'],
            'football': ['stadium'],
            'golf': ['outdoor'],
            'gymnastics': ['gymnasium'],
            'lacrosse': ['stadium', 'outdoor'],
            'martial-arts': ['gymnasium'],
            'pickleball': ['gymnasium', 'outdoor'],
            'soccer': ['stadium'],
            'swimming': ['pool'],
            'tennis': ['outdoor'],
            'track': ['stadium', 'outdoor'],
            'volleyball': ['gymnasium'],
            'weightlifting': ['gymnasium'],
            'wrestling': ['gymnasium'],
            'yoga': ['gymnasium', 'classroom'],
            'awards': ['auditorium', 'cafeteria'],
            'concert': ['auditorium'],
            'dance': ['auditorium', 'gymnasium'],
            'fair': ['outdoor', 'stadium', 'cafeteria'],
            'fundraiser': ['cafeteria', 'gymnasium', 'auditorium'],
            'graduation': ['auditorium', 'stadium'],
            'movie': ['auditorium'],
            'party': ['cafeteria', 'gymnasium', 'outdoor'],
            'pep-rally': ['gymnasium', 'stadium'],
            'theater': ['auditorium'],
            'class': ['classroom', 'meeting'],
            'meeting': ['meeting', 'classroom'],
            'orientation': ['auditorium', 'cafeteria'],
            'professional-dev': ['classroom', 'meeting'],
            'testing': ['classroom', 'cafeteria'],
            'training': ['classroom', 'meeting', 'gymnasium'],
            'tutoring': ['classroom', 'meeting'],
            'blood-drive': ['cafeteria', 'gymnasium'],
            'camp': ['gymnasium', 'outdoor', 'cafeteria'],
            'farmers-market': ['outdoor', 'cafeteria'],
            'health-screening': ['cafeteria', 'gymnasium'],
            'religious': ['auditorium', 'cafeteria'],
            'scouts': ['classroom', 'meeting', 'cafeteria'],
            'voting': ['cafeteria', 'gymnasium'],
            'other': []
        };

        // Auto-set facility type when activity is selected, then apply filters
        activityType.addEventListener('change', () => {
            if (activityType.value) {
                const facilityTypes = activityFacilityMap[activityType.value] || [];
                if (facilityTypes.length > 0 && searchFacilityType) {
                    searchFacilityType.value = facilityTypes[0];
                }
            } else if (searchFacilityType) {
                searchFacilityType.value = '';
            }
            applyAllFilters();
        });

        // Amenities multi-select
        const amenitiesPanel = document.getElementById('amenitiesPanel');
        const amenitiesBtn = document.getElementById('amenitiesBtn');
        const amenitiesBtnText = document.getElementById('amenitiesBtnText');
        const amenityChecks = amenitiesPanel ? amenitiesPanel.querySelectorAll('input[type="checkbox"]') : [];

        function updateAmenitiesText() {
            const checked = Array.from(amenityChecks).filter(c => c.checked);
            if (checked.length === 0) {
                amenitiesBtnText.textContent = 'Any amenities';
                amenitiesBtn.classList.remove('has-selection');
            } else if (checked.length === 1) {
                amenitiesBtnText.textContent = checked[0].parentElement.textContent.trim();
                amenitiesBtn.classList.add('has-selection');
            } else {
                amenitiesBtnText.textContent = checked.length + ' selected';
                amenitiesBtn.classList.add('has-selection');
            }
        }

        amenityChecks.forEach(cb => {
            cb.addEventListener('change', () => {
                updateAmenitiesText();
                applyAllFilters();
            });
        });

        // Wire optional filter dropdowns to apply immediately
        if (searchFacilityType) {
            searchFacilityType.addEventListener('change', () => { applyAllFilters(); });
        }
        const searchSchoolEl = document.getElementById('searchSchool');
        if (searchSchoolEl) {
            searchSchoolEl.addEventListener('change', () => { applyAllFilters(); });
        }

        // Close amenities panel on outside click
        document.addEventListener('click', (e) => {
            if (amenitiesPanel && !e.target.closest('.amenities-field')) {
                amenitiesPanel.classList.remove('open');
                amenitiesBtn.classList.remove('active');
            }
        });

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        if (themeToggle) {
            themeToggle.onclick = function() {
                const currentTheme = html.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', newTheme);
            };
        }

        // Theme toggle handled by inline onclick

        // Close user menu on click outside
        document.addEventListener('click', function(e) {
            const wrapper = document.getElementById('userMenuWrapper');
            if (wrapper && !wrapper.contains(e.target)) {
                wrapper.classList.remove('open');
            }
            const helpWrapper = document.getElementById('helpMenuWrapper');
            if (helpWrapper && !helpWrapper.contains(e.target)) {
                helpWrapper.classList.remove('open');
            }
        });

        // Compact header on scroll
        const headerEl = document.querySelector('.header');
        const demoBar = document.querySelector('.demo-bar');
        
        // Position header below demo bar
        function updateHeaderTop() {
            if (demoBar) {
                const demoBarHeight = demoBar.offsetHeight;
                headerEl.style.top = demoBarHeight + 'px';
            }
        }
        updateHeaderTop();
        window.addEventListener('resize', updateHeaderTop);

        // Duration slider
        const durationSlider = document.getElementById('searchDuration');
        const durationValue = document.getElementById('durationValue');
        const durationLabels = ['1 hour', '2 hours', '3 hours', '4 hours', '5 hours', '6 hours', '7 hours', '8 hours'];
        
        if (durationSlider && durationValue) {
            durationSlider.oninput = function() {
                const val = parseInt(this.value);
                durationValue.textContent = durationLabels[val - 1];
                applyAllFilters();
            };
        }

        // Group size slider
        const groupSizeSlider = document.getElementById('searchGuests');
        const groupSizeValue = document.getElementById('groupSizeValue');
        const groupSizeLabels = ['Any size', 'Up to 10', 'Up to 50', 'Up to 100', 'Up to 200', 'Up to 500', '500+'];
        
        if (groupSizeSlider && groupSizeValue) {
            groupSizeSlider.oninput = function() {
                const val = parseInt(this.value);
                groupSizeValue.textContent = groupSizeLabels[val];
                applyAllFilters();
            };
        }

        // =============================================
        // DISTRICT DEMO SWITCHER
        // =============================================
        const districts = {
            lovejoy: {
                name: 'Lovejoy ISD',
                location: 'Lucas, Texas',
                logo: 'https://res.cloudinary.com/dpj2i1xui/image/upload/v1770050511/Asset_3lovejoy-logo_tebuxt.svg',
                logoScale: 0.82,
                colors: { light: '#1a1a1a', dark: '#1a1a1a', primary: '#CC0000', secondary: '#1a1a1a', cta: '#CC0000', ctaDark: '#ef4444', brandLight: '#fce8e8', brandLightAlt: '#f8d4d4', chipBg: '#fce8e8', heroBg: '#CC0000', heroBgDark: '#8a0000', primaryDark: '#ef4444', secondaryDark: '#555555', lightDark: '#2a1a1a', hoverShadow: 'rgba(204, 0, 0, 0.2)', stripe: 'rgba(204, 0, 0, 0.02)', hover: '#a30000', dark: '#1a1a1a', hoverDark: '#ef4444', darkDark: '#CC0000' },
                weather: {
                    today: { temp: 50, condition: 'Sunny', icon: '' },
                    forecast: {
                        '2026-02-01': { temp: 50, condition: 'Sunny', icon: '' },
                        '2026-02-02': { temp: 64, condition: 'Partly cloudy', icon: '' },
                        '2026-02-03': { temp: 61, condition: 'Mostly cloudy', icon: '' },
                        '2026-02-04': { temp: 55, condition: 'Partly cloudy', icon: '' },
                        '2026-02-05': { temp: 60, condition: 'Sunny', icon: '' }
                    }
                },
                stats: { facilities: '6', startingPrice: '$40', avgResponse: '<2hr' },
                schools: [
                    { value: 'lovejoy-hs', label: 'Lovejoy High School' },
                    { value: 'willow-springs-ms', label: 'Willow Springs Middle School' },
                    { value: 'sloan-creek', label: 'Sloan Creek Intermediate' },
                    { value: 'hart-elem', label: 'Hart Elementary' },
                    { value: 'puster-elem', label: 'Puster Elementary' }
                ],
                facilities: [
                    { name: 'Leopard Stadium', location: 'Lovejoy High School', icon: 'LHS', type: 'Field', price: '$150/hr', capacity: '2,000 capacity', availability: 'high', outdoor: true, lastBooked: 'Last booked 3hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Practice Fields', location: 'Lovejoy High School', icon: 'LHS', type: 'Field', price: '$60/hr', capacity: 'Open field', availability: 'high', outdoor: true, lastBooked: 'Last booked 1hr ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Sloan Creek Sports Complex', location: 'Sloan Creek Intermediate', icon: 'SC', type: 'Field', price: '$80/hr', capacity: '500 capacity', availability: 'medium', outdoor: true, lastBooked: 'Last booked 2hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Main Gym', location: 'Lovejoy High School', icon: 'LHS', type: 'Gymnasium', price: '$75/hr', capacity: '500 capacity', availability: 'medium', outdoor: false, lastBooked: 'Last booked 2hrs ago', image: 'https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Performing Arts Center', location: 'Lovejoy High School', icon: 'LHS', type: 'Auditorium', price: '$200/hr', capacity: '800 seats', availability: 'low', outdoor: false, lastBooked: 'Last booked 5hrs ago', image: 'https://images.unsplash.com/photo-1596522354195-e84ae3c98731?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Gymnasium', location: 'Hart Elementary', icon: 'HE', type: 'Gymnasium', price: '$40/hr', capacity: '200 capacity', availability: 'high', outdoor: false, lastBooked: 'Last booked 1hr ago', image: 'https://images.unsplash.com/photo-1740635341299-3b8e3490f546?w=600&h=360&fit=crop&auto=format' }
                ],
                info: {
                    about: 'The Lovejoy Independent School District, founded in 1917, is a public school district located three miles east of Allen and about 25 miles north of Dallas in the rapidly growing region of central Collin County. Lovejoy ISD serves over 4,500 students across six campuses and is recognized for its strong academics and state-competitive athletics programs.',
                    thingsToKnow: [
                        { title: 'Cancellation Policy', text: 'Reservations must be canceled 7 days prior to event for refund. Any credits given for cancellations or changes must be used within 6 months.' },
                        { title: 'Parking Tips', text: 'All athletic facilities are accessible from the rear parking lots. Visitor parking is available in designated lots at each campus.' },
                        { title: 'Insurance Requirements', text: 'All renters must provide a certificate of liability insurance naming the district as additionally insured prior to facility use.' }
                    ],
                    address: '2350 Estates Parkway, Lucas, TX 75002',
                    website: { url: 'https://www.lovejoyisd.net', label: 'lovejoyisd.net' },
                    mapQuery: 'Lovejoy+ISD+Lucas+TX',
                    mapCoords: { lat: 33.084, lng: -96.585 }
                }
            },
            ascension: {
                name: 'Ascension Parish Schools',
                location: 'Gonzales, Louisiana',
                logo: 'https://res.cloudinary.com/dpj2i1xui/image/upload/v1770050510/Asset_1ascension-logo_zwj5tq.svg',
                logoScale: 0.82,
                colors: { light: '#8C8C8C', dark: '#B2122B', primary: '#B2122B', secondary: '#8C8C8C', cta: '#B2122B', ctaDark: '#e84a60', brandLight: '#fae8eb', brandLightAlt: '#f5d5da', chipBg: '#fae8eb', heroBg: '#B2122B', heroBgDark: '#7a0c1d', primaryDark: '#e84a60', secondaryDark: '#b0b0b0', lightDark: '#2a1a1d', hoverShadow: 'rgba(178, 18, 43, 0.2)', stripe: 'rgba(178, 18, 43, 0.02)', hover: '#8e0e22', dark: '#7a0c1d', hoverDark: '#e84a60', darkDark: '#B2122B' },
                weather: {
                    today: { temp: 46, condition: 'Mostly sunny', icon: '' },
                    forecast: {
                        '2026-02-01': { temp: 46, condition: 'Mostly sunny', icon: '' },
                        '2026-02-02': { temp: 63, condition: 'Partly cloudy', icon: '' },
                        '2026-02-03': { temp: 69, condition: 'Chance of rain', icon: '' },
                        '2026-02-04': { temp: 59, condition: 'Scattered showers', icon: '' },
                        '2026-02-05': { temp: 55, condition: 'Sunny', icon: '' }
                    }
                },
                stats: { facilities: '10', startingPrice: '$35', avgResponse: '<3hr' },
                schools: [
                    { value: 'east-ascension', label: 'East Ascension High School' },
                    { value: 'dutchtown-hs', label: 'Dutchtown High School' },
                    { value: 'st-amant-hs', label: 'St. Amant High School' },
                    { value: 'donaldsonville-hs', label: 'Donaldsonville High School' },
                    { value: 'prairieville-hs', label: 'Prairieville High School' },
                    { value: 'dutchtown-ms', label: 'Dutchtown Middle School' },
                    { value: 'galvez-ms', label: 'Galvez Middle School' },
                    { value: 'st-amant-ms', label: 'St. Amant Middle School' }
                ],
                facilities: [
                    { name: 'Spartan Stadium', location: 'East Ascension High School', icon: 'EA', type: 'Stadium / Field', price: '$125/hr', capacity: '7,500 capacity', availability: 'medium', outdoor: true, lastBooked: 'Last booked 3hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Griffin Stadium', location: 'Dutchtown High School', icon: 'DHS', type: 'Stadium / Field', price: '$125/hr', capacity: '6,000 capacity', availability: 'low', outdoor: true, lastBooked: 'Last booked 1hr ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Practice Fields', location: 'East Ascension High School', icon: 'EA', type: 'Field', price: '$50/hr', capacity: 'Open field', availability: 'high', outdoor: true, lastBooked: 'Last booked 45min ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Gator Field', location: 'St. Amant High School', icon: 'SA', type: 'Field', price: '$75/hr', capacity: '2,500 capacity', availability: 'medium', outdoor: true, lastBooked: 'Last booked 2hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Main Gymnasium', location: 'East Ascension High School', icon: 'EA', type: 'Gymnasium', price: '$60/hr', capacity: '2,000 capacity', availability: 'medium', outdoor: false, lastBooked: 'Last booked 4hrs ago', image: 'https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Performing Arts Center', location: 'Dutchtown High School', icon: 'DHS', type: 'Auditorium', price: '$100/hr', capacity: '700 seats', availability: 'high', outdoor: false, lastBooked: 'Last booked 6hrs ago', image: 'https://images.unsplash.com/photo-1519452575417-564c1401ecc0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Gator Gymnasium', location: 'St. Amant High School', icon: 'SA', type: 'Gymnasium', price: '$55/hr', capacity: '1,800 capacity', availability: 'medium', outdoor: false, lastBooked: 'Last booked 2hrs ago', image: 'https://plus.unsplash.com/premium_photo-1675364966937-c2bdf5bce9b5?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Gymnasium', location: 'Galvez Middle School', icon: 'GMS', type: 'Gymnasium', price: '$35/hr', capacity: '500 capacity', availability: 'high', outdoor: false, lastBooked: 'Last booked 4hrs ago', image: 'https://images.unsplash.com/photo-1687216769793-833dcfe4e3af?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Cafeteria', location: 'Dutchtown Middle School', icon: 'DMS', type: 'Cafeteria', price: '$40/hr', capacity: '300 capacity', availability: 'high', outdoor: false, lastBooked: 'New listing - be the first to book', image: 'https://images.unsplash.com/photo-1631193659550-5c8a2cc57015?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Hurricane Arena', location: 'Prairieville High School', icon: 'PHS', type: 'Gymnasium', price: '$65/hr', capacity: '2,200 capacity', availability: 'low', outdoor: false, lastBooked: 'Last booked 30min ago', image: 'https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format' }
                ],
                info: {
                    about: 'Ascension Parish Schools serves over 23,000 students across 29 schools in one of Louisiana\'s fastest-growing parishes. Located along the Mississippi River between Baton Rouge and New Orleans, the district is known for strong athletic programs and modern facilities that serve both students and the broader community.',
                    thingsToKnow: [
                        { title: 'Cancellation Policy', text: 'Cancellations must be submitted at least 5 business days before the reservation date. Late cancellations may forfeit the rental deposit.' },
                        { title: 'Parking Tips', text: 'Stadium events require parking in designated overflow lots. Follow signage at each campus for visitor and event parking areas.' },
                        { title: 'Weather Policy', text: 'Outdoor facility rentals may be postponed due to severe weather. The district will coordinate rescheduling within 30 days at no additional cost.' }
                    ],
                    address: '1100 Webster St, Donaldsonville, LA 70346',
                    website: { url: 'https://www.apsb.org', label: 'apsb.org' },
                    mapQuery: 'Ascension+Parish+Schools+Gonzales+LA',
                    mapCoords: { lat: 30.2388, lng: -90.9201 }
                }
            },
            reynoldsburg: {
                name: 'Reynoldsburg City Schools',
                location: 'Reynoldsburg, Ohio',
                logo: 'https://res.cloudinary.com/dpj2i1xui/image/upload/v1770050510/Asset_2reynoldsburg-logo_eh32yp.svg',
                logoScale: 0.82,
                colors: { light: '#f5a623', dark: '#6B2D8B', primary: '#6B2D8B', secondary: '#f5a623', cta: '#6B2D8B', ctaDark: '#b07cd8', brandLight: '#e0d2ea', brandLightAlt: '#e9e0ee', chipBg: '#e0d2ea', heroBg: '#6B2D8B', heroBgDark: '#3a1850', primaryDark: '#b07cd8', secondaryDark: '#ffd966', lightDark: '#2a1a3a', hoverShadow: 'rgba(107, 45, 139, 0.2)', stripe: 'rgba(107, 45, 139, 0.02)', hover: '#552270', dark: '#3a1850', hoverDark: '#9a6ac0', darkDark: '#6B2D8B' },
                weather: {
                    today: { temp: 19, condition: 'Partly sunny', icon: '' },
                    forecast: {
                        '2026-02-01': { temp: 19, condition: 'Partly sunny', icon: '' },
                        '2026-02-02': { temp: 25, condition: 'Chance of snow', icon: '' },
                        '2026-02-03': { temp: 29, condition: 'Mostly cloudy', icon: '' },
                        '2026-02-04': { temp: 23, condition: 'Chance of snow', icon: '' },
                        '2026-02-05': { temp: 21, condition: 'Cloudy', icon: '' }
                    }
                },
                stats: { facilities: '8', startingPrice: '$35', avgResponse: '<3hr' },
                schools: [
                    { value: 'rhs-eacad', label: 'Reynoldsburg eSTEM Academy' },
                    { value: 'rhs-lincoln', label: 'Lincoln High School' },
                    { value: 'rhs-summit', label: 'Summit Road Middle School' },
                    { value: 'rhs-hannah', label: 'Hannah Ashton Middle School' },
                    { value: 'rhs-rose', label: 'Rose Hill Elementary' }
                ],
                facilities: [
                    { name: 'Raider Stadium', location: 'Reynoldsburg eSTEM Academy', icon: 'RHS', type: 'Stadium / Field', price: '$125/hr', capacity: '5,000 capacity', availability: 'medium', outdoor: true, lastBooked: 'Last booked 2hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Track & Field Complex', location: 'Reynoldsburg eSTEM Academy', icon: 'RHS', type: 'Field', price: '$60/hr', capacity: '1,000 capacity', availability: 'high', outdoor: true, lastBooked: 'Last booked 1hr ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Summit Road Practice Fields', location: 'Summit Road Middle School', icon: 'SR', type: 'Field', price: '$40/hr', capacity: 'Open field', availability: 'high', outdoor: true, lastBooked: 'Last booked 3hrs ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Main Gymnasium', location: 'Reynoldsburg eSTEM Academy', icon: 'RHS', type: 'Gymnasium', price: '$60/hr', capacity: '2,500 capacity', availability: 'medium', outdoor: false, lastBooked: 'Last booked 1hr ago', image: 'https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Performing Arts Center', location: 'Lincoln High School', icon: 'LN', type: 'Auditorium', price: '$100/hr', capacity: '750 seats', availability: 'low', outdoor: false, lastBooked: 'Last booked 45min ago', image: 'https://images.unsplash.com/photo-1596522354195-e84ae3c98731?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Auxiliary Gym', location: 'Summit Road Middle School', icon: 'SR', type: 'Gymnasium', price: '$35/hr', capacity: '400 capacity', availability: 'high', outdoor: false, lastBooked: 'Last booked 4hrs ago', image: 'https://plus.unsplash.com/premium_photo-1675364966937-c2bdf5bce9b5?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Competition Gym', location: 'Hannah Ashton Middle School', icon: 'HA', type: 'Gymnasium', price: '$45/hr', capacity: '600 capacity', availability: 'high', outdoor: false, lastBooked: 'New listing - be the first to book', image: 'https://images.unsplash.com/photo-1687216769793-833dcfe4e3af?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Cafeteria', location: 'Rose Hill Elementary', icon: 'RH', type: 'Cafeteria', price: '$35/hr', capacity: '300 capacity', availability: 'high', outdoor: false, lastBooked: 'Recently added to PracticePlan', image: 'https://images.unsplash.com/photo-1552058461-dc1828d58bf6?w=600&h=360&fit=crop&auto=format' }
                ],
                info: {
                    about: 'Reynoldsburg City Schools serves approximately 8,200 students in the eastern Columbus metro area. The district operates under an innovative eSTEM model integrating science, technology, engineering, and math across all grade levels. Its facilities host a wide range of community sports leagues, performing arts events, and recreational programming year-round.',
                    thingsToKnow: [
                        { title: 'Cancellation Policy', text: 'Reservations may be canceled up to 10 days in advance for a full refund. Cancellations within 10 days are subject to a 50% fee.' },
                        { title: 'Parking Tips', text: 'Main campus parking is available in Lots A and B off Main Street. Overflow parking for stadium events is in the gravel lot off Livingston Ave.' },
                        { title: 'Winter Hours', text: 'Facility availability may be reduced during winter weather advisories. Indoor facilities remain available unless a school closure is declared.' }
                    ],
                    address: '7244 E Main St, Reynoldsburg, OH 43068',
                    website: { url: 'https://www.reyn.org', label: 'reyn.org' },
                    mapQuery: 'Reynoldsburg+City+Schools+OH',
                    mapCoords: { lat: 39.9559, lng: -82.7963 }
                }
            },
            princeedward: {
                name: 'Prince Edward County',
                location: 'Farmville, Virginia',
                logo: 'https://res.cloudinary.com/dpj2i1xui/image/upload/v1770050511/Asset_4princeedward-logo_g5yw94.svg',
                logoScale: 1,
                colors: { light: '#00a84f', dark: '#0076bb', primary: '#0076bb', secondary: '#00a84f', cta: '#0076bb', ctaDark: '#4d9fcf', brandLight: '#d9f2e5', brandLightAlt: '#d9eaf5', chipBg: '#d9f2e5', heroBg: '#0076bb', heroBgDark: '#005383', primaryDark: '#4d9fcf', secondaryDark: '#33b972', lightDark: '#0076bb1a', hoverShadow: 'rgba(0, 118, 187, 0.2)', stripe: 'rgba(0, 118, 187, 0.04)', hover: '#00649f', brandDark: '#00598c', hoverDark: '#3391c9', darkDark: '#0076bb' },
                weather: {
                    today: { temp: 42, condition: 'Partly cloudy', icon: '' },
                    forecast: {
                        '2026-02-01': { temp: 42, condition: 'Partly cloudy', icon: '' },
                        '2026-02-02': { temp: 52, condition: 'Mostly sunny', icon: '' },
                        '2026-02-03': { temp: 48, condition: 'Cloudy', icon: '' },
                        '2026-02-04': { temp: 44, condition: 'Chance of rain', icon: '' },
                        '2026-02-05': { temp: 50, condition: 'Sunny', icon: '' }
                    }
                },
                stats: { facilities: '7', startingPrice: '$25', avgResponse: '<2hr' },
                schools: [
                    { value: 'pe-hs', label: 'Prince Edward County High School' },
                    { value: 'pe-ms', label: 'Prince Edward County Middle School' },
                    { value: 'pe-elem', label: 'Prince Edward Elementary' }
                ],
                facilities: [
                    { name: 'Eagle Stadium', location: 'Prince Edward County High School', icon: 'PE', type: 'Stadium / Field', price: '$100/hr', capacity: '3,000 capacity', availability: 'medium', outdoor: true, lastBooked: 'Last booked 2hrs ago', image: 'https://images.unsplash.com/photo-1565673686362-85864074640a?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Baseball Diamond', location: 'Prince Edward County High School', icon: 'PE', type: 'Field', price: '$60/hr', capacity: '500 capacity', availability: 'high', outdoor: true, lastBooked: 'Last booked 4hrs ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Middle School Practice Field', location: 'Prince Edward County Middle School', icon: 'MS', type: 'Field', price: '$35/hr', capacity: 'Open field', availability: 'high', outdoor: true, lastBooked: 'Last booked 1hr ago', image: 'https://plus.unsplash.com/premium_photo-1685089027812-6885c06b0fbf?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Eagle Gymnasium', location: 'Prince Edward County High School', icon: 'PE', type: 'Gymnasium', price: '$50/hr', capacity: '1,200 capacity', availability: 'medium', outdoor: false, lastBooked: 'Last booked 3hrs ago', image: 'https://images.unsplash.com/photo-1549081231-203e069916f0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Auditorium', location: 'Prince Edward County High School', icon: 'PE', type: 'Auditorium', price: '$75/hr', capacity: '500 seats', availability: 'low', outdoor: false, lastBooked: 'Last booked 5hrs ago', image: 'https://images.unsplash.com/photo-1519452575417-564c1401ecc0?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Competition Gym', location: 'Prince Edward County Middle School', icon: 'MS', type: 'Gymnasium', price: '$35/hr', capacity: '400 capacity', availability: 'high', outdoor: false, lastBooked: 'Last booked 1hr ago', image: 'https://plus.unsplash.com/premium_photo-1675364966937-c2bdf5bce9b5?w=600&h=360&fit=crop&auto=format' },
                    { name: 'Multipurpose Room', location: 'Prince Edward Elementary', icon: 'PEE', type: 'Cafeteria', price: '$25/hr', capacity: '200 capacity', availability: 'high', outdoor: false, lastBooked: 'New listing - be the first to book', image: 'https://images.unsplash.com/photo-1740635341299-3b8e3490f546?w=600&h=360&fit=crop&auto=format' }
                ],
                info: {
                    about: 'Prince Edward County Public Schools serves approximately 1,800 students across three campuses in Farmville, Virginia. The district holds deep historical significance as the site of the 1951 student walkout at Moton High School, a pivotal moment in the Civil Rights Movement that contributed to Brown v. Board of Education. Today, the Eagles carry forward a legacy of courage and community with competitive athletics and growing facility rental partnerships.',
                    thingsToKnow: [
                        { title: 'Cancellation Policy', text: 'Reservations may be canceled up to 5 business days in advance for a full refund. Late cancellations are subject to a 50% fee.' },
                        { title: 'Parking Tips', text: 'All facilities are located on the main campus at 35 Eagle Drive. Visitor parking is available in the front and side lots.' },
                        { title: 'Insurance Requirements', text: 'Renters must provide proof of general liability insurance naming Prince Edward County Public Schools as additionally insured.' }
                    ],
                    address: '35 Eagle Drive, Farmville, VA 23901',
                    website: { url: 'https://www.pecps.k12.va.us', label: 'pecps.k12.va.us' },
                    mapQuery: 'Prince+Edward+County+High+School+Farmville+VA',
                    mapCoords: { lat: 37.2879, lng: -78.3947 }
                }
            }
        };

        // Snapshot each district's original brand colors (immutable reference for picker presets)
        const districtOriginalColors = {};
        Object.keys(districts).forEach(key => {
            const c = districts[key].colors;
            const seen = new Set();
            const colors = [];
            const candidates = [
                { hex: c.light || c.secondary || c.primary, label: 'Primary' },
                { hex: c.dark || c.primary, label: 'Secondary' },
                { hex: c.cta || c.primary, label: 'Button' },
                { hex: c.heroBg || c.primary, label: 'Header' }
            ];
            candidates.forEach(item => {
                const norm = item.hex.toUpperCase();
                if (!seen.has(norm)) {
                    seen.add(norm);
                    colors.push({ hex: item.hex, label: item.label });
                }
            });
            districtOriginalColors[key] = colors;
        });

        // Sync picker inputs + hex labels to current district colors
        function syncPalette(c) {
            const lightVal = c.light || c.secondary || c.primary;
            const darkVal = c.dark || c.primary;
            const ctaVal = c.cta || c.primary;
            const headerVal = c.heroBg || c.primary;
            // Hidden native inputs
            document.getElementById('customColor1').value = lightVal;
            document.getElementById('customColor2').value = darkVal;
            document.getElementById('customColorCta').value = ctaVal;
            document.getElementById('customColorHeader').value = headerVal;
            // Visible swatches
            document.getElementById('swatchPrimary').style.background = lightVal;
            document.getElementById('swatchSecondary').style.background = darkVal;
            document.getElementById('swatchButton').style.background = ctaVal;
            document.getElementById('swatchHeader').style.background = headerVal;
            // Hex inputs
            document.getElementById('hexPrimary').value = lightVal.toUpperCase();
            document.getElementById('hexSecondary').value = darkVal.toUpperCase();
            document.getElementById('hexButton').value = ctaVal.toUpperCase();
            document.getElementById('hexHeader').value = headerVal.toUpperCase();
            // Populate brand preset swatches
            populateBrandSwatches();
        }

        // Get the 4 unique default brand colors for the current district
        function getDistrictBrandColors() {
            const key = document.getElementById('districtSwitcher').value;
            return districtOriginalColors[key] || [];
        }

        function populateBrandSwatches() {
            const brandColors = getDistrictBrandColors();
            ['Primary', 'Secondary', 'Button', 'Header'].forEach(picker => {
                const container = document.getElementById('dd' + picker + 'Swatches');
                if (!container) return;
                container.innerHTML = '';
                const currentVal = document.getElementById(
                    picker === 'Primary' ? 'customColor1' :
                    picker === 'Secondary' ? 'customColor2' :
                    picker === 'Button' ? 'customColorCta' : 'customColorHeader'
                ).value.toUpperCase();
                brandColors.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'demo-dd-swatch' + (item.hex.toUpperCase() === currentVal ? ' active' : '');
                    el.style.background = item.hex;
                    el.setAttribute('data-tooltip', item.label);
                    el.onclick = function(e) {
                        e.stopPropagation();
                        applyColorToPicker(picker.toLowerCase(), item.hex);
                    };
                    container.appendChild(el);
                });
            });
        }

        function toggleColorDropdown(picker) {
            const dd = document.getElementById('dd' + picker.charAt(0).toUpperCase() + picker.slice(1));
            const wasOpen = dd.classList.contains('open');
            // Close all
            document.querySelectorAll('.demo-color-dropdown').forEach(d => d.classList.remove('open'));
            if (!wasOpen) {
                dd.classList.add('open');
                // Focus hex input
                const hexInput = dd.querySelector('.demo-dd-hex');
                if (hexInput) setTimeout(() => hexInput.select(), 50);
            }
        }

        function applyColorToPicker(picker, hex) {
            const inputId = picker === 'primary' ? 'customColor1' :
                            picker === 'secondary' ? 'customColor2' :
                            picker === 'button' ? 'customColorCta' : 'customColorHeader';
            const swatchId = 'swatch' + picker.charAt(0).toUpperCase() + picker.slice(1);
            const hexId = 'hex' + picker.charAt(0).toUpperCase() + picker.slice(1);
            document.getElementById(inputId).value = hex;
            document.getElementById(swatchId).style.background = hex;
            document.getElementById(hexId).value = hex.toUpperCase();
            document.querySelectorAll('.demo-color-dropdown').forEach(d => d.classList.remove('open'));
            updateDistrictColors();
        }

        function applyHexInput(picker) {
            const hexId = 'hex' + picker.charAt(0).toUpperCase() + picker.slice(1);
            let val = document.getElementById(hexId).value.trim();
            if (!val.startsWith('#')) val = '#' + val;
            if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
                applyColorToPicker(picker, val);
            }
        }

        function openNativePicker(inputId, picker) {
            document.querySelectorAll('.demo-color-dropdown').forEach(d => d.classList.remove('open'));
            const input = document.getElementById(inputId);
            // Temporarily make visible so browser can open the picker
            input.style.visibility = 'visible';
            input.style.pointerEvents = 'auto';
            // Listen for change to sync swatch and re-hide
            const syncAndHide = function() {
                const swatchId = 'swatch' + picker.charAt(0).toUpperCase() + picker.slice(1);
                const hexId = 'hex' + picker.charAt(0).toUpperCase() + picker.slice(1);
                document.getElementById(swatchId).style.background = input.value;
                document.getElementById(hexId).value = input.value.toUpperCase();
                updateDistrictColors();
            };
            input.addEventListener('input', syncAndHide);
            input.addEventListener('change', function onDone() {
                syncAndHide();
                input.style.visibility = 'hidden';
                input.style.pointerEvents = 'none';
                input.removeEventListener('input', syncAndHide);
                input.removeEventListener('change', onDone);
            });
            input.click();
        }

        // Close dropdowns on outside click
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.demo-input-label')) {
                document.querySelectorAll('.demo-color-dropdown').forEach(d => d.classList.remove('open'));
            }
        });

        // Init palette (syncs on first switchDistrict call)
        syncPalette(districts.reynoldsburg.colors);

        // Luminance & contrast helpers
        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            if (hex.length === 3) hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
            if (hex.length > 6) hex = hex.substring(0, 6);
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            return { r, g, b };
        }

        function relativeLuminance(hex) {
            const { r, g, b } = hexToRgb(hex);
            const [rs, gs, bs] = [r/255, g/255, b/255].map(c =>
                c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)
            );
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        }

        function isLightColor(hex) {
            return relativeLuminance(hex) > 0.35;
        }

        function contrastText(bgHex) {
            return isLightColor(bgHex) ? '#1a1a1a' : '#ffffff';
        }

        function contrastTextMuted(bgHex) {
            return isLightColor(bgHex) ? 'rgba(0,0,0,0.65)' : 'rgba(255,255,255,0.8)';
        }

        function darkenHex(hex, amount) {
            const { r, g, b } = hexToRgb(hex);
            const f = 1 - amount;
            const nr = Math.round(r * f);
            const ng = Math.round(g * f);
            const nb = Math.round(b * f);
            return '#' + [nr, ng, nb].map(c => c.toString(16).padStart(2, '0')).join('');
        }

        function lightenHex(hex, amount) {
            const { r, g, b } = hexToRgb(hex);
            const nr = Math.min(255, Math.round(r + (255 - r) * amount));
            const ng = Math.min(255, Math.round(g + (255 - g) * amount));
            const nb = Math.min(255, Math.round(b + (255 - b) * amount));
            return '#' + [nr, ng, nb].map(c => c.toString(16).padStart(2, '0')).join('');
        }

        // Derive a full color system from light + dark inputs
        function deriveColors(lightColor, darkColor) {
            const heroBg = darkColor;
            const heroText = contrastText(heroBg);
            const aboutBg = darkenHex(darkColor, 0.25);
            const aboutText = contrastText(aboutBg);
            const onPrimary = contrastText(darkColor);
            const brandLight = lightenHex(lightColor, 0.85);
            const brandLightAlt = lightenHex(darkColor, 0.85);
            return {
                light: lightColor,
                dark: darkColor,
                primary: darkColor,
                secondary: lightColor,
                heroBg: heroBg,
                heroBgDark: darkenHex(darkColor, 0.3),
                hover: darkenHex(darkColor, 0.15),
                brandDark: darkenHex(darkColor, 0.25),
                brandLight: brandLight,
                brandLightAlt: brandLightAlt,
                chipBg: brandLight,
                hoverShadow: darkColor + '33',
                stripe: darkColor + '0a',
                primaryDark: lightenHex(darkColor, 0.3),
                secondaryDark: lightenHex(lightColor, 0.2),
                lightDark: darkColor + '1a',
                hoverDark: lightenHex(darkColor, 0.2),
                darkDark: darkColor,
                // Contrast-aware text
                heroText: heroText,
                heroTextMuted: heroText === '#ffffff' ? 'rgba(255,255,255,0.7)' : 'rgba(0,0,0,0.6)',
                aboutBg: aboutBg,
                aboutText: aboutText,
                aboutTextMuted: contrastTextMuted(aboutBg),
                aboutBorder: aboutText === '#ffffff' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.12)',
                aboutMapBg: aboutText === '#ffffff' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.06)',
                btnPrimaryText: onPrimary,
                logoText: onPrimary
            };
        }

        function swapDistrictColors() {
            const c1 = document.getElementById('customColor1');
            const c2 = document.getElementById('customColor2');
            const tmp = c1.value;
            c1.value = c2.value;
            c2.value = tmp;
            updateDistrictColors();
        }

        function updateDistrictColors() {
            const key = document.getElementById('districtSwitcher').value;
            const d = districts[key];
            if (!d) return;
            const lightColor = document.getElementById('customColor1').value;
            const darkColor = document.getElementById('customColor2').value;
            const ctaColor = document.getElementById('customColorCta').value;
            const headerColor = document.getElementById('customColorHeader').value;
            // Reset aboutBg so deriveColors fully recomputes
            const derived = deriveColors(lightColor, darkColor);
            derived.cta = ctaColor;
            derived.ctaDark = lightenHex(ctaColor, 0.25);
            derived.heroBg = headerColor;
            derived.heroBgDark = darkenHex(headerColor, 0.3);
            derived.heroText = contrastText(headerColor);
            derived.heroTextMuted = derived.heroText === '#ffffff' ? 'rgba(255,255,255,0.7)' : 'rgba(0,0,0,0.6)';
            Object.assign(d.colors, derived);
            // Clear cached aboutBg so switchDistrict re-derives properly
            d.colors.aboutBg = derived.aboutBg;
            switchDistrict(key);
        }

        // Apply contrast-aware colors to the page
        function applyContrastColors(c) {
            const root = document.documentElement;
            // Primary surface text (buttons, logo, icons, time slots, calendar selected)
            const onPrimary = c.btnPrimaryText || contrastText(c.primary);
            const onPrimaryMuted = c.heroText === '#1a1a1a' ? 'rgba(0,0,0,0.6)' : 'rgba(255,255,255,0.7)';
            root.style.setProperty('--brand-on-primary', onPrimary);
            root.style.setProperty('--brand-on-primary-muted', onPrimaryMuted);

            // Hero text
            const heroText = c.heroText || contrastText(c.heroBg || c.primary);
            const heroTextMuted = heroText === '#1a1a1a' ? 'rgba(0,0,0,0.6)' : 'rgba(255,255,255,0.7)';
            root.style.setProperty('--hero-text', heroText);
            root.style.setProperty('--hero-text-muted', heroTextMuted);

            // Hero pattern - use dark dots on light hero, white dots on dark hero
            const patternFill = heroText === '#1a1a1a' ? '%23000000' : '%23ffffff';
            const patternOpacity = heroText === '#1a1a1a' ? '0.06' : '0.03';
            root.style.setProperty('--hero-pattern', `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='${patternFill}' fill-opacity='${patternOpacity}'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`);

            // About section
            root.style.setProperty('--about-bg', c.aboutBg || darkenHex(c.primary, 0.15));
            const aboutBg = c.aboutBg || darkenHex(c.primary, 0.15);
            const aboutText = c.aboutText || contrastText(aboutBg);
            root.style.setProperty('--about-text', aboutText);
            root.style.setProperty('--about-text-muted', c.aboutTextMuted || contrastTextMuted(aboutBg));
            root.style.setProperty('--about-border', aboutText === '#ffffff' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.12)');
            root.style.setProperty('--about-map-bg', aboutText === '#ffffff' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.06)');
            root.style.setProperty('--about-glance-bg', aboutText === '#ffffff' ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.05)');

            // Share card - uses secondary (light) brand color
            const secondaryColor = c.light || c.secondary || c.primary;
            root.style.setProperty('--brand-secondary', secondaryColor);
            root.style.setProperty('--share-text', contrastText(secondaryColor));
        }

        function updateWeatherBadges() {
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d || !d.weather) return;
            const selectedDate = document.getElementById('searchDate') ? document.getElementById('searchDate').value : '';

            document.querySelectorAll('.facility-card').forEach((card, i) => {
                const f = d.facilities[i];
                if (!f) return;
                const oldBadge = card.querySelector('.weather-badge');
                if (!oldBadge) return;

                if (!f.outdoor) {
                    oldBadge.innerHTML = '<span class="weather-badge-desc">Indoors</span>';
                } else {
                    let wx = null;
                    if (selectedDate && d.weather.forecast[selectedDate]) {
                        wx = d.weather.forecast[selectedDate];
                    } else if (!selectedDate) {
                        wx = d.weather.today;
                    }
                    if (wx) {
                        oldBadge.innerHTML = `<span class="weather-badge-icon">${wx.icon}</span><span class="weather-badge-temp">${wx.temp}F</span><span class="weather-badge-divider"></span><span class="weather-badge-desc">${wx.condition}</span>`;
                        oldBadge.style.display = '';
                    } else {
                        oldBadge.style.display = 'none';
                    }
                }
            });
        }

        function switchDistrict(key) {
            const d = districts[key];
            if (!d) return;

            // Sync palette pickers to this district's colors
            syncPalette(d.colors);

            // Update page title
            document.title = d.name + ' Facilities | PracticePlan';

            // Update header
            document.querySelector('.district-info h1').textContent = d.name;
            document.querySelector('.district-location').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>' + d.location;

            // Update header logo
            const headerLogo = document.getElementById('districtLogo');
            if (headerLogo) {
                if (d.logo) {
                    headerLogo.innerHTML = `<img src="${d.logo}" alt="${d.name}" style="transform:scale(${d.logoScale || 1})">`;
                } else {
                    headerLogo.innerHTML = '<svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg>';
                }
            }

            // Update CSS variables
            const root = document.documentElement;
            const c = d.colors;

            // Auto-derive contrast colors if not already set
            if (!c.aboutBg) {
                const darkColor = c.dark || c.primary;
                c.aboutBg = darkenHex(darkColor, 0.15);
                c.aboutText = contrastText(c.aboutBg);
                c.aboutTextMuted = contrastTextMuted(c.aboutBg);
                c.aboutBorder = c.aboutText === '#ffffff' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.12)';
                c.aboutMapBg = c.aboutText === '#ffffff' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.06)';
                c.heroText = contrastText(c.heroBg || c.primary);
                c.heroTextMuted = c.heroText === '#ffffff' ? 'rgba(255,255,255,0.7)' : 'rgba(0,0,0,0.6)';
                c.btnPrimaryText = contrastText(c.primary);
                c.logoText = contrastText(c.primary);
            }

            root.style.setProperty('--brand-primary', c.primary);
            root.style.setProperty('--brand-secondary', c.secondary);
            root.style.setProperty('--brand-cta', c.cta || c.primary);
            root.style.setProperty('--brand-on-cta', contrastText(c.cta || c.primary));
            root.style.setProperty('--brand-light', c.brandLight || c.light);
            root.style.setProperty('--brand-hover', c.hover);
            root.style.setProperty('--brand-dark', c.brandDark || c.dark);
            root.style.setProperty('--chip-bg', c.chipBg);
            root.style.setProperty('--chip-text', c.primary);
            root.style.setProperty('--hero-bg', c.heroBg);

            // Apply contrast-aware colors
            applyContrastColors(c);

            // Update hardcoded color references
            const mainEl = document.querySelector('.main');
            if (mainEl) {
                mainEl.style.setProperty('--stripe-color', c.stripe);
            }

            // Card hover shadow and dynamic overrides
            const style = document.getElementById('dynamicStyles') || document.createElement('style');
            style.id = 'dynamicStyles';
            const gradLight = c.brandLight || c.light;
            const gradAlt = c.brandLightAlt || lightenHex(c.primary, 0.85);
            const gradLightDk = c.lightDark || c.light;
            const gradAltDk = c.primary + '1a';
            style.textContent = `
                .facility-card:hover { box-shadow: 0 12px 32px ${c.hoverShadow}; }
                .hero::after { background: linear-gradient(90deg, ${c.primary} 0%, ${c.secondary} 50%, ${c.primary} 100%) !important; }
                .main::before { background: linear-gradient(135deg, ${gradLight} 0%, var(--bg) 25%, var(--bg) 55%, ${gradAlt} 80%, var(--bg) 100%) !important; }
                .btn-white { color: ${c.primary}; }
                [data-theme="dark"] { --brand-primary: ${c.primaryDark}; --brand-secondary: ${c.secondaryDark}; --brand-cta: ${c.ctaDark || c.primaryDark}; --brand-on-cta: ${contrastText(c.ctaDark || c.primaryDark)}; --brand-light: ${gradLightDk}; --brand-hover: ${c.hoverDark}; --brand-dark: ${c.darkDark}; --hero-bg: ${c.heroBgDark}; --chip-bg: ${c.lightDark || c.light}; --chip-text: ${c.primaryDark}; --brand-on-primary: ${contrastText(c.primaryDark)}; --share-text: ${contrastText(c.secondaryDark)}; }
                [data-theme="dark"] .facility-card:hover { box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4); }
                [data-theme="dark"] .main::before { background: linear-gradient(135deg, ${gradLightDk} 0%, var(--bg) 25%, var(--bg) 55%, ${gradAltDk} 80%, var(--bg) 100%) !important; }
            `;
            if (!document.getElementById('dynamicStyles')) document.head.appendChild(style);

            // Update hero location
            const heroLocationText = document.getElementById('heroLocationText');
            if (heroLocationText) heroLocationText.textContent = d.location;

            // Update school filter
            const schoolSelect = document.getElementById('searchSchool');
            if (schoolSelect) {
                schoolSelect.innerHTML = '<option value="">All locations</option>';
                d.schools.forEach(s => {
                    schoolSelect.innerHTML += '<option value="' + s.value + '">' + s.label + '</option>';
                });
            }

            // Update facility cards
            const grid = document.getElementById('facilityGrid');
            if (grid) {
                grid.innerHTML = '';
                const selectedDate = document.getElementById('searchDate') ? document.getElementById('searchDate').value : '';
                d.facilities.forEach((f, i) => {

                    // Use unified slot data for consistent availability
                    const effectiveDate = selectedDate || (() => { const t = new Date(); return t.getFullYear() + '-' + String(t.getMonth()+1).padStart(2,'0') + '-' + String(t.getDate()).padStart(2,'0'); })();
                    const slotData = getSlotData(f.name, effectiveDate);
                    const slotHTML = slotData.availableSlots.map(t =>
                        '<button class="time-slot">' + t + '</button>'
                    ).join('');

                    // Use availability from same data
                    const cardAvail = selectedDate ? slotData.availability : f.availability;

                    // Weather logic: date-aware for outdoor, "Indoors" for indoor
                    let weatherHTML = '';
                    if (!f.outdoor) {
                        weatherHTML = '<div class="weather-badge"><span class="weather-badge-desc">Indoors</span></div>';
                    } else if (d.weather) {
                        let wx = null;
                        if (selectedDate && d.weather.forecast[selectedDate]) {
                            wx = d.weather.forecast[selectedDate];
                        } else if (!selectedDate) {
                            wx = d.weather.today;
                        }
                        // If date is beyond forecast range, don't show weather
                        if (wx) {
                            weatherHTML = `<div class="weather-badge">
                                <span class="weather-badge-icon">${wx.icon}</span>
                                <span class="weather-badge-temp">${wx.temp}F</span>
                                <span class="weather-badge-divider"></span>
                                <span class="weather-badge-desc">${wx.condition}</span>
                            </div>`;
                        }
                    }

                    // Stats: single lastBooked line
                    const clockSvg = '<svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>';
                    const sparkleSvg = '<svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.4 7.4H22l-6 4.6 2.3 7-6.3-4.6L5.7 21 8 14l-6-4.6h7.6z"/></svg>';
                    const statIcon = f.lastBooked.includes('Last booked') ? clockSvg : sparkleSvg;
                    const statHTML = '<div class="stat-item">' + statIcon + ' ' + f.lastBooked + '</div>';

                    grid.innerHTML += `
                        <div class="facility-card">
                            <div class="facility-image">
                                ${f.image ? `<img src="${f.image}" alt="${f.name}" loading="lazy">` : '<div class="image-placeholder"></div>'}
                                ${weatherHTML}
                                <button class="favorite-btn" onclick="this.classList.toggle('active')">
                                    <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                </button>
                                <span class="availability-indicator ${cardAvail}" title="${cardAvail} availability">
                                    <span class="availability-dot"></span>
                                </span>
                            </div>
                            <div class="facility-body">
                                <div class="facility-type-icon">${d.logo ? `<img src="${d.logo}" alt="${d.name}" style="transform:scale(${d.logoScale || 1})">` : `<svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 12.27L4 10.5V16l8 4.5 8-4.5v-5.5l-8 4.77z"/></svg>`}</div>
                                <h3 class="facility-name">${f.name}</h3>
                                <div class="facility-location">${f.location}</div>
                                <div class="facility-price-line">${f.price}</div>
                                <div class="card-divider"></div>
                                <div class="facility-meta-line">
                                    <span>${f.type}</span>
                                    <span class="meta-dot"></span>
                                    <span>${f.capacity}</span>
                                </div>
                                <div class="facility-stats">${statHTML}</div>
                                <div class="time-slots" data-has-search="false">
                                    <button class="btn-check-availability">View Details</button>
                                </div>
                                <div class="time-slots-searched" data-has-search="true" style="display: none;">
                                    ${slotHTML}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // Update district info section
            if (d.info) {
                const aboutTitle = document.getElementById('districtAboutTitle');
                const aboutText = document.getElementById('districtAboutText');
                const ttkContent = document.getElementById('thingsToKnowContent');
                const districtAddress = document.getElementById('districtAddress');
                const mapLink = document.getElementById('districtMapLink');
                const mapFrame = document.getElementById('districtMapFrame');

                if (aboutTitle) aboutTitle.textContent = 'About ' + d.name;
                if (aboutText) aboutText.textContent = d.info.about;
                if (districtAddress) districtAddress.textContent = d.info.address;
                if (mapLink) mapLink.href = 'https://www.google.com/maps/dir/?api=1&destination=' + encodeURIComponent(d.info.address);

                // Update district website
                const websiteAbout = document.getElementById('districtWebsiteAbout');
                const websiteLabelAbout = document.getElementById('districtWebsiteLabelAbout');
                if (d.info.website && websiteAbout) {
                    websiteAbout.href = d.info.website.url;
                    websiteAbout.style.display = 'inline-flex';
                    if (websiteLabelAbout) websiteLabelAbout.textContent = d.info.website.label;
                } else if (websiteAbout) {
                    websiteAbout.style.display = 'none';
                }

                // Update share subtext
                var shareSubtext = document.getElementById('shareSubtext');
                if (shareSubtext) shareSubtext.textContent = 'Share this page with your team, community, or network';

                // Update share buttons
                var shareUrl = encodeURIComponent('https://practiceplan.facilityrevenue.com/' + key);
                var shareTitle = encodeURIComponent('Book facilities at ' + d.name + ' on PracticePlan');
                var shareDesc = encodeURIComponent('Browse and book ' + (d.stats ? d.stats.facilities : '') + ' facilities at ' + d.name + ' starting at ' + (d.stats ? d.stats.startingPrice : '') + '/hr.');
                var fb = document.getElementById('shareFacebook');
                var tw = document.getElementById('shareTwitter');
                var em = document.getElementById('shareEmail');
                if (fb) fb.href = 'https://www.facebook.com/sharer/sharer.php?u=' + shareUrl;
                if (tw) tw.href = 'https://x.com/intent/tweet?url=' + shareUrl + '&text=' + shareTitle;
                if (em) em.href = 'mailto:?subject=' + shareTitle + '&body=' + shareDesc + '%0A%0A' + shareUrl;
                if (mapFrame) mapFrame.src = 'https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d30000!2d' + d.info.mapCoords.lng + '!3d' + d.info.mapCoords.lat + '!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sus!4v1706000000000';

                // Update glance stats
                const glanceLocations = document.getElementById('glanceLocations');
                const glanceFacilities = document.getElementById('glanceFacilities');
                const glanceStarting = document.getElementById('glanceStarting');
                if (glanceLocations) glanceLocations.textContent = d.schools ? d.schools.length : '-';
                if (glanceFacilities) glanceFacilities.textContent = d.stats ? d.stats.facilities : '-';
                if (glanceStarting) glanceStarting.textContent = d.stats ? d.stats.startingPrice + '+' : '-';

                // TTK icon map
                function ttkIcon(title) {
                    const t = title.toLowerCase();
                    if (t.includes('cancel')) return '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l2 2"/></svg>';
                    if (t.includes('parking')) return '<svg viewBox="0 0 24 24"><rect x="1" y="3" width="15" height="13" rx="2"/><path d="M16 8l4 2.5v5L16 13"/></svg>';
                    if (t.includes('insurance')) return '<svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>';
                    if (t.includes('weather') || t.includes('winter')) return '<svg viewBox="0 0 24 24"><path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"/><path d="M8 16h.01M8 20h.01M12 18h.01M12 22h.01M16 16h.01M16 20h.01"/></svg>';
                    if (t.includes('hour')) return '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>';
                    if (t.includes('fee') || t.includes('payment') || t.includes('price')) return '<svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>';
                    return '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>';
                }

                if (ttkContent) {
                    ttkContent.innerHTML = d.info.thingsToKnow.map(item =>
                        '<div class="ttk-item"><div class="ttk-icon">' + ttkIcon(item.title) + '</div><div class="ttk-content"><h4>' + item.title + '</h4><p>' + item.text + '</p></div></div>'
                    ).join('');
                }
            }

            // Refresh calendar and facility list if calendar view is active
            if (document.getElementById('calendarView').classList.contains('active')) {
                renderCalendar();
                renderFacilityList();
            }
        }

        // =============================================
        // BOOKING MODAL
        // =============================================
        let currentModalFacility = null;
        let currentModalDistrict = null;
        let selectedModalSlot = null;
        let selectedAmenities = new Set();

        function openBookingModal(facilityName, preselectedSlot) {
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d) return;

            const f = d.facilities.find(fac => fac.name === facilityName);
            if (!f) return;

            currentModalFacility = f;
            currentModalDistrict = d;
            selectedModalSlot = preselectedSlot || null;

            // Populate header
            document.getElementById('modalFacilityName').textContent = f.name;
            document.getElementById('modalFacilityLocation').textContent = f.location;

            // District logo in modal header
            const modalLogo = document.getElementById('modalHeaderLogo');
            if (d.logo) {
                modalLogo.innerHTML = `<img src="${d.logo}" alt="${d.name}" style="transform:scale(${d.logoScale || 1})">`;
            } else {
                modalLogo.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:24px;height:24px"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>`;
            }

            // Image
            const img = document.getElementById('modalFacilityImg');
            if (f.image) { img.src = f.image; img.alt = f.name; img.style.display = ''; }
            else { img.style.display = 'none'; }

            // Weather badge
            const wb = document.getElementById('modalWeatherBadge');
            if (f.outdoor && d.weather) {
                const activeDate = document.getElementById('modalDate').value || document.getElementById('searchDate').value || '';
                const wData = activeDate && d.weather.forecast && d.weather.forecast[activeDate] ? d.weather.forecast[activeDate] : d.weather.today;
                if (wData) {
                    wb.innerHTML = `${wData.icon} ${wData.temp}F - ${wData.condition}`;
                    wb.style.display = 'flex';
                } else { wb.style.display = 'none'; }
            } else {
                wb.innerHTML = 'Indoors';
                wb.style.display = 'flex';
            }

            // Info grid
            const capNum = f.capacity.replace(/[^0-9,]/g, '') || f.capacity;
            const sizeEst = f.type.includes('Stadium') || f.type.includes('Field') ? '~80,000 sq ft' : f.type.includes('Gymnasium') ? '~12,000 sq ft' : f.type.includes('Auditorium') ? '~8,000 sq ft' : '~5,000 sq ft';
            document.getElementById('modalInfoGrid').innerHTML = `
                <div class="modal-info-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <div><div class="info-label">Capacity</div><div class="info-value">${f.capacity}</div></div>
                </div>
                <div class="modal-info-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
                    <div><div class="info-label">Est. Size</div><div class="info-value">${sizeEst}</div></div>
                </div>
                <div class="modal-info-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4"/><path d="M8 3v4"/></svg>
                    <div><div class="info-label">Type</div><div class="info-value">${f.type}</div></div>
                </div>
                <div class="modal-info-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s-8-4.5-8-11.8a8 8 0 0 1 16 0c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
                    <div><div class="info-label">Setting</div><div class="info-value">${f.outdoor ? 'Outdoor' : 'Indoor'}</div></div>
                </div>
            `;

            // Features
            const featureList = [];
            if (!f.outdoor) featureList.push('Climate Control');
            featureList.push('Parking', 'Restrooms', 'ADA Accessible');
            if (f.type.includes('Gymnasium')) featureList.push('Bleachers', 'Scoreboard');
            if (f.type.includes('Stadium') || f.type.includes('Field')) featureList.push('Field Lighting', 'Press Box');
            if (f.type.includes('Auditorium')) featureList.push('Stage', 'Sound System', 'Lighting Rig');
            if (f.type.includes('Cafeteria')) featureList.push('Kitchen Access', 'Tables & Chairs');
            document.getElementById('modalFeatures').innerHTML = featureList.map(feat =>
                `<span class="modal-feature-tag"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>${feat}</span>`
            ).join('');

            // Amenities
            selectedAmenities = new Set();
            const amenityData = [];
            if (f.type.includes('Stadium') || f.type.includes('Field')) {
                amenityData.push({ name: 'Scoreboard', price: 100 }, { name: 'Field Lighting', price: 150 }, { name: 'PA System', price: 75 }, { name: 'Security', price: 250 });
            } else if (f.type.includes('Auditorium')) {
                amenityData.push({ name: 'Advanced Lighting', price: 250 }, { name: 'Curtains/Drapery', price: 200 }, { name: 'Sound System', price: 40 }, { name: 'Projector', price: 50 });
            } else if (f.type.includes('Gymnasium')) {
                amenityData.push({ name: 'Scoreboard', price: 100 }, { name: 'Bleacher Setup', price: 75 }, { name: 'A/V Equipment', price: 50 }, { name: 'Locker Rooms', price: 40 });
            } else {
                amenityData.push({ name: 'A/V Equipment', price: 50 }, { name: 'Extra Tables', price: 30 }, { name: 'Cleanup Crew', price: 75 });
            }
            // Store on window so toggle can access
            window._modalAmenityData = amenityData;
            document.getElementById('modalAmenities').innerHTML = amenityData.map((a, i) =>
                `<div class="modal-amenity-item" data-amenity-idx="${i}" data-amenity-price="${a.price}" onclick="toggleAmenity(this)">
                    <span class="modal-amenity-check"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
                    <span class="modal-amenity-info"><span class="modal-amenity-name">${a.name}</span></span>
                    <span class="modal-amenity-price">$${a.price.toFixed(2)}</span>
                </div>`
            ).join('');
            document.getElementById('modalAmenityTotal').style.display = 'none';

            // Policies
            const policies = d.info && d.info.thingsToKnow ? d.info.thingsToKnow : [];
            document.getElementById('modalPolicies').innerHTML = policies.map(p =>
                `<div class="modal-policy"><div class="modal-policy-title">${p.title}</div><div class="modal-policy-text">${p.text}</div></div>`
            ).join('');

            // Price
            document.getElementById('modalPrice').textContent = f.price.replace('/hr', '');

            // Availability
            const availMap = { high: 'High availability', medium: 'Limited availability', low: 'Almost full' };
            const avail = f.availability || 'medium';
            document.getElementById('modalAvailability').innerHTML = `<span class="avail-dot ${avail}"></span><span>${availMap[avail] || 'Available'}</span>`;

            // Pre-fill date from search (but never a past date)
            const searchDateVal = document.getElementById('searchDate').value;
            const now = new Date();
            const todayStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
            mdpViewDate = new Date();

            if (searchDateVal && searchDateVal >= todayStr) {
                setModalDate(searchDateVal);
                mdpViewDate = new Date(searchDateVal + 'T12:00:00');
            } else {
                // Default to tomorrow to ensure full slot availability
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const yyyy = tomorrow.getFullYear();
                const mm = String(tomorrow.getMonth() + 1).padStart(2, '0');
                const dd = String(tomorrow.getDate()).padStart(2, '0');
                setModalDate(`${yyyy}-${mm}-${dd}`);
                mdpViewDate = new Date(tomorrow);
            }

            // Pre-fill duration from search
            const durSlider = document.getElementById('searchDuration');
            if (durSlider) document.getElementById('modalDuration').value = durSlider.value;

            // Pre-fill group size from search
            const gsSlider = document.getElementById('searchGuests');
            if (gsSlider) {
                const gsMap = { '0': '', '1': '1-10', '2': '11-50', '3': '51-100', '4': '101-200', '5': '201-500', '6': '500+' };
                document.getElementById('modalGroupSize').value = gsMap[gsSlider.value] || '';
            }

            // Pre-fill activity from search
            const activitySelect = document.getElementById('activityType');
            const modalActivity = document.getElementById('modalActivity');
            // Populate modal activity dropdown with same options
            const actOptions = activitySelect ? activitySelect.innerHTML : '';
            modalActivity.innerHTML = actOptions;
            if (activitySelect && activitySelect.value) {
                modalActivity.value = activitySelect.value;
            }

            // Auto-infer booking type from activity if available
            const actVal = modalActivity.value;
            const bookingTypeSelect = document.getElementById('modalBookingType');
            if (actVal && !bookingTypeSelect.value) {
                const sportsActivities = ['badminton','baseball','basketball','cheer','cross-country','field-hockey','fitness','football','golf','gymnastics','lacrosse','martial-arts','pickleball','soccer','swimming','tennis','track','volleyball','weightlifting','wrestling','yoga'];
                const eventActivities = ['awards','concert','dance','fair','fundraiser','graduation','movie','party','pep-rally','theater'];
                const meetingActivities = ['class','meeting','orientation','professional-dev','testing','training','tutoring'];
                if (sportsActivities.includes(actVal)) bookingTypeSelect.value = 'practice';
                else if (eventActivities.includes(actVal)) bookingTypeSelect.value = 'performance';
                else if (actVal === 'camp') bookingTypeSelect.value = 'camp';
                else if (meetingActivities.includes(actVal)) bookingTypeSelect.value = 'meeting';
                else bookingTypeSelect.value = 'other';
            }

            // Render time slots for date
            renderModalSlots();

            // Reset scroll positions to top
            document.querySelector('.modal-left').scrollTop = 0;
            document.querySelector('.modal-right').scrollTop = 0;
            document.querySelector('.modal-body').scrollTop = 0;

            // Set initial validation state
            validateModalForm();

            // Expand facility details by default
            const dtToggle = document.getElementById('modalDetailsToggle');
            const dtContent = document.getElementById('modalDetailsContent');
            if (dtToggle) dtToggle.classList.add('expanded');
            if (dtContent) dtContent.classList.add('expanded');

            // Restore insurance if previously uploaded
            restoreInsuranceState();

            // Show modal
            document.getElementById('bookingModalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeBookingModal() {
            document.getElementById('bookingModalOverlay').classList.remove('active');
            // Only restore body scroll if cart drawer isn't also open
            if (!document.getElementById('cartDrawerOverlay').classList.contains('open')) {
                document.body.style.overflow = '';
            }
            currentModalFacility = null;
            currentModalDistrict = null;
            selectedModalSlot = null;
            // Clear success overlay
            const so = document.getElementById('modalSuccessOverlay');
            if (so) so.classList.remove('active');
            // Keep details expanded for next open
            const toggle = document.getElementById('modalDetailsToggle');
            const content = document.getElementById('modalDetailsContent');
            if (toggle) toggle.classList.add('expanded');
            if (content) content.classList.add('expanded');
        }

        function toggleModalDetails() {
            const toggle = document.getElementById('modalDetailsToggle');
            const content = document.getElementById('modalDetailsContent');
            const isExpanded = content.classList.contains('expanded');
            toggle.classList.toggle('expanded', !isExpanded);
            content.classList.toggle('expanded', !isExpanded);
        }

        function renderModalSlots() {
            const container = document.getElementById('modalSlots');
            const dateVal = document.getElementById('modalDate').value;

            if (!dateVal || !currentModalFacility) {
                container.innerHTML = '<span style="font-size:13px;color:var(--text-secondary)">Select a date to view availability</span>';
                return;
            }

            const f = currentModalFacility;
            const d = currentModalDistrict;

            // Update weather badge for selected date
            const wb = document.getElementById('modalWeatherBadge');
            if (f.outdoor && d.weather) {
                const wData = d.weather.forecast && d.weather.forecast[dateVal] ? d.weather.forecast[dateVal] : d.weather.today;
                if (wData) {
                    wb.innerHTML = `${wData.icon} ${wData.temp}F - ${wData.condition}`;
                    wb.style.display = 'flex';
                }
            }

            // Use unified slot data (same source as cards and list)
            const slotData = getSlotData(f.name, dateVal);

            container.innerHTML = slotData.allSlots.map(slot => {
                const isDisabled = slot.booked || slot.past || slot.reserved;
                const isSelected = selectedModalSlot === slot.time && !isDisabled;
                let cls = 'modal-slot-btn';
                if (slot.reserved) cls += ' reserved';
                else if (slot.booked) cls += ' booked';
                if (slot.past && !slot.booked && !slot.reserved) cls += ' past-slot';
                if (isSelected) cls += ' selected';
                // Abbreviate: "4:00 PM" -> "4 PM", "12:00 PM" -> "12 PM"
                const shortTime = slot.time.replace(':00 ', ' ');
                return `<button class="${cls}" ${isDisabled ? 'disabled' : ''} onclick="selectModalSlot(this,'${slot.time}')">${shortTime}</button>`;
            }).join('');

            // Balance grid: pick column count that avoids orphan (1 item on last row)
            balanceSlotGrid(container, slotData.allSlots.length);

            // If selected slot is now past or booked, clear it
            if (selectedModalSlot) {
                const selectedBtn = container.querySelector('.modal-slot-btn.selected');
                if (!selectedBtn || selectedBtn.disabled) {
                    selectedModalSlot = null;
                }
            }

            // Check if ALL slots are unavailable
            const availableSlots = container.querySelectorAll('.modal-slot-btn:not([disabled])');
            if (availableSlots.length === 0) {
                container.innerHTML += '<div style="width:100%;text-align:center;padding:8px 0;font-size:13px;color:var(--text-secondary)">No available time slots for this date. Please select a different date.</div>';
            }

            // Show advance booking notice
            const notice = document.getElementById('modalNotice');
            const today = new Date();
            const selDate = new Date(dateVal + 'T12:00:00');
            const diffDays = Math.ceil((selDate - today) / (1000 * 60 * 60 * 24));
            if (diffDays < 2) {
                document.getElementById('modalNoticeText').textContent = 'This facility requires at least 2 days advance booking. Please select a later date.';
                notice.style.display = 'flex';
            } else {
                notice.style.display = 'none';
            }

            validateModalForm();
        }

        function balanceSlotGrid(container, count) {
            // Pick a column count (3-6) so rows are evenly filled (no single orphan)
            if (count <= 5) {
                // 5 or fewer: single row
                container.style.gridTemplateColumns = `repeat(${count}, 1fr)`;
                return;
            }
            // Try column counts from 6 down to 3, prefer the one with no orphan
            const candidates = [6, 5, 4, 3];
            let bestCols = 6;
            for (const cols of candidates) {
                const remainder = count % cols;
                if (remainder === 0 || remainder >= 2) {
                    bestCols = cols;
                    break;
                }
            }
            container.style.gridTemplateColumns = `repeat(${bestCols}, 1fr)`;
        }

        function selectModalSlot(btn, slot) {
            if (btn.classList.contains('booked') || btn.classList.contains('reserved')) return;
            document.querySelectorAll('#modalSlots .modal-slot-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedModalSlot = slot;
            validateModalForm();
        }

        // Refresh card slot buttons to remove/restore slots based on cartItems
        function refreshCardSlots() {
            const currentKey = document.getElementById('districtSwitcher').value;
            const d = districts[currentKey];
            if (!d) return;
            const selectedDate = document.getElementById('searchDate') ? document.getElementById('searchDate').value : '';
            if (!selectedDate) return; // Cards only show slots when a date is searched

            const effectiveDate = selectedDate;
            const cards = document.querySelectorAll('#facilityGrid .facility-card');
            cards.forEach(card => {
                const nameEl = card.querySelector('.facility-name');
                if (!nameEl) return;
                const facilityName = nameEl.textContent;
                const slotData = getSlotData(facilityName, effectiveDate);
                const slotsContainer = card.querySelector('.time-slots-searched');
                if (!slotsContainer) return;
                slotsContainer.innerHTML = slotData.availableSlots.map(t =>
                    '<button class="time-slot">' + t + '</button>'
                ).join('');
                if (slotData.availableSlots.length === 0) {
                    slotsContainer.innerHTML = '<span style="font-size:12px;color:var(--text-secondary)">No slots available</span>';
                }

                // Update availability indicator
                const availDot = card.querySelector('.availability-indicator');
                if (availDot) {
                    availDot.className = 'availability-indicator ' + slotData.availability;
                    availDot.title = slotData.availability + ' availability';
                }
            });
        }

        function validateModalForm() {
            const hasDate = !!document.getElementById('modalDate').value;
            const hasSlot = !!selectedModalSlot;
            const hasDuration = !!document.getElementById('modalDuration').value;
            const hasGroupSize = !!document.getElementById('modalGroupSize').value;
            const hasBookingType = !!document.getElementById('modalBookingType').value;
            const hasActivity = !!document.getElementById('modalActivity').value;

            const fields = [
                { label: 'Date', done: hasDate },
                { label: 'Time slot', done: hasSlot },
                { label: 'Group size', done: hasGroupSize },
                { label: 'Booking type', done: hasBookingType },
                { label: 'Activity', done: hasActivity }
            ];

            const total = fields.length;
            const doneCount = fields.filter(f => f.done).length;
            const isValid = doneCount === total;
            const pct = Math.round((doneCount / total) * 100);

            // Find first incomplete for label
            const firstIncomplete = fields.find(f => !f.done);
            const labelText = isValid
                ? 'Ready to submit'
                : doneCount + ' of ' + total + ' - ' + (firstIncomplete ? 'Select ' + firstIncomplete.label.toLowerCase() : '');

            // Update desktop bar
            const hintD = document.getElementById('modalValidationHint');
            const labelD = document.getElementById('modalValidationLabel');
            const fillD = document.getElementById('modalValidationFill');
            if (hintD) {
                labelD.textContent = labelText;
                fillD.style.width = pct + '%';
                hintD.classList.toggle('all-done', isValid);
            }

            // Update mobile bar
            const hintM = document.getElementById('modalValidationHintMobile');
            const labelM = document.getElementById('modalValidationLabelMobile');
            const fillM = document.getElementById('modalValidationFillMobile');
            if (hintM) {
                labelM.textContent = labelText;
                fillM.style.width = pct + '%';
                hintM.classList.toggle('all-done', isValid);
            }

            // Enable/disable all CTA buttons (desktop + mobile)
            const btns = [
                document.getElementById('modalAddContinueBtn'),
                document.getElementById('modalBookBtn'),
                document.getElementById('modalAddContinueBtnMobile'),
                document.getElementById('modalBookBtnMobile')
            ];
            btns.forEach(b => { if (b) b.disabled = !isValid; });

            // Highlight incomplete selects with subtle ring
            ['modalGroupSize', 'modalBookingType', 'modalActivity'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const wrapper = el.closest('.modal-form-group');
                if (!wrapper) return;
                if (!el.value) {
                    wrapper.classList.add('field-incomplete');
                } else {
                    wrapper.classList.remove('field-incomplete');
                }
            });

            // Highlight time slot wrapper when date is set but no slot selected
            const slotsWrapper = document.getElementById('modalSlotsWrapper');
            if (slotsWrapper) {
                if (hasDate && !hasSlot) {
                    slotsWrapper.classList.add('field-incomplete');
                    slotsWrapper.classList.remove('slot-selected');
                } else if (hasSlot) {
                    slotsWrapper.classList.remove('field-incomplete');
                    slotsWrapper.classList.add('slot-selected');
                } else {
                    slotsWrapper.classList.remove('field-incomplete');
                    slotsWrapper.classList.remove('slot-selected');
                }
            }
        }

        function toggleAmenity(el) {
            const idx = el.dataset.amenityIdx;
            el.classList.toggle('selected');
            if (el.classList.contains('selected')) {
                selectedAmenities.add(idx);
            } else {
                selectedAmenities.delete(idx);
            }
            updateAmenityTotal();
        }

        function updateAmenityTotal() {
            const totalEl = document.getElementById('modalAmenityTotal');
            const amountEl = document.getElementById('modalAmenityTotalAmount');
            if (selectedAmenities.size === 0) {
                totalEl.style.display = 'none';
                return;
            }
            let total = 0;
            selectedAmenities.forEach(idx => {
                const a = window._modalAmenityData[parseInt(idx)];
                if (a) total += a.price;
            });
            amountEl.textContent = '+$' + total.toFixed(2);
            totalEl.style.display = 'flex';
        }

        // =============================================
        // INSURANCE FILE MANAGEMENT
        // =============================================
        let retainedInsurance = null; // { name, size, data } - persists across bookings

        function handleInsuranceUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert('File must be under 10MB.');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = { name: file.name, size: file.size, data: e.target.result };
                retainedInsurance = fileData;
                showInsuranceFile(fileData, false);
                updateCartInsuranceState();
            };
            reader.readAsDataURL(file);
        }

        function showInsuranceFile(fileData, isRetained) {
            const container = document.getElementById('modalInsurance');
            document.getElementById('insuranceFileName').textContent = fileData.name;
            const sizeKB = (fileData.size / 1024).toFixed(0);
            const sizeMB = (fileData.size / (1024 * 1024)).toFixed(1);
            document.getElementById('insuranceFileSize').textContent = fileData.size > 1024 * 1024 ? sizeMB + ' MB' : sizeKB + ' KB';
            container.classList.add('has-file');
            if (isRetained) {
                container.classList.add('retained');
            } else {
                container.classList.remove('retained');
            }
        }

        function removeInsuranceFile() {
            retainedInsurance = null;
            const container = document.getElementById('modalInsurance');
            container.classList.remove('has-file', 'retained');
            document.getElementById('insuranceFileInput').value = '';
            updateCartInsuranceState();
        }

        function handleCartInsuranceUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('File must be under 10MB.');
                input.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                retainedInsurance = { name: file.name, size: file.size, data: e.target.result };
                updateCartInsuranceState();
                // Also sync the modal insurance section
                showInsuranceFile(retainedInsurance, true);
            };
            reader.readAsDataURL(file);
        }

        function removeCartInsurance() {
            retainedInsurance = null;
            document.getElementById('cartInsuranceFileInput').value = '';
            updateCartInsuranceState();
            // Also sync the modal
            const container = document.getElementById('modalInsurance');
            container.classList.remove('has-file', 'retained');
            document.getElementById('insuranceFileInput').value = '';
        }

        function updateCartInsuranceState() {
            const reminder = document.getElementById('cartInsuranceReminder');
            const uploadRow = document.getElementById('cartInsuranceUploadRow');
            const fileRow = document.getElementById('cartInsuranceFileRow');
            const fileName = document.getElementById('cartInsuranceFileName');
            const checkoutBtn = document.getElementById('cartCheckoutBtn');

            if (retainedInsurance) {
                reminder.classList.add('uploaded');
                uploadRow.style.display = 'none';
                fileRow.style.display = 'flex';
                fileName.textContent = retainedInsurance.name;
                // Update title and desc for uploaded state
                reminder.querySelector('.cart-insurance-reminder-title').textContent = 'Insurance uploaded';
                reminder.querySelector('.cart-insurance-reminder-desc').textContent = 'Your certificate will be submitted with your reservation request.';
                if (checkoutBtn) checkoutBtn.disabled = false;
            } else {
                reminder.classList.remove('uploaded');
                uploadRow.style.display = 'flex';
                fileRow.style.display = 'none';
                fileName.textContent = '';
                reminder.querySelector('.cart-insurance-reminder-title').textContent = 'Insurance required';
                reminder.querySelector('.cart-insurance-reminder-desc').textContent = 'Upload a certificate of liability insurance before submitting your reservation request.';
                if (checkoutBtn) checkoutBtn.disabled = true;
            }
        }

        function restoreInsuranceState() {
            // If user has previously uploaded insurance, auto-apply it
            if (retainedInsurance) {
                showInsuranceFile(retainedInsurance, true);
            } else {
                const container = document.getElementById('modalInsurance');
                container.classList.remove('has-file', 'retained');
            }
        }

        // =============================================
        // CART SYSTEM
        // =============================================
        let cartItems = [];
        let cartIdCounter = 0;

        function submitBooking(action) {
            const dateVal = document.getElementById('modalDate').value;
            if (!dateVal) return;
            if (!selectedModalSlot) return;

            const f = currentModalFacility;
            const d = currentModalDistrict;
            const duration = parseInt(document.getElementById('modalDuration').value) || 2;
            const dateObj = new Date(dateVal + 'T12:00:00');
            const dateLabel = dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

            // Parse price
            const priceMatch = f.price.match(/\$(\d+)/);
            const hourlyRate = priceMatch ? parseInt(priceMatch[1]) : 0;
            const facilityTotal = hourlyRate * duration;

            // Gather amenities
            const amenities = [];
            let amenityTotal = 0;
            selectedAmenities.forEach(idx => {
                const a = window._modalAmenityData[parseInt(idx)];
                if (a) { amenities.push({ name: a.name, price: a.price }); amenityTotal += a.price; }
            });

            // Build cart item
            const item = {
                id: ++cartIdCounter,
                facilityName: f.name,
                location: f.location,
                district: d.name,
                date: dateVal,
                dateLabel,
                time: selectedModalSlot,
                duration,
                hourlyRate,
                facilityTotal,
                amenities,
                amenityTotal,
                lineTotal: facilityTotal + amenityTotal,
                groupSize: document.getElementById('modalGroupSize').value,
                bookingType: document.getElementById('modalBookingType').value,
                activity: document.getElementById('modalActivity').value,
                image: f.image || '',
                hasInsurance: !!retainedInsurance,
                insuranceFileName: retainedInsurance ? retainedInsurance.name : ''
            };

            cartItems.push(item);
            updateCartUI();

            // Clear selection and refresh slot displays so reserved slot is removed/disabled
            selectedModalSlot = null;
            renderModalSlots();
            refreshCardSlots();

            // Trigger animation
            if (action === 'continue') {
                showAddedAnimation(item, false);
            } else {
                showAddedAnimation(item, true);
            }
        }

        function showAddedAnimation(item, goToCheckout) {
            const overlay = document.getElementById('modalSuccessOverlay');
            const sub = document.getElementById('successTextSub');
            const countHint = document.getElementById('successCartCount');

            sub.textContent = goToCheckout
                ? `${item.facilityName} - ${item.dateLabel} at ${item.time}`
                : 'Your reservation is pending facility approval.';
            countHint.textContent = cartItems.length === 1
                ? '1 pending reservation'
                : cartItems.length + ' pending reservations';

            // Generate particles (amber tones for pending)
            const particlesEl = document.getElementById('successParticles');
            const colors = ['#f59e0b', '#d97706', '#fbbf24', '#fcd34d', '#f97316', '#fb923c'];
            let particlesHTML = '';
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * 360;
                const dist = 60 + Math.random() * 40;
                const x = Math.cos(angle * Math.PI / 180) * dist;
                const y = Math.sin(angle * Math.PI / 180) * dist;
                const color = colors[i % colors.length];
                const delay = (Math.random() * 0.2).toFixed(2);
                particlesHTML += `<span class="success-particle" style="background:${color};animation-delay:${delay}s;--particle-end:translate(${x}px,${y}px)"></span>`;
            }
            particlesEl.innerHTML = particlesHTML;

            // Show overlay
            overlay.classList.add('active');

            // Animate cart badge
            const badge = document.getElementById('cartBadge');
            badge.classList.remove('pop');
            void badge.offsetWidth;
            badge.classList.add('pop');

            // Auto-dismiss
            const dismissMs = goToCheckout ? 1400 : 1800;
            setTimeout(() => {
                overlay.classList.remove('active');
                particlesEl.innerHTML = '';

                if (goToCheckout) {
                    closeBookingModal();
                    setTimeout(() => toggleCartDrawer(), 250);
                } else {
                    closeBookingModal();
                }
            }, dismissMs);
        }

        function updateCartUI() {
            const count = cartItems.length;
            const badge = document.getElementById('cartBadge');
            const drawerCount = document.getElementById('cartDrawerCount');
            const itemsContainer = document.getElementById('cartDrawerItems');
            const footer = document.getElementById('cartDrawerFooter');

            // Badge
            badge.textContent = count;
            if (count > 0) {
                badge.classList.add('visible');
            } else {
                badge.classList.remove('visible');
            }

            // Drawer count
            drawerCount.textContent = count === 1 ? '1 slot' : count + ' slots';

            // Items
            if (count === 0) {
                itemsContainer.innerHTML = '';
                itemsContainer.appendChild(createEmptyState());
                footer.style.display = 'none';
                return;
            }

            footer.style.display = '';
            updateCartInsuranceState();

            let html = '';
            cartItems.forEach(item => {
                // Parse date parts for the date block
                const dObj = new Date(item.date + 'T12:00:00');
                const dayName = dObj.toLocaleDateString('en-US', { weekday: 'short' });
                const monthName = dObj.toLocaleDateString('en-US', { month: 'short' });
                const dayNum = dObj.getDate();

                // Format booking type / activity / group size labels
                const typeLabel = item.bookingType ? item.bookingType.charAt(0).toUpperCase() + item.bookingType.slice(1) : '';
                const actLabel = item.activity || '';
                const gsLabel = item.groupSize || '';

                // Build amenity line items
                let amenityLines = '';
                item.amenities.forEach(a => {
                    amenityLines += `
                        <div class="cart-cost-row">
                            <span class="cart-cost-label">${a.name}</span>
                            <span class="cart-cost-value">$${a.price.toFixed(2)}</span>
                        </div>`;
                });

                // Unique collapse ID
                const collapseId = 'cartCollapse' + item.id;

                html += `
                    <div class="cart-item" data-cart-id="${item.id}">
                        <div class="cart-item-layout">
                            <div class="cart-item-date-block">
                                <div class="cart-date-header"><span class="cart-date-month">${monthName}</span></div>
                                <div class="cart-date-body">
                                    <span class="cart-date-day">${dayNum}</span>
                                    <span class="cart-date-weekday">${dayName}</span>
                                </div>
                            </div>
                            <div class="cart-item-info">
                                <div class="cart-item-header">
                                    <div class="cart-item-name">${item.facilityName}</div>
                                </div>
                                <div class="cart-item-location">${item.location}</div>
                                <div class="cart-item-details">
                                    <span class="cart-item-tag">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                        ${item.time}
                                    </span>
                                    <span class="cart-item-tag">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
                                        ${item.duration}hr${item.duration > 1 ? 's' : ''}
                                    </span>
                                    ${item.hasInsurance ? `<span class="cart-item-insurance-badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg> Insured</span>` : ''}
                                    <span class="cart-item-price-value" style="margin-left:auto;font-size:14px">$${item.lineTotal.toFixed(2)}</span>
                                </div>

                                <div class="cart-item-actions">
                                    <button class="cart-item-action-btn action-primary" onclick="bookAnotherTime('${item.facilityName.replace(/'/g, "\\'")}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                        Add time
                                    </button>
                                    <button class="cart-item-action-btn" onclick="toggleCartDetails(this, '${collapseId}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
                                        Details
                                    </button>
                                    <button class="cart-item-action-btn" onclick="removeCartItem(${item.id})" title="Remove reservation" style="margin-left:auto;color:var(--text-secondary);opacity:0.6">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    </button>
                                </div>

                                <div class="cart-item-collapse" id="${collapseId}">
                                    <div class="cart-item-collapse-inner">
                                        <div class="cart-detail-section-title">Booking info</div>
                                        ${typeLabel ? `<div class="cart-detail-row">
                                            <span class="cart-detail-label">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg>
                                                Type
                                            </span>
                                            <span class="cart-detail-value">${typeLabel}</span>
                                        </div>` : ''}
                                        ${actLabel ? `<div class="cart-detail-row">
                                            <span class="cart-detail-label">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
                                                Activity
                                            </span>
                                            <span class="cart-detail-value">${actLabel}</span>
                                        </div>` : ''}
                                        ${gsLabel ? `<div class="cart-detail-row">
                                            <span class="cart-detail-label">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                                                Group size
                                            </span>
                                            <span class="cart-detail-value">${gsLabel}</span>
                                        </div>` : ''}
                                        <div class="cart-detail-row">
                                            <span class="cart-detail-label">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                                                District
                                            </span>
                                            <span class="cart-detail-value">${item.district}</span>
                                        </div>

                                        <div class="cart-detail-divider"></div>
                                        <div class="cart-detail-section-title">Cost breakdown</div>
                                        <div class="cart-cost-row">
                                            <span class="cart-cost-label">Facility rental ($${item.hourlyRate}/hr  ${item.duration}hr${item.duration > 1 ? 's' : ''})</span>
                                            <span class="cart-cost-value">$${item.facilityTotal.toFixed(2)}</span>
                                        </div>
                                        ${amenityLines}
                                        <div class="cart-cost-total">
                                            <span class="cart-cost-total-label">Slot total</span>
                                            <span class="cart-cost-total-value">$${item.lineTotal.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            itemsContainer.innerHTML = html;

            // Totals
            let subtotal = 0, addons = 0;
            cartItems.forEach(item => {
                subtotal += item.facilityTotal;
                addons += item.amenityTotal;
            });
            const fee = (subtotal + addons) * 0.10;
            const grand = subtotal + addons + fee;

            // Build footer line items per reservation
            let footerLines = '';
            cartItems.forEach(item => {
                const dObj = new Date(item.date + 'T12:00:00');
                const shortDate = dObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                footerLines += `
                    <div class="cart-total-row">
                        <span class="cart-total-label">${item.facilityName} - ${shortDate}</span>
                        <span class="cart-total-value">$${item.facilityTotal.toFixed(2)}</span>
                    </div>`;
                item.amenities.forEach(a => {
                    footerLines += `
                    <div class="cart-total-row" style="padding-left:12px">
                        <span class="cart-total-label" style="font-size:12px;opacity:0.8">+ ${a.name}</span>
                        <span class="cart-total-value" style="font-size:12px">$${a.price.toFixed(2)}</span>
                    </div>`;
                });
            });

            const footerItemsEl = document.getElementById('cartFooterLineItems');
            footerItemsEl.innerHTML = footerLines;

            document.getElementById('cartFeeTotal').textContent = '$' + fee.toFixed(2);
            document.getElementById('cartGrandTotal').textContent = '$' + grand.toFixed(2);
        }

        function createEmptyState() {
            const div = document.createElement('div');
            div.className = 'cart-drawer-empty';
            div.id = 'cartEmpty';
            div.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                <div class="cart-drawer-empty-title">No reservations yet</div>
                <div class="cart-drawer-empty-text">Browse facilities and reserve time slots to get started.</div>
            `;
            return div;
        }

        function removeCartItem(id) {
            const el = document.querySelector(`.cart-item[data-cart-id="${id}"]`);
            if (el) {
                el.classList.add('removing');
                setTimeout(() => {
                    cartItems = cartItems.filter(i => i.id !== id);
                    updateCartUI();
                    refreshCardSlots();
                    if (currentModalFacility) renderModalSlots();
                }, 350);
            } else {
                cartItems = cartItems.filter(i => i.id !== id);
                updateCartUI();
                refreshCardSlots();
                if (currentModalFacility) renderModalSlots();
            }
        }

        function toggleCartCollapse(btn, collapseId) {
            const el = document.getElementById(collapseId);
            if (!el) return;
            const isOpen = el.classList.contains('open');
            el.classList.toggle('open', !isOpen);
            btn.classList.toggle('open', !isOpen);
        }

        function toggleCartDetails(btn, collapseId) {
            const el = document.getElementById(collapseId);
            if (!el) return;
            const isOpen = el.classList.contains('open');
            el.classList.toggle('open', !isOpen);
            btn.classList.toggle('open', !isOpen);
            // Rotate chevron
            const svg = btn.querySelector('svg');
            if (svg) svg.style.transform = isOpen ? '' : 'rotate(180deg)';
        }

        function bookAnotherTime(facilityName) {
            // Close the drawer, then open the booking modal for the same facility
            toggleCartDrawer();
            setTimeout(() => {
                openBookingModal(facilityName, null);
            }, 300);
        }

        function browseMoreFacilities() {
            // Close the drawer so user can browse the facility grid
            toggleCartDrawer();
            // Scroll to the results area
            setTimeout(() => {
                const results = document.getElementById('facilitiesGrid');
                if (results) results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 350);
        }

        function clearCart() {
            if (!confirm('Remove all reservations?')) return;
            cartItems = [];
            updateCartUI();
            refreshCardSlots();
            if (currentModalFacility) renderModalSlots();
        }

        function toggleCartDrawer() {
            const overlay = document.getElementById('cartDrawerOverlay');
            overlay.classList.toggle('open');
            document.body.style.overflow = overlay.classList.contains('open') ? 'hidden' : '';
        }

        function cartCheckout() {
            if (!retainedInsurance) {
                updateCartInsuranceState();
                return;
            }

            const grand = document.getElementById('cartGrandTotal').textContent;
            const fee = document.getElementById('cartFeeTotal').textContent;
            const itemsCopy = [...cartItems];

            // Generate reference number
            const ref = 'REF-' + Date.now().toString(36).toUpperCase().slice(-6) + Math.random().toString(36).slice(2, 4).toUpperCase();
            document.getElementById('confirmRef').textContent = ref;

            // Build item rows
            const itemsHtml = itemsCopy.map(item => {
                const dObj = new Date(item.date + 'T12:00:00');
                const dateStr = dObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                return `
                    <div class="confirm-item-row">
                        <div class="confirm-item-dot"></div>
                        <div class="confirm-item-info">
                            <div class="confirm-item-name">${item.facilityName}</div>
                            <div class="confirm-item-detail">${dateStr} - ${item.time} - ${item.duration}hr${item.duration > 1 ? 's' : ''}</div>
                        </div>
                        <div class="confirm-item-price">$${item.lineTotal.toFixed(2)}</div>
                    </div>`;
            }).join('');
            document.getElementById('confirmItems').innerHTML = itemsHtml;
            document.getElementById('confirmTotal').textContent = grand;

            // Close drawer
            toggleCartDrawer();

            // Clear cart
            cartItems = [];
            updateCartUI();

            // Show confirmation page after drawer animates out
            setTimeout(() => {
                const overlay = document.getElementById('confirmPageOverlay');
                document.body.style.overflow = 'hidden';
                overlay.classList.add('active');
                overlay.scrollTop = 0;
            }, 350);
        }

        function closeConfirmPage() {
            const overlay = document.getElementById('confirmPageOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            // Scroll to top of facilities
            setTimeout(() => {
                const results = document.getElementById('facilitiesGrid');
                if (results) results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 350);
        }

        // Close cart drawer / confirm page on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const confirmOverlay = document.getElementById('confirmPageOverlay');
                if (confirmOverlay.classList.contains('active')) {
                    closeConfirmPage();
                    e.stopPropagation();
                    return;
                }
                const overlay = document.getElementById('cartDrawerOverlay');
                if (overlay.classList.contains('open')) {
                    toggleCartDrawer();
                    e.stopPropagation();
                }
            }
        });

        // =============================================
        // MODAL DATE PICKER
        // =============================================
        const modalDateField = document.getElementById('modalDateField');
        const modalDatepicker = document.getElementById('modalDatepicker');
        const mdpDays = document.getElementById('mdpDays');
        const mdpMonth = document.getElementById('mdpMonth');
        const mdpPrev = document.getElementById('mdpPrev');
        const mdpNext = document.getElementById('mdpNext');
        const mdpClear = document.getElementById('mdpClear');
        const modalDateInput = document.getElementById('modalDate');
        const modalDateDisplay = document.getElementById('modalDateDisplay');
        let mdpViewDate = new Date();

        function formatModalDate(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr + 'T12:00:00');
            return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
        }

        function renderModalDatepicker() {
            const year = mdpViewDate.getFullYear();
            const month = mdpViewDate.getMonth();
            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            mdpMonth.textContent = months[month] + ' ' + year;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrev = new Date(year, month, 0).getDate();
            const today = new Date();
            today.setHours(0,0,0,0);
            const selectedVal = modalDateInput.value;

            // Adjust for Monday start
            const startDay = firstDay === 0 ? 6 : firstDay - 1;

            let html = '';
            for (let i = startDay - 1; i >= 0; i--) {
                const d = daysInPrev - i;
                html += '<button class="dp-day other-month past" type="button" disabled>' + d + '</button>';
            }
            for (let d = 1; d <= daysInMonth; d++) {
                const dateObj = new Date(year, month, d);
                const dateStr = year + '-' + String(month+1).padStart(2,'0') + '-' + String(d).padStart(2,'0');
                const isPast = dateObj < today;
                const isToday = dateObj.getTime() === today.getTime();
                const isSelected = dateStr === selectedVal;
                let cls = 'dp-day';
                if (isPast) cls += ' past';
                if (isToday) cls += ' today';
                if (isSelected) cls += ' selected';
                html += '<button class="' + cls + '" type="button" data-date="' + dateStr + '"' + (isPast ? ' disabled' : '') + '>' + d + '</button>';
            }
            const totalCells = startDay + daysInMonth;
            const remaining = (7 - (totalCells % 7)) % 7;
            for (let d = 1; d <= remaining; d++) {
                html += '<button class="dp-day other-month" type="button" disabled>' + d + '</button>';
            }
            mdpDays.innerHTML = html;

            // Dim prev arrow when on current month
            const nowDp = new Date();
            const isCurrentMonth = year === nowDp.getFullYear() && month === nowDp.getMonth();
            mdpPrev.style.opacity = isCurrentMonth ? '0.25' : '';
            mdpPrev.style.pointerEvents = isCurrentMonth ? 'none' : '';
        }

        function setModalDate(dateStr) {
            modalDateInput.value = dateStr;
            if (dateStr) {
                modalDateDisplay.textContent = formatModalDate(dateStr);
                modalDateDisplay.classList.remove('placeholder');
            } else {
                modalDateDisplay.textContent = 'Select a date';
                modalDateDisplay.classList.add('placeholder');
            }
            // Selecting a new date clears the slot selection
            selectedModalSlot = null;
            renderModalSlots();
            validateModalForm();
        }

        modalDateField.addEventListener('click', (e) => {
            if (e.target.closest('.modal-datepicker')) return;
            modalDatepicker.classList.toggle('open');
            if (modalDatepicker.classList.contains('open')) renderModalDatepicker();
        });

        mdpDays.addEventListener('click', (e) => {
            e.stopPropagation();
            const btn = e.target.closest('.dp-day[data-date]');
            if (!btn || btn.disabled) return;
            setModalDate(btn.dataset.date);
            modalDatepicker.classList.remove('open');
        });

        mdpPrev.addEventListener('click', (e) => {
            e.stopPropagation();
            const now = new Date();
            const prevMonth = new Date(mdpViewDate);
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            if (prevMonth.getFullYear() < now.getFullYear() ||
                (prevMonth.getFullYear() === now.getFullYear() && prevMonth.getMonth() < now.getMonth())) return;
            mdpViewDate.setMonth(mdpViewDate.getMonth() - 1);
            renderModalDatepicker();
        });

        mdpNext.addEventListener('click', (e) => {
            e.stopPropagation();
            mdpViewDate.setMonth(mdpViewDate.getMonth() + 1);
            renderModalDatepicker();
        });

        mdpClear.addEventListener('click', (e) => {
            e.stopPropagation();
            setModalDate('');
            modalDatepicker.classList.remove('open');
        });

        document.addEventListener('click', (e) => {
            if (!modalDateField.contains(e.target)) {
                modalDatepicker.classList.remove('open');
            }
        });

        // Escape key closes modal (only if cart drawer isn't open)
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && !document.getElementById('cartDrawerOverlay').classList.contains('open')) closeBookingModal();
        });

        // =============================================
        // WIRE UP CLICK HANDLERS (delegated)
        // =============================================
        document.addEventListener('click', function(e) {
            // "View Details" button on facility cards
            const viewBtn = e.target.closest('.btn-check-availability');
            if (viewBtn) {
                const card = viewBtn.closest('.facility-card');
                if (card) {
                    const name = card.querySelector('.facility-name')?.textContent;
                    if (name) openBookingModal(name);
                }
                return;
            }

            // Time slot button on facility cards
            const slotBtn = e.target.closest('.time-slot');
            if (slotBtn) {
                const card = slotBtn.closest('.facility-card');
                if (card) {
                    const name = card.querySelector('.facility-name')?.textContent;
                    const time = slotBtn.textContent.trim();
                    if (name) openBookingModal(name, time);
                }
                return;
            }

            // Facility list item in calendar view
            const listItem = e.target.closest('.facility-list-item');
            if (listItem) {
                const name = listItem.querySelector('.list-item-name')?.textContent;
                if (name) openBookingModal(name);
                return;
            }
        });

        // Initialize with first district in selector
        switchDistrict(document.getElementById('districtSwitcher').value);
    </script>
</body>
</html>
